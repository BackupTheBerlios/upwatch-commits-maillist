<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Upwatch-commits] r633 - in upwatch/libdbi: . cfg common compat doc	patches upwatch util uw_accept uw_acceptbb uw_dns uw_httpget	uw_imap uw_iptraf uw_mssql uw_mysql uw_mysqlstats uw_null	uw_ping uw_pop3 uw_postgresql uw_process uw_purple uw_route	uw_send uw_setip uw_smtp uw_snmpget uw_syncprobes uw_sysstat	uw_sysstat/uw_sysstat.d/maillog uw_sysstat/uw_sysstat.d/mysql	uw_sysstat/uw_sysstat.d/quagga uw_sysstat/uw_sysstat.d/syslog	uw_sysstat/uw_sysstat.d/upwatch uw_tcpconnect
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/upwatch-commits/2006-July/index.html" >
   <LINK REL="made" HREF="mailto:upwatch-commits%40lists.berlios.de?Subject=Re%3A%20%5BUpwatch-commits%5D%20r633%20-%20in%20upwatch/libdbi%3A%20.%20cfg%20common%20compat%20doc%0A%09patches%20upwatch%20util%20uw_accept%20uw_acceptbb%20uw_dns%20uw_httpget%0A%09uw_imap%20uw_iptraf%20uw_mssql%20uw_mysql%20uw_mysqlstats%20uw_null%0A%09uw_ping%20uw_pop3%20uw_postgresql%20uw_process%20uw_purple%20uw_route%0A%09uw_send%20uw_setip%20uw_smtp%20uw_snmpget%20uw_syncprobes%20uw_sysstat%0A%09uw_sysstat/uw_sysstat.d/maillog%20uw_sysstat/uw_sysstat.d/mysql%0A%09uw_sysstat/uw_sysstat.d/quagga%20uw_sysstat/uw_sysstat.d/syslog%0A%09uw_sysstat/uw_sysstat.d/upwatch%20uw_tcpconnect&In-Reply-To=%3C200607212313.k6LNDmAb016723%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000167.html">
   <LINK REL="Next"  HREF="000166.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Upwatch-commits] r633 - in upwatch/libdbi: . cfg common compat doc	patches upwatch util uw_accept uw_acceptbb uw_dns uw_httpget	uw_imap uw_iptraf uw_mssql uw_mysql uw_mysqlstats uw_null	uw_ping uw_pop3 uw_postgresql uw_process uw_purple uw_route	uw_send uw_setip uw_smtp uw_snmpget uw_syncprobes uw_sysstat	uw_sysstat/uw_sysstat.d/maillog uw_sysstat/uw_sysstat.d/mysql	uw_sysstat/uw_sysstat.d/quagga uw_sysstat/uw_sysstat.d/syslog	uw_sysstat/uw_sysstat.d/upwatch uw_tcpconnect</H1>
    <B>raarts at BerliOS</B> 
    <A HREF="mailto:upwatch-commits%40lists.berlios.de?Subject=Re%3A%20%5BUpwatch-commits%5D%20r633%20-%20in%20upwatch/libdbi%3A%20.%20cfg%20common%20compat%20doc%0A%09patches%20upwatch%20util%20uw_accept%20uw_acceptbb%20uw_dns%20uw_httpget%0A%09uw_imap%20uw_iptraf%20uw_mssql%20uw_mysql%20uw_mysqlstats%20uw_null%0A%09uw_ping%20uw_pop3%20uw_postgresql%20uw_process%20uw_purple%20uw_route%0A%09uw_send%20uw_setip%20uw_smtp%20uw_snmpget%20uw_syncprobes%20uw_sysstat%0A%09uw_sysstat/uw_sysstat.d/maillog%20uw_sysstat/uw_sysstat.d/mysql%0A%09uw_sysstat/uw_sysstat.d/quagga%20uw_sysstat/uw_sysstat.d/syslog%0A%09uw_sysstat/uw_sysstat.d/upwatch%20uw_tcpconnect&In-Reply-To=%3C200607212313.k6LNDmAb016723%40sheep.berlios.de%3E"
       TITLE="[Upwatch-commits] r633 - in upwatch/libdbi: . cfg common compat doc	patches upwatch util uw_accept uw_acceptbb uw_dns uw_httpget	uw_imap uw_iptraf uw_mssql uw_mysql uw_mysqlstats uw_null	uw_ping uw_pop3 uw_postgresql uw_process uw_purple uw_route	uw_send uw_setip uw_smtp uw_snmpget uw_syncprobes uw_sysstat	uw_sysstat/uw_sysstat.d/maillog uw_sysstat/uw_sysstat.d/mysql	uw_sysstat/uw_sysstat.d/quagga uw_sysstat/uw_sysstat.d/syslog	uw_sysstat/uw_sysstat.d/upwatch uw_tcpconnect">raarts at mail.berlios.de
       </A><BR>
    <I>Sat Jul 22 01:13:48 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000167.html">[Upwatch-commits] r632 - in upwatch/libdbi: . common	compat/bb/bbhimport doc st-1.4 upwatch uw_accept uw_acceptbb	uw_dns uw_httpget uw_imap uw_investigate uw_mssql uw_mysql	uw_mysqlstats uw_null uw_ping uw_pop3 uw_postgresql	uw_process uw_purple uw_route uw_send uw_setip uw_smtp	uw_snmpget uw_syncprobes uw_sysstat uw_tcpconnect
</A></li>
        <LI>Next message: <A HREF="000166.html">[Upwatch-commits] r634 - upwatch/trunk/uw_httpget
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#168">[ date ]</a>
              <a href="thread.html#168">[ thread ]</a>
              <a href="subject.html#168">[ subject ]</a>
              <a href="author.html#168">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: raarts
Date: 2006-07-22 01:12:45 +0200 (Sat, 22 Jul 2006)
New Revision: 633

Added:
   upwatch/libdbi/libstatgrab-0.13/
   upwatch/libdbi/st-1.7/
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/amavisd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/auditd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/automount
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/linux.kernel
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/logrotate
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/newsyslog
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/postgresql
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/quagga
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/rpc
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/selinux
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/spamd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/syslogd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/useradd
Removed:
   upwatch/libdbi/cfg/cvs2cl.pl
   upwatch/libdbi/common/license_proprietary.def
   upwatch/libdbi/patches/libstatgrab-openbsd.patch
   upwatch/libdbi/patches/xmbmon203.patch
   upwatch/libdbi/upwatch-spec.spec
   upwatch/libdbi/uw_investigate/
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/fast
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/netland
Modified:
   upwatch/libdbi/Makefile.am
   upwatch/libdbi/Makefile.am.common
   upwatch/libdbi/Makefile.am.libs
   upwatch/libdbi/cfg/bootstrap
   upwatch/libdbi/common/Makefile.am
   upwatch/libdbi/common/probe.tpl
   upwatch/libdbi/compat/Makefile.am
   upwatch/libdbi/configure.ac
   upwatch/libdbi/doc/about.xml
   upwatch/libdbi/doc/admin-guide.html
   upwatch/libdbi/doc/admin-guide.txt
   upwatch/libdbi/doc/client-configuration.xml
   upwatch/libdbi/doc/client-install.xml
   upwatch/libdbi/doc/howitallworks.xml
   upwatch/libdbi/doc/installation.xml
   upwatch/libdbi/doc/program-guide.html
   upwatch/libdbi/doc/program-guide.txt
   upwatch/libdbi/doc/upwatch.html
   upwatch/libdbi/doc/upwatch.txt
   upwatch/libdbi/patches/README
   upwatch/libdbi/upwatch/generic.h
   upwatch/libdbi/upwatch/log.c
   upwatch/libdbi/util/chklog.c
   upwatch/libdbi/util/chklog_options.def
   upwatch/libdbi/util/uwq_options.def
   upwatch/libdbi/util/uwregexp.c
   upwatch/libdbi/util/uwsaidar.c
   upwatch/libdbi/uw_accept/run.c
   upwatch/libdbi/uw_acceptbb/run.c
   upwatch/libdbi/uw_acceptbb/uw_acceptbb.def
   upwatch/libdbi/uw_dns/run.c
   upwatch/libdbi/uw_dns/uw_dns.def
   upwatch/libdbi/uw_httpget/run.c
   upwatch/libdbi/uw_httpget/uw_httpget.def
   upwatch/libdbi/uw_imap/run.c
   upwatch/libdbi/uw_iptraf/run.c
   upwatch/libdbi/uw_iptraf/uw_iptraf.def
   upwatch/libdbi/uw_mssql/run.c
   upwatch/libdbi/uw_mysql/run.c
   upwatch/libdbi/uw_mysqlstats/run.c
   upwatch/libdbi/uw_null/run.c
   upwatch/libdbi/uw_null/uw_null.def
   upwatch/libdbi/uw_ping/run.c
   upwatch/libdbi/uw_ping/uw_ping.def
   upwatch/libdbi/uw_pop3/run.c
   upwatch/libdbi/uw_postgresql/run.c
   upwatch/libdbi/uw_process/Makefile.am
   upwatch/libdbi/uw_process/iptraf.c
   upwatch/libdbi/uw_process/mysqlstats.c
   upwatch/libdbi/uw_process/run.c
   upwatch/libdbi/uw_process/uw_process.conf
   upwatch/libdbi/uw_purple/uw_purple.def
   upwatch/libdbi/uw_route/run.c
   upwatch/libdbi/uw_route/uw_route.conf
   upwatch/libdbi/uw_route/uw_route.def
   upwatch/libdbi/uw_send/run.c
   upwatch/libdbi/uw_send/uw_send.def
   upwatch/libdbi/uw_setip/run.c
   upwatch/libdbi/uw_smtp/run.c
   upwatch/libdbi/uw_snmpget/run.c
   upwatch/libdbi/uw_syncprobes/uw_syncprobes.def
   upwatch/libdbi/uw_sysstat/Makefile.am
   upwatch/libdbi/uw_sysstat/run.c
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/macros.txt
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/postfix
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/rmacros.txt
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/sendmail
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/mysql/macros.txt
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/mysql/rmacros.txt
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/bgpd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/macros.txt
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/rmacros.txt
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/zebra
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/apmd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/dhcpd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/gconfd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/gdm
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/httpd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/identd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/keepalived
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/macros.txt
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/named
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/nfs-utils
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/openntpd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/pam
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/rmacros.txt
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/shorewall
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/smb
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/snmpd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/sophie
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/sshd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/su
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/sudo
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/tftpd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/upwatch
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/vsftpd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/xfs
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/xinetd
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/upwatch/macros.txt
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/upwatch/rmacros.txt
   upwatch/libdbi/uw_sysstat/uw_sysstat.d/upwatch/upwatch
   upwatch/libdbi/uw_sysstat/uw_sysstat.def
   upwatch/libdbi/uw_tcpconnect/run.c
Log:
Sync this branch with the trunk.


Modified: upwatch/libdbi/Makefile.am
===================================================================
--- upwatch/libdbi/Makefile.am	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/Makefile.am	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,9 +1,5 @@
 include $(top_srcdir)/Makefile.am.path
 
-#if HAVE_LIBNET
-#USE_LIBNET = uw_investigate
-#endif
-
 if HAVE_LIBPCAP
 UW_IPTRAF = uw_iptraf
 endif
@@ -70,11 +66,11 @@
 export PROGNAMES MONITORPROG CLIENTPROG SERVERPROG EXTRAPROG
 export TOP_SRCDIR = $(top_srcdir)
 
-SUBDIRS = upwatch st-1.4 ${XMBMON} libstatgrab uw_send uw_sysstat uw_null \
-  uw_httpget uw_dns uw_ping uw_pop3 uw_smtp uw_tcpconnect uw_imap \
-  uw_mysql uw_mysqlstats uw_postgresql uw_snmpget uw_mssql uw_iptraf \
-  uw_acceptbb uw_accept uw_purple uw_route uw_syncprobes uw_setip uw_process \
-  ${COMPAT} util scripts config common
+if ENABLE_SERVER
+SUBDIRS = upwatch st-1.7 ${XMBMON} libstatgrab-0.13 ${PROGNAMES} compat util scripts config common
+else
+SUBDIRS = upwatch ${XMBMON} libstatgrab-0.13 ${PROGNAMES} util scripts config common 
+endif
 
 DIST_SUBDIRS = ${SUBDIRS} doc
 
@@ -88,7 +84,7 @@
   upwatch-spec.def upwatch-spec.tpl upwatch.spec templates \
   patches/libpcap-linux-timeout.patch mswindows \
   ${SERVER_DIST} \
-  install-sh config.sub mkinstalldirs depcomp cfg/cvs2cl.pl
+  install-sh config.sub mkinstalldirs depcomp
 
 
 upwatch.spec: force upwatch-spec.def upwatch-spec.tpl common/spec.tpl \
@@ -160,3 +156,4 @@
 
 #	rm -f $(distdir)/doc/program-guide.*
 #	rm -f $(distdir)/doc/admin-guide.*
+

Modified: upwatch/libdbi/Makefile.am.common
===================================================================
--- upwatch/libdbi/Makefile.am.common	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/Makefile.am.common	2006-07-21 23:12:45 UTC (rev 633)
@@ -11,8 +11,7 @@
 SPECTPL = $(top_srcdir)/common/spec.tpl
 PROBTPL = $(top_srcdir)/common/probe.tpl
 INITTPL = $(top_srcdir)/common/init.tpl
-CMDDEF  = $(top_srcdir)/common/generic_options.def $(top_srcdir)/common/dbase_options.def \
- $(top_srcdir)/common/minimal_options.def
+CMDDEF  = $(top_srcdir)/common/generic_options.def $(top_srcdir)/common/minimal_options.def
 PROBDEF = $(top_srcdir)/common/probe_generic.def
 if CYGWIN
 GENINCL = -L /usr/local/share/autogen -L $(top_srcdir)/common

Modified: upwatch/libdbi/Makefile.am.libs
===================================================================
--- upwatch/libdbi/Makefile.am.libs	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/Makefile.am.libs	2006-07-21 23:12:45 UTC (rev 633)
@@ -3,8 +3,8 @@
 LIBUPWATCH = $(top_srcdir)/upwatch/libupwatch.a @LIBXML2_LIBS@
 LIBUPWATCHT = $(top_srcdir)/upwatch/libupwatcht.a @LIBXML2_LIBS@
 
-LIBST = $(top_srcdir)/st-1.4/libst.a
-INCL_ST = $(top_srcdir)/st-1.4
+LIBST = $(top_srcdir)/st-1.7/libst.a
+INCL_ST = $(top_srcdir)/st-1.7
 
-LIBSTATGRAB = $(top_srcdir)/libstatgrab/src/libstatgrab/.libs/libstatgrab.a
-INCL_STATGRAB = $(top_srcdir)/libstatgrab/src/libstatgrab/
+LIBSTATGRAB = $(top_srcdir)/libstatgrab-0.13/src/libstatgrab/.libs/libstatgrab.a
+INCL_STATGRAB = $(top_srcdir)/libstatgrab-0.13/src/libstatgrab/

Modified: upwatch/libdbi/cfg/bootstrap
===================================================================
--- upwatch/libdbi/cfg/bootstrap	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/cfg/bootstrap	2006-07-21 23:12:45 UTC (rev 633)
@@ -3,7 +3,7 @@
 # test if libtoolize is called glibtoolize (MacOSX)
 BOGUS=`glibtoolize -n 2&gt;/dev/null`
 TEST=$?
-if [ x$TEST == &quot;x0&quot; ]
+if [ $TEST -eq 0 ]
 then
 	LIBTOOLIZE=glibtoolize
 else
@@ -14,17 +14,12 @@
 set -x
 
 # libstatgrab
-cd libstatgrab
-#if [ ! -f libstatgrab-openbsd.patch ]
-#then
-#  cp ../patches/libstatgrab-openbsd.patch .
-#  patch -p1 &lt; libstatgrab-openbsd.patch
+cd libstatgrab-0.13
   aclocal
   autoheader
   $LIBTOOLIZE
   autoconf
   automake --gnu --add-missing
-#fi
 cd ..
 
 aclocal \
@@ -36,4 +31,4 @@
 cd xmbmon203
 autoconf
 cd ..
-
+svnversion . &gt; RELEASE

Deleted: upwatch/libdbi/cfg/cvs2cl.pl
===================================================================
--- upwatch/libdbi/cfg/cvs2cl.pl	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/cfg/cvs2cl.pl	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,1995 +0,0 @@
-#!/usr/bin/perl -w
-# -*- mode: perl; perl-indent-level: 2; -*-
-
-eval 'exec perl -w -x $0 ${1+&quot;$@&quot;}'
-  if 0; # not running under some shell
-
-##############################################################
-###                                                        ###
-### cvs2cl.pl: produce ChangeLog(s) from `cvs log` output. ###
-###                                                        ###
-##############################################################
-
-## $Revision: 1.1 $
-## $Date: 2002/12/27 10:12:15 $
-## $Author: raarts $
-##
-##   (C) 2001,2002 Martyn J. Pearce &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/upwatch-commits">fluffy at cpan.org</A>&gt;
-##   (C) 1999 Karl Fogel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/upwatch-commits">kfogel at red-bean.com</A>&gt;, under the GNU GPL.
-##
-##   (Extensively hacked on by Melissa O'Neill &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/upwatch-commits">oneill at cs.sfu.ca</A>&gt;.)
-##
-## cvs2cl.pl is free software; you can redistribute it and/or modify
-## it under the terms of the GNU General Public License as published by
-## the Free Software Foundation; either version 2, or (at your option)
-## any later version.
-##
-## cvs2cl.pl is distributed in the hope that it will be useful,
-## but WITHOUT ANY WARRANTY; without even the implied warranty of
-## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-## GNU General Public License for more details.
-##
-## You may have received a copy of the GNU General Public License
-## along with cvs2cl.pl; see the file COPYING.  If not, write to the
-## Free Software Foundation, Inc., 59 Temple Place - Suite 330,
-## Boston, MA 02111-1307, USA.
-
-
-
-use strict;
-use Text::Wrap;
-use Time::Local;
-use File::Basename;
-
-
-# The Plan:
-#
-# Read in the logs for multiple files, spit out a nice ChangeLog that
-# mirrors the information entered during `cvs commit'.
-#
-# The problem presents some challenges. In an ideal world, we could
-# detect files with the same author, log message, and checkin time --
-# each &lt;filelist, author, time, logmessage&gt; would be a changelog entry.
-# We'd sort them; and spit them out.  Unfortunately, CVS is *not atomic*
-# so checkins can span a range of times.  Also, the directory structure
-# could be hierarchical.
-#
-# Another question is whether we really want to have the ChangeLog
-# exactly reflect commits. An author could issue two related commits,
-# with different log entries, reflecting a single logical change to the
-# source. GNU style ChangeLogs group these under a single author/date.
-# We try to do the same.
-#
-# So, we parse the output of `cvs log', storing log messages in a
-# multilevel hash that stores the mapping:
-#   directory =&gt; author =&gt; time =&gt; message =&gt; filelist
-# As we go, we notice &quot;nearby&quot; commit times and store them together
-# (i.e., under the same timestamp), so they appear in the same log
-# entry.
-#
-# When we've read all the logs, we twist this mapping into
-# a time =&gt; author =&gt; message =&gt; filelist mapping for each directory.
-#
-# If we're not using the `--distributed' flag, the directory is always
-# considered to be `./', even as descend into subdirectories.
-
-
-############### Globals ################
-
-
-# What we run to generate it:
-my $Log_Source_Command = &quot;cvs log&quot;;
-
-# In case we have to print it out:
-my $VERSION = '$Revision: 1.1 $';
-$VERSION =~ s/\S+\s+(\S+)\s+\S+/$1/;
-
-## Vars set by options:
-
-# Print debugging messages?
-my $Debug = 0;
-
-# Just show version and exit?
-my $Print_Version = 0;
-
-# Just print usage message and exit?
-my $Print_Usage = 0;
-
-# Single top-level ChangeLog, or one per subdirectory?
-my $Distributed = 0;
-
-# What file should we generate (defaults to &quot;ChangeLog&quot;)?
-my $Log_File_Name = &quot;ChangeLog&quot;;
-
-# Grab most recent entry date from existing ChangeLog file, just add
-# to that ChangeLog.
-my $Cumulative = 0;
-
-# Expand usernames to email addresses based on a map file?
-my $User_Map_File = &quot;&quot;;
-
-# Output to a file or to stdout?
-my $Output_To_Stdout = 0;
-
-# Eliminate empty log messages?
-my $Prune_Empty_Msgs = 0;
-
-# Tags of which not to output
-my @ignore_tags;
-
-# Don't call Text::Wrap on the body of the message
-my $No_Wrap = 0;
-
-# Separates header from log message.  Code assumes it is either &quot; &quot; or
-# &quot;\n\n&quot;, so if there's ever an option to set it to something else,
-# make sure to go through all conditionals that use this var.
-my $After_Header = &quot; &quot;;
-
-# XML Encoding
-my $XML_Encoding = '';
-
-# Format more for programs than for humans.
-my $XML_Output = 0;
-
-# Do some special tweaks for log data that was written in FSF
-# ChangeLog style.
-my $FSF_Style = 0;
-
-# Show times in UTC instead of local time
-my $UTC_Times = 0;
-
-# Show day of week in output?
-my $Show_Day_Of_Week = 0;
-
-# Show revision numbers in output?
-my $Show_Revisions = 0;
-
-# Show tags (symbolic names) in output?
-my $Show_Tags = 0;
-
-# Show tags separately in output?
-my $Show_Tag_Dates = 0;
-
-# Show branches by symbolic name in output?
-my $Show_Branches = 0;
-
-# Show only revisions on these branches or their ancestors.
-my @Follow_Branches;
-
-# Don't bother with files matching this regexp.
-my @Ignore_Files;
-
-# How exactly we match entries.  We definitely want &quot;o&quot;,
-# and user might add &quot;i&quot; by using --case-insensitive option.
-my $Case_Insensitive = 0;
-
-# Maybe only show log messages matching a certain regular expression.
-my $Regexp_Gate = &quot;&quot;;
-
-# Pass this global option string along to cvs, to the left of `log':
-my $Global_Opts = &quot;&quot;;
-
-# Pass this option string along to the cvs log subcommand:
-my $Command_Opts = &quot;&quot;;
-
-# Read log output from stdin instead of invoking cvs log?
-my $Input_From_Stdin = 0;
-
-# Don't show filenames in output.
-my $Hide_Filenames = 0;
-
-# Max checkin duration. CVS checkin is not atomic, so we may have checkin
-# times that span a range of time. We assume that checkins will last no
-# longer than $Max_Checkin_Duration seconds, and that similarly, no
-# checkins will happen from the same users with the same message less
-# than $Max_Checkin_Duration seconds apart.
-my $Max_Checkin_Duration = 180;
-
-# What to put at the front of [each] ChangeLog.
-my $ChangeLog_Header = &quot;&quot;;
-
-# Whether to enable 'delta' mode, and for what start/end tags.
-my $Delta_Mode = 0;
-my $Delta_From = &quot;&quot;;
-my $Delta_To = &quot;&quot;;
-
-## end vars set by options.
-
-# latest observed times for the start/end tags in delta mode
-my $Delta_StartTime = 0;
-my $Delta_EndTime = 0;
-
-# In 'cvs log' output, one long unbroken line of equal signs separates
-# files:
-my $file_separator = &quot;=======================================&quot;
-                   . &quot;======================================&quot;;
-
-# In 'cvs log' output, a shorter line of dashes separates log messages
-# within a file:
-my $logmsg_separator = &quot;----------------------------&quot;;
-
-
-############### End globals ############
-
-
-
-
-&amp;parse_options ();
-&amp;derive_change_log ();
-
-
-
-### Everything below is subroutine definitions. ###
-
-# If accumulating, grab the boundary date from pre-existing ChangeLog.
-sub maybe_grab_accumulation_date ()
-{
-  if (! $Cumulative) {
-    return &quot;&quot;;
-  }
-
-  # else
-
-  open (LOG, &quot;$Log_File_Name&quot;)
-      or die (&quot;trouble opening $Log_File_Name for reading ($!)&quot;);
-
-  my $boundary_date;
-  while (&lt;LOG&gt;)
-  {
-    if (/^(\d\d\d\d-\d\d-\d\d\s+\d\d:\d\d)/)
-    {
-      $boundary_date = &quot;$1&quot;;
-      last;
-    }
-  }
-
-  close (LOG);
-  return $boundary_date;
-}
-
-
-# Fills up a ChangeLog structure in the current directory.
-sub derive_change_log ()
-{
-  # See &quot;The Plan&quot; above for a full explanation.
-
-  my %grand_poobah;
-
-  my $file_full_path;
-  my $time;
-  my $revision;
-  my $author;
-  my $msg_txt;
-  my $detected_file_separator;
-
-  my %tag_date_printed;
-
-  # Might be adding to an existing ChangeLog
-  my $accumulation_date = &amp;maybe_grab_accumulation_date ();
-  if ($accumulation_date) {
-    # Insert -d immediately after 'cvs log'
-    my $Log_Date_Command = &quot;-d\'&gt;${accumulation_date}\'&quot;;
-    $Log_Source_Command =~ s/(^.*log\S*)/$1 $Log_Date_Command/;
-    &amp;debug (&quot;(adding log msg starting from $accumulation_date)\n&quot;);
-  }
-
-  # We might be expanding usernames
-  my %usermap;
-
-  # In general, it's probably not very maintainable to use state
-  # variables like this to tell the loop what it's doing at any given
-  # moment, but this is only the first one, and if we never have more
-  # than a few of these, it's okay.
-  my $collecting_symbolic_names = 0;
-  my %symbolic_names;    # Where tag names get stored.
-  my %branch_names;      # We'll grab branch names while we're at it.
-  my %branch_numbers;    # Save some revisions for @Follow_Branches
-  my @branch_roots;      # For showing which files are branch ancestors.
-
-  # Bleargh.  Compensate for a deficiency of custom wrapping.
-  if (($After_Header ne &quot; &quot;) and $FSF_Style)
-  {
-    $After_Header .= &quot;\t&quot;;
-  }
-
-  if (! $Input_From_Stdin) {
-    &amp;debug (&quot;(run \&quot;${Log_Source_Command}\&quot;)\n&quot;);
-    open (LOG_SOURCE, &quot;$Log_Source_Command |&quot;)
-        or die &quot;unable to run \&quot;${Log_Source_Command}\&quot;&quot;;
-  }
-  else {
-    open (LOG_SOURCE, &quot;-&quot;) or die &quot;unable to open stdin for reading&quot;;
-  }
-
-  binmode LOG_SOURCE;
-
-  %usermap = &amp;maybe_read_user_map_file ();
-
-  while (&lt;LOG_SOURCE&gt;)
-  {
-    # If on a new file and don't see filename, skip until we find it, and
-    # when we find it, grab it.
-    if ((! (defined $file_full_path)) and /^Working file: (.*)/)
-    {
-      $file_full_path = $1;
-      if (@Ignore_Files)
-      {
-        my $base;
-        ($base, undef, undef) = fileparse ($file_full_path);
-        # Ouch, I wish trailing operators in regexps could be
-        # evaluated on the fly!
-        if ($Case_Insensitive) {
-          if (grep ($file_full_path =~ m|$_|i, @Ignore_Files)) {
-            undef $file_full_path;
-          }
-        }
-        elsif (grep ($file_full_path =~ m|$_|, @Ignore_Files)) {
-          undef $file_full_path;
-        }
-      }
-      next;
-    }
-
-    # Just spin wheels if no file defined yet.
-    next if (! $file_full_path);
-
-    # Collect tag names in case we're asked to print them in the output.
-    if (/^symbolic names:$/) {
-      $collecting_symbolic_names = 1;
-      next;  # There's no more info on this line, so skip to next
-    }
-    if ($collecting_symbolic_names)
-    {
-      # All tag names are listed with whitespace in front in cvs log
-      # output; so if see non-whitespace, then we're done collecting.
-      if (/^\S/) {
-        $collecting_symbolic_names = 0;
-      }
-      else    # we're looking at a tag name, so parse &amp; store it
-      {
-        # According to the Cederqvist manual, in node &quot;Tags&quot;, tag
-        # names must start with an uppercase or lowercase letter and
-        # can contain uppercase and lowercase letters, digits, `-',
-        # and `_'.  However, it's not our place to enforce that, so
-        # we'll allow anything CVS hands us to be a tag:
-        /^\s+([^:]+): ([\d.]+)$/;
-        my $tag_name = $1;
-        my $tag_rev  = $2;
-
-        # A branch number either has an odd number of digit sections
-        # (and hence an even number of dots), or has &quot;.0.&quot; as the
-        # second-to-last digit section.  Test for these conditions.
-        my $real_branch_rev = &quot;&quot;;
-        if (($tag_rev =~ /^(\d+\.\d+\.)+\d+$/)   # Even number of dots...
-            and (! ($tag_rev =~ /^(1\.)+1$/)))   # ...but not &quot;1.[1.]1&quot;
-        {
-          $real_branch_rev = $tag_rev;
-        }
-        elsif ($tag_rev =~ /(\d+\.(\d+\.)+)0.(\d+)/)  # Has &quot;.0.&quot;
-        {
-          $real_branch_rev = $1 . $3;
-        }
-        # If we got a branch, record its number.
-        if ($real_branch_rev)
-        {
-          $branch_names{$real_branch_rev} = $tag_name;
-          if (@Follow_Branches) {
-            if (grep ($_ eq $tag_name, @Follow_Branches)) {
-              $branch_numbers{$tag_name} = $real_branch_rev;
-            }
-          }
-        }
-        else {
-          # Else it's just a regular (non-branch) tag.
-          push (@{$symbolic_names{$tag_rev}}, $tag_name);
-        }
-      }
-    }
-    # End of code for collecting tag names.
-
-    # If have file name, but not revision, and see revision, then grab
-    # it.  (We collect unconditionally, even though we may or may not
-    # ever use it.)
-    if ((! (defined $revision)) and (/^revision (\d+\.[\d.]+)/))
-    {
-      $revision = $1;
-
-      if (@Follow_Branches)
-      {
-        foreach my $branch (@Follow_Branches)
-        {
-          # Special case for following trunk revisions
-          if (($branch =~ /^trunk$/i) and ($revision =~ /^[0-9]+\.[0-9]+$/))
-          {
-            goto dengo;
-          }
-
-          my $branch_number = $branch_numbers{$branch};
-          if ($branch_number)
-          {
-            # Are we on one of the follow branches or an ancestor of
-            # same?
-            #
-            # If this revision is a prefix of the branch number, or
-            # possibly is less in the minormost number, OR if this
-            # branch number is a prefix of the revision, then yes.
-            # Otherwise, no.
-            #
-            # So below, we determine if any of those conditions are
-            # met.
-
-            # Trivial case: is this revision on the branch?
-            # (Compare this way to avoid regexps that screw up Emacs
-            # indentation, argh.)
-            if ((substr ($revision, 0, ((length ($branch_number)) + 1)))
-                eq ($branch_number . &quot;.&quot;))
-            {
-              goto dengo;
-            }
-            # Non-trivial case: check if rev is ancestral to branch
-            elsif ((length ($branch_number)) &gt; (length ($revision)))
-            {
-              $revision =~ /^((?:\d+\.)+)(\d+)$/;
-              my $r_left = $1;          # still has the trailing &quot;.&quot;
-              my $r_end = $2;
-
-              $branch_number =~ /^((?:\d+\.)+)(\d+)\.\d+$/;
-              my $b_left = $1;  # still has trailing &quot;.&quot;
-              my $b_mid  = $2;   # has no trailing &quot;.&quot;
-
-              if (($r_left eq $b_left)
-                  &amp;&amp; ($r_end &lt;= $b_mid))
-              {
-                goto dengo;
-              }
-            }
-          }
-        }
-      }
-      else    # (! @Follow_Branches)
-      {
-        next;
-      }
-
-      # Else we are following branches, but this revision isn't on the
-      # path.  So skip it.
-      undef $revision;
-    dengo:
-      next;
-    }
-
-    # If we don't have a revision right now, we couldn't possibly
-    # be looking at anything useful.
-    if (! (defined ($revision))) {
-      $detected_file_separator = /^$file_separator$/o;
-      if ($detected_file_separator) {
-        # No revisions for this file; can happen, e.g. &quot;cvs log -d DATE&quot;
-        goto CLEAR;
-      }
-      else {
-        next;
-      }
-    }
-
-    # If have file name but not date and author, and see date or
-    # author, then grab them:
-    unless (defined $time)
-    {
-      if (/^date: .*/)
-      {
-        ($time, $author) = &amp;parse_date_and_author ($_);
-        if (defined ($usermap{$author}) and $usermap{$author}) {
-          $author = $usermap{$author};
-        }
-      }
-      else {
-        $detected_file_separator = /^$file_separator$/o;
-        if ($detected_file_separator) {
-          # No revisions for this file; can happen, e.g. &quot;cvs log -d DATE&quot;
-          goto CLEAR;
-        }
-      }
-      # If the date/time/author hasn't been found yet, we couldn't
-      # possibly care about anything we see.  So skip:
-      next;
-    }
-
-    # A &quot;branches: ...&quot; line here indicates that one or more branches
-    # are rooted at this revision.  If we're showing branches, then we
-    # want to show that fact as well, so we collect all the branches
-    # that this is the latest ancestor of and store them in
-    # @branch_roots.  Just for reference, the format of the line we're
-    # seeing at this point is:
-    #
-    #    branches:  1.5.2;  1.5.4;  ...;
-    #
-    # Okay, here goes:
-
-    if (/^branches:\s+(.*);$/)
-    {
-      if ($Show_Branches)
-      {
-        my $lst = $1;
-        $lst =~ s/(1\.)+1;|(1\.)+1$//;  # ignore the trivial branch 1.1.1
-        if ($lst) {
-          @branch_roots = split (/;\s+/, $lst);
-        }
-        else {
-          undef @branch_roots;
-        }
-        next;
-      }
-      else
-      {
-        # Ugh.  This really bothers me.  Suppose we see a log entry
-        # like this:
-        #
-        #    ----------------------------
-        #    revision 1.1
-        #    date: 1999/10/17 03:07:38;  author: jrandom;  state: Exp;
-        #    branches:  1.1.2;
-        #    Intended first line of log message begins here.
-        #    ----------------------------
-        #
-        # The question is, how we can tell the difference between that
-        # log message and a *two*-line log message whose first line is
-        #
-        #    &quot;branches:  1.1.2;&quot;
-        #
-        # See the problem?  The output of &quot;cvs log&quot; is inherently
-        # ambiguous.
-        #
-        # For now, we punt: we liberally assume that people don't
-        # write log messages like that, and just toss a &quot;branches:&quot;
-        # line if we see it but are not showing branches.  I hope no
-        # one ever loses real log data because of this.
-        next;
-      }
-    }
-
-    # If have file name, time, and author, then we're just grabbing
-    # log message texts:
-    $detected_file_separator = /^$file_separator$/o;
-    if ($detected_file_separator &amp;&amp; ! (defined $revision)) {
-      # No revisions for this file; can happen, e.g. &quot;cvs log -d DATE&quot;
-      goto CLEAR;
-    }
-    unless ($detected_file_separator || /^$logmsg_separator$/o)
-    {
-      $msg_txt .= $_;   # Normally, just accumulate the message...
-      next;
-    }
-    # ... until a msg separator is encountered:
-    # Ensure the message contains something:
-    if ((! $msg_txt)
-        || ($msg_txt =~ /^\s*\.\s*$|^\s*$/)
-        || ($msg_txt =~ /\*\*\* empty log message \*\*\*/))
-    {
-      if ($Prune_Empty_Msgs) {
-        goto CLEAR;
-      }
-      # else
-      $msg_txt = &quot;[no log message]\n&quot;;
-    }
-
-    ### Store it all in the Grand Poobah:
-    {
-      my $dir_key;        # key into %grand_poobah
-      my %qunk;           # complicated little jobbie, see below
-
-      # Each revision of a file has a little data structure (a `qunk')
-      # associated with it.  That data structure holds not only the
-      # file's name, but any additional information about the file
-      # that might be needed in the output, such as the revision
-      # number, tags, branches, etc.  The reason to have these things
-      # arranged in a data structure, instead of just appending them
-      # textually to the file's name, is that we may want to do a
-      # little rearranging later as we write the output.  For example,
-      # all the files on a given tag/branch will go together, followed
-      # by the tag in parentheses (so trunk or otherwise non-tagged
-      # files would go at the end of the file list for a given log
-      # message).  This rearrangement is a lot easier to do if we
-      # don't have to reparse the text.
-      #
-      # A qunk looks like this:
-      #
-      #   {
-      #     filename    =&gt;    &quot;hello.c&quot;,
-      #     revision    =&gt;    &quot;1.4.3.2&quot;,
-      #     time        =&gt;    a timegm() return value (moment of commit)
-      #     tags        =&gt;    [ &quot;tag1&quot;, &quot;tag2&quot;, ... ],
-      #     branch      =&gt;    &quot;branchname&quot; # There should be only one, right?
-      #     branchroots =&gt;    [ &quot;branchtag1&quot;, &quot;branchtag2&quot;, ... ]
-      #   }
-
-      if ($Distributed) {
-        # Just the basename, don't include the path.
-        ($qunk{'filename'}, $dir_key, undef) = fileparse ($file_full_path);
-      }
-      else {
-        $dir_key = &quot;./&quot;;
-        $qunk{'filename'} = $file_full_path;
-      }
-
-      # This may someday be used in a more sophisticated calculation
-      # of what other files are involved in this commit.  For now, we
-      # don't use it much except for delta mode, because the
-      # common-commit-detection algorithm is hypothesized to be
-      # &quot;good enough&quot; as it stands.
-      $qunk{'time'} = $time;
-
-      # We might be including revision numbers and/or tags and/or
-      # branch names in the output.  Most of the code from here to
-      # loop-end deals with organizing these in qunk.
-
-      $qunk{'revision'} = $revision;
-
-      # Grab the branch, even though we may or may not need it:
-      $qunk{'revision'} =~ /((?:\d+\.)+)\d+/;
-      my $branch_prefix = $1;
-      $branch_prefix =~ s/\.$//;  # strip off final dot
-      if ($branch_names{$branch_prefix}) {
-        $qunk{'branch'} = $branch_names{$branch_prefix};
-      }
-
-      # If there's anything in the @branch_roots array, then this
-      # revision is the root of at least one branch.  We'll display
-      # them as branch names instead of revision numbers, the
-      # substitution for which is done directly in the array:
-      if (@branch_roots) {
-        my @roots = map { $branch_names{$_} } @branch_roots;
-        $qunk{'branchroots'} = \@roots;
-      }
-
-      # Save tags too.
-      if (defined ($symbolic_names{$revision})) {
-        $qunk{'tags'} = $symbolic_names{$revision};
-        delete $symbolic_names{$revision};
-
-	# If we're in 'delta' mode, update the latest observed
-	# times for the beginning and ending tags, and
-	# when we get around to printing output, we will simply restrict
-	# ourselves to that timeframe...
-	
-	if ($Delta_Mode) {
-	  if (($time &gt; $Delta_StartTime) &amp;&amp;
-	      (grep { $_ eq $Delta_From } @{$qunk{'tags'}}))
-	  {
-	    $Delta_StartTime = $time;
-	  }
-	  
-	  if (($time &gt; $Delta_EndTime) &amp;&amp;
-	      (grep { $_ eq $Delta_To } @{$qunk{'tags'}}))
-	  {
-	    $Delta_EndTime = $time;
-	  }
-	}
-      }
-
-      # Add this file to the list
-      # (We use many spoonfuls of autovivication magic. Hashes and arrays
-      # will spring into existence if they aren't there already.)
-
-      &amp;debug (&quot;(pushing log msg for ${dir_key}$qunk{'filename'})\n&quot;);
-
-      # Store with the files in this commit.  Later we'll loop through
-      # again, making sure that revisions with the same log message
-      # and nearby commit times are grouped together as one commit.
-      push (@{$grand_poobah{$dir_key}{$author}{$time}{$msg_txt}}, \%qunk);
-    }
-
-  CLEAR:
-    # Make way for the next message
-    undef $msg_txt;
-    undef $time;
-    undef $revision;
-    undef $author;
-    undef @branch_roots;
-
-    # Maybe even make way for the next file:
-    if ($detected_file_separator) {
-      undef $file_full_path;
-      undef %branch_names;
-      undef %branch_numbers;
-      undef %symbolic_names;
-    }
-  }
-
-  close (LOG_SOURCE);
-
-  ### Process each ChangeLog
-
-  while (my ($dir,$authorhash) = each %grand_poobah)
-  {
-    &amp;debug (&quot;DOING DIR: $dir\n&quot;);
-
-    # Here we twist our hash around, from being
-    #   author =&gt; time =&gt; message =&gt; filelist
-    # in %$authorhash to
-    #   time =&gt; author =&gt; message =&gt; filelist
-    # in %changelog.
-    #
-    # This is also where we merge entries.  The algorithm proceeds
-    # through the timeline of the changelog with a sliding window of
-    # $Max_Checkin_Duration seconds; within that window, entries that
-    # have the same log message are merged.
-    #
-    # (To save space, we zap %$authorhash after we've copied
-    # everything out of it.)
-
-    my %changelog;
-    while (my ($author,$timehash) = each %$authorhash)
-    {
-      my $lasttime;
-      my %stamptime;
-      foreach my $time (sort {$main::a &lt;=&gt; $main::b} (keys %$timehash))
-      {
-        my $msghash = $timehash-&gt;{$time};
-        while (my ($msg,$qunklist) = each %$msghash)
-        {
- 	  my $stamptime = $stamptime{$msg};
-          if ((defined $stamptime)
-              and (($time - $stamptime) &lt; $Max_Checkin_Duration)
-              and (defined $changelog{$stamptime}{$author}{$msg}))
-          {
- 	    push(@{$changelog{$stamptime}{$author}{$msg}}, @$qunklist);
-          }
-          else {
-            $changelog{$time}{$author}{$msg} = $qunklist;
-            $stamptime{$msg} = $time;
-          }
-        }
-      }
-    }
-    undef (%$authorhash);
-
-    ### Now we can write out the ChangeLog!
-
-    my ($logfile_here, $logfile_bak, $tmpfile);
-
-    if (! $Output_To_Stdout) {
-      $logfile_here =  $dir . $Log_File_Name;
-      $logfile_here =~ s/^\.\/\//\//;   # fix any leading &quot;.//&quot; problem
-      $tmpfile      = &quot;${logfile_here}.cvs2cl$$.tmp&quot;;
-      $logfile_bak  = &quot;${logfile_here}.bak&quot;;
-
-      open (LOG_OUT, &quot;&gt;$tmpfile&quot;) or die &quot;Unable to open \&quot;$tmpfile\&quot;&quot;;
-    }
-    else {
-      open (LOG_OUT, &quot;&gt;-&quot;) or die &quot;Unable to open stdout for writing&quot;;
-    }
-
-    print LOG_OUT $ChangeLog_Header;
-
-    if ($XML_Output) {
-      my $encoding    = 
-        length $XML_Encoding ? qq'encoding=&quot;$XML_Encoding&quot;' : '';
-      my $version     = 'version=&quot;1.0&quot;';
-      my $declaration = 
-        sprintf '&lt;?xml %s?&gt;', join ' ', grep length, $version, $encoding;
-      my $root        =
-        '&lt;changelog xmlns=&quot;<A HREF="http://www.red-bean.com/xmlns/cvs2cl/">http://www.red-bean.com/xmlns/cvs2cl/</A>&quot;&gt;';
-      print LOG_OUT &quot;$declaration\n\n$root\n\n&quot;;
-    }
-
-    foreach my $time (sort {$main::b &lt;=&gt; $main::a} (keys %changelog))
-    {
-      next if ($Delta_Mode &amp;&amp;
-	       (($time &lt;= $Delta_StartTime) ||
-		($time &gt; $Delta_EndTime &amp;&amp; $Delta_EndTime)));
-
-      # Set up the date/author line.
-      # kff todo: do some more XML munging here, on the header
-      # part of the entry:
-      my ($ignore,$min,$hour,$mday,$mon,$year,$wday)
-          = $UTC_Times ? gmtime($time) : localtime($time);
-
-      # XML output includes everything else, we might as well make
-      # it always include Day Of Week too, for consistency.
-      if ($Show_Day_Of_Week or $XML_Output) {
-        $wday = (&quot;Sunday&quot;, &quot;Monday&quot;, &quot;Tuesday&quot;, &quot;Wednesday&quot;,
-                 &quot;Thursday&quot;, &quot;Friday&quot;, &quot;Saturday&quot;)[$wday];
-        $wday = ($XML_Output) ? &quot;&lt;weekday&gt;${wday}&lt;/weekday&gt;\n&quot; : &quot; $wday&quot;;
-      }
-      else {
-        $wday = &quot;&quot;;
-      }
-
-      my $authorhash = $changelog{$time};
-      if ($Show_Tag_Dates) {
-        my %tags;
-        while (my ($author,$mesghash) = each %$authorhash) {
-          while (my ($msg,$qunk) = each %$mesghash) {
-            foreach my $qunkref2 (@$qunk) {
-	      if (defined ($$qunkref2{'tags'})) {
-                foreach my $tag (@{$$qunkref2{'tags'}}) {
-                  $tags{$tag} = 1;
-                }
-              }
-	    }
-          }
-        }
-        foreach my $tag (keys %tags) {
-          if (!defined $tag_date_printed{$tag}) {
-            $tag_date_printed{$tag} = $time;
-            if ($XML_Output) {
-              # NOT YET DONE
-            }
-            else {
-              printf LOG_OUT (&quot;%4u-%02u-%02u${wday} %02u:%02u  tag %s\n\n&quot;,
-                              $year+1900, $mon+1, $mday, $hour, $min, $tag);
-            }
-          }
-        }
-      }
-      while (my ($author,$mesghash) = each %$authorhash)
-      {
-        # If XML, escape in outer loop to avoid compound quoting:
-        if ($XML_Output) {
-          $author = &amp;xml_escape ($author);
-        }
-
-      FOOBIE:
-        while (my ($msg,$qunklist) = each %$mesghash)
-        {
-          ## MJP: 19.xii.01 : Exclude @ignore_tags
-          for my $ignore_tag (@ignore_tags) {
-            next FOOBIE
-              if grep $_ eq $ignore_tag, map(@{$_-&gt;{tags}},
-                                             grep(defined $_-&gt;{tags},
-                                                  @$qunklist));
-          }
-          ## MJP: 19.xii.01 : End exclude @ignore_tags
-
-          my $files               = &amp;pretty_file_list ($qunklist);
-          my $header_line;          # date and author
-          my $body;                 # see below
-          my $wholething;           # $header_line + $body
-
-          if ($XML_Output) {
-            $header_line =
-                sprintf (&quot;&lt;date&gt;%4u-%02u-%02u&lt;/date&gt;\n&quot;
-                         . &quot;${wday}&quot;
-                         . &quot;&lt;time&gt;%02u:%02u&lt;/time&gt;\n&quot;
-                         . &quot;&lt;author&gt;%s&lt;/author&gt;\n&quot;,
-                         $year+1900, $mon+1, $mday, $hour, $min, $author);
-          }
-          else {
-            $header_line =
-                sprintf (&quot;%4u-%02u-%02u${wday} %02u:%02u  %s\n\n&quot;,
-                         $year+1900, $mon+1, $mday, $hour, $min, $author);
-          }
-
-          $Text::Wrap::huge = 'overflow'
-            if $Text::Wrap::VERSION &gt;= 2001.0130;
-          # Reshape the body according to user preferences.
-          if ($XML_Output)
-          {
-            $msg = &amp;preprocess_msg_text ($msg);
-            $body = $files . $msg;
-          }
-          elsif ($No_Wrap)
-          {
-            $msg = &amp;preprocess_msg_text ($msg);
-            $files = wrap (&quot;\t&quot;, &quot;	&quot;, &quot;$files&quot;);
-            $msg =~ s/\n(.*)/\n\t$1/g;
-            unless ($After_Header eq &quot; &quot;) {
-              $msg =~ s/^(.*)/\t$1/g;
-            }
-            $body = $files . $After_Header . $msg;
-          }
-          else  # do wrapping, either FSF-style or regular
-          {
-            if ($FSF_Style)
-            {
-              $files = wrap (&quot;\t&quot;, &quot;        &quot;, &quot;$files&quot;);
-
-              my $files_last_line_len = 0;
-              if ($After_Header eq &quot; &quot;)
-              {
-                $files_last_line_len = &amp;last_line_len ($files);
-                $files_last_line_len += 1;  # for $After_Header
-              }
-
-              $msg = &amp;wrap_log_entry
-                  ($msg, &quot;\t&quot;, 69 - $files_last_line_len, 69);
-              $body = $files . $After_Header . $msg;
-            }
-            else  # not FSF-style
-            {
-              $msg = &amp;preprocess_msg_text ($msg);
-              $body = $files . $After_Header . $msg;
-              $body = wrap (&quot;\t&quot;, &quot;        &quot;, &quot;$body&quot;);
-            }
-          }
-
-          $wholething = $header_line . $body;
-
-          if ($XML_Output) {
-            $wholething = &quot;&lt;entry&gt;\n${wholething}&lt;/entry&gt;\n&quot;;
-          }
-
-          # One last check: make sure it passes the regexp test, if the
-          # user asked for that.  We have to do it here, so that the
-          # test can match against information in the header as well
-          # as in the text of the log message.
-
-          # How annoying to duplicate so much code just because I
-          # can't figure out a way to evaluate scalars on the trailing
-          # operator portion of a regular expression.  Grrr.
-          if ($Case_Insensitive) {
-            unless ($Regexp_Gate &amp;&amp; ($wholething !~ /$Regexp_Gate/oi)) {
-              print LOG_OUT &quot;${wholething}\n&quot;;
-            }
-          }
-          else {
-            unless ($Regexp_Gate &amp;&amp; ($wholething !~ /$Regexp_Gate/o)) {
-              print LOG_OUT &quot;${wholething}\n&quot;;
-            }
-          }
-        }
-      }
-    }
-
-    if ($XML_Output) {
-      print LOG_OUT &quot;&lt;/changelog&gt;\n&quot;;
-    }
-
-    close (LOG_OUT);
-
-    if (! $Output_To_Stdout)
-    {
-      # If accumulating, append old data to new before renaming.  But
-      # don't append the most recent entry, since it's already in the
-      # new log due to CVS's idiosyncratic interpretation of &quot;log -d&quot;.
-      if ($Cumulative &amp;&amp; -f $logfile_here)
-      {
-        open (NEW_LOG, &quot;&gt;&gt;$tmpfile&quot;)
-            or die &quot;trouble appending to $tmpfile ($!)&quot;;
-
-        open (OLD_LOG, &quot;&lt;$logfile_here&quot;)
-            or die &quot;trouble reading from $logfile_here ($!)&quot;;
-
-        my $started_first_entry = 0;
-        my $passed_first_entry = 0;
-        while (&lt;OLD_LOG&gt;)
-        {
-          if (! $passed_first_entry)
-          {
-            if ((! $started_first_entry)
-                &amp;&amp; /^(\d\d\d\d-\d\d-\d\d\s+\d\d:\d\d)/) {
-              $started_first_entry = 1;
-            }
-            elsif (/^(\d\d\d\d-\d\d-\d\d\s+\d\d:\d\d)/) {
-              $passed_first_entry = 1;
-              print NEW_LOG $_;
-            }
-          }
-          else {
-            print NEW_LOG $_;
-          }
-        }
-
-        close (NEW_LOG);
-        close (OLD_LOG);
-      }
-
-      if (-f $logfile_here) {
-        rename ($logfile_here, $logfile_bak);
-      }
-      rename ($tmpfile, $logfile_here);
-    }
-  }
-}
-
-
-sub parse_date_and_author ()
-{
-  # Parses the date/time and author out of a line like:
-  #
-  # date: 1999/02/19 23:29:05;  author: apharris;  state: Exp;
-
-  my $line = shift;
-
-  my ($year, $mon, $mday, $hours, $min, $secs, $author) = $line =~
-      m#(\d+)/(\d+)/(\d+)\s+(\d+):(\d+):(\d+);\s+author:\s+([^;]+);#
-          or  die &quot;Couldn't parse date ``$line''&quot;;
-  die &quot;Bad date or Y2K issues&quot; unless ($year &gt; 1969 and $year &lt; 2258);
-  # Kinda arbitrary, but useful as a sanity check
-  my $time = timegm($secs,$min,$hours,$mday,$mon-1,$year-1900);
-
-  return ($time, $author);
-}
-
-
-# Here we take a bunch of qunks and convert them into printed
-# summary that will include all the information the user asked for.
-sub pretty_file_list ()
-{
-  if ($Hide_Filenames and (! $XML_Output)) {
-    return &quot;&quot;;
-  }
-
-  my $qunksref = shift;
-  my @qunkrefs = @$qunksref;
-  my @filenames;
-  my $beauty = &quot;&quot;;          # The accumulating header string for this entry.
-  my %non_unanimous_tags;   # Tags found in a proper subset of qunks
-  my %unanimous_tags;       # Tags found in all qunks
-  my %all_branches;         # Branches found in any qunk
-  my $common_dir = undef;   # Dir prefix common to all files (&quot;&quot; if none)
-  my $fbegun = 0;           # Did we begin printing filenames yet?
-
-  # First, loop over the qunks gathering all the tag/branch names.
-  # We'll put them all in non_unanimous_tags, and take out the
-  # unanimous ones later.
- QUNKREF:
-  foreach my $qunkref (@qunkrefs)
-  {
-    ## MJP: 19.xii.01 : Exclude @ignore_tags
-    for my $ignore_tag (@ignore_tags) {
-      next QUNKREF
-        if grep $_ eq $ignore_tag, @{$$qunkref{'tags'}};
-    }
-    ## MJP: 19.xii.01 : End exclude @ignore_tags
-
-    # Keep track of whether all the files in this commit were in the
-    # same directory, and memorize it if so.  We can make the output a
-    # little more compact by mentioning the directory only once.
-    if ((scalar (@qunkrefs)) &gt; 1)
-    {
-      if (! (defined ($common_dir)))
-      {
-        my ($base, $dir);
-        ($base, $dir, undef) = fileparse ($$qunkref{'filename'});
-
-        if ((! (defined ($dir)))  # this first case is sheer paranoia
-            or ($dir eq &quot;&quot;)
-            or ($dir eq &quot;./&quot;)
-            or ($dir eq &quot;.\\&quot;))
-        {
-          $common_dir = &quot;&quot;;
-        }
-        else
-        {
-          $common_dir = $dir;
-        }
-      }
-      elsif ($common_dir ne &quot;&quot;)
-      {
-        # Already have a common dir prefix, so how much of it can we preserve?
-        $common_dir = &amp;common_path_prefix ($$qunkref{'filename'}, $common_dir);
-      }
-    }
-    else  # only one file in this entry anyway, so common dir not an issue
-    {
-      $common_dir = &quot;&quot;;
-    }
-
-    if (defined ($$qunkref{'branch'})) {
-      $all_branches{$$qunkref{'branch'}} = 1;
-    }
-    if (defined ($$qunkref{'tags'})) {
-      foreach my $tag (@{$$qunkref{'tags'}}) {
-        $non_unanimous_tags{$tag} = 1;
-      }
-    }
-  }
-
-  # Any tag held by all qunks will be printed specially... but only if
-  # there are multiple qunks in the first place!
-  if ((scalar (@qunkrefs)) &gt; 1) {
-    foreach my $tag (keys (%non_unanimous_tags)) {
-      my $everyone_has_this_tag = 1;
-      foreach my $qunkref (@qunkrefs) {
-        if ((! (defined ($$qunkref{'tags'})))
-            or (! (grep ($_ eq $tag, @{$$qunkref{'tags'}})))) {
-          $everyone_has_this_tag = 0;
-        }
-      }
-      if ($everyone_has_this_tag) {
-        $unanimous_tags{$tag} = 1;
-        delete $non_unanimous_tags{$tag};
-      }
-    }
-  }
-
-  if ($XML_Output)
-  {
-    # If outputting XML, then our task is pretty simple, because we
-    # don't have to detect common dir, common tags, branch prefixing,
-    # etc.  We just output exactly what we have, and don't worry about
-    # redundancy or readability.
-
-    foreach my $qunkref (@qunkrefs)
-    {
-      my $filename    = $$qunkref{'filename'};
-      my $revision    = $$qunkref{'revision'};
-      my $tags        = $$qunkref{'tags'};
-      my $branch      = $$qunkref{'branch'};
-      my $branchroots = $$qunkref{'branchroots'};
-
-      $filename = &amp;xml_escape ($filename);   # probably paranoia
-      $revision = &amp;xml_escape ($revision);   # definitely paranoia
-
-      $beauty .= &quot;&lt;file&gt;\n&quot;;
-      $beauty .= &quot;&lt;name&gt;${filename}&lt;/name&gt;\n&quot;;
-      $beauty .= &quot;&lt;revision&gt;${revision}&lt;/revision&gt;\n&quot;;
-      if ($branch) {
-        $branch   = &amp;xml_escape ($branch);     # more paranoia
-        $beauty .= &quot;&lt;branch&gt;${branch}&lt;/branch&gt;\n&quot;;
-      }
-      foreach my $tag (@$tags) {
-        $tag = &amp;xml_escape ($tag);  # by now you're used to the paranoia
-        $beauty .= &quot;&lt;tag&gt;${tag}&lt;/tag&gt;\n&quot;;
-      }
-      foreach my $root (@$branchroots) {
-        $root = &amp;xml_escape ($root);  # which is good, because it will continue
-        $beauty .= &quot;&lt;branchroot&gt;${root}&lt;/branchroot&gt;\n&quot;;
-      }
-      $beauty .= &quot;&lt;/file&gt;\n&quot;;
-    }
-
-    # Theoretically, we could go home now.  But as long as we're here,
-    # let's print out the common_dir and utags, as a convenience to
-    # the receiver (after all, earlier code calculated that stuff
-    # anyway, so we might as well take advantage of it).
-
-    if ((scalar (keys (%unanimous_tags))) &gt; 1) {
-      foreach my $utag ((keys (%unanimous_tags))) {
-        $utag = &amp;xml_escape ($utag);   # the usual paranoia
-        $beauty .= &quot;&lt;utag&gt;${utag}&lt;/utag&gt;\n&quot;;
-      }
-    }
-    if ($common_dir) {
-      $common_dir = &amp;xml_escape ($common_dir);
-      $beauty .= &quot;&lt;commondir&gt;${common_dir}&lt;/commondir&gt;\n&quot;;
-    }
-
-    # That's enough for XML, time to go home:
-    return $beauty;
-  }
-
-  # Else not XML output, so complexly compactify for chordate
-  # consumption.  At this point we have enough global information
-  # about all the qunks to organize them non-redundantly for output.
-
-  if ($common_dir) {
-    # Note that $common_dir still has its trailing slash
-    $beauty .= &quot;$common_dir: &quot;;
-  }
-
-  if ($Show_Branches)
-  {
-    # For trailing revision numbers.
-    my @brevisions;
-
-    foreach my $branch (keys (%all_branches))
-    {
-      foreach my $qunkref (@qunkrefs)
-      {
-        if ((defined ($$qunkref{'branch'}))
-            and ($$qunkref{'branch'} eq $branch))
-        {
-          if ($fbegun) {
-            # kff todo: comma-delimited in XML too?  Sure.
-            $beauty .= &quot;, &quot;;
-          }
-          else {
-            $fbegun = 1;
-          }
-          my $fname = substr ($$qunkref{'filename'}, length ($common_dir));
-          $beauty .= $fname;
-          $$qunkref{'printed'} = 1;  # Just setting a mark bit, basically
-
-          if ($Show_Tags &amp;&amp; (defined @{$$qunkref{'tags'}})) {
-            my @tags = grep ($non_unanimous_tags{$_}, @{$$qunkref{'tags'}});
-
-            if (@tags) {
-              $beauty .= &quot; (tags: &quot;;
-              $beauty .= join (', ', @tags);
-              $beauty .= &quot;)&quot;;
-            }
-          }
-
-          if ($Show_Revisions) {
-            # Collect the revision numbers' last components, but don't
-            # print them -- they'll get printed with the branch name
-            # later.
-            $$qunkref{'revision'} =~ /.+\.([\d]+)$/;
-            push (@brevisions, $1);
-
-            # todo: we're still collecting branch roots, but we're not
-            # showing them anywhere.  If we do show them, it would be
-            # nifty to just call them revision &quot;0&quot; on a the branch.
-            # Yeah, that's the ticket.
-          }
-        }
-      }
-      $beauty .= &quot; ($branch&quot;;
-      if (@brevisions) {
-        if ((scalar (@brevisions)) &gt; 1) {
-          $beauty .= &quot;.[&quot;;
-          $beauty .= (join (',', @brevisions));
-          $beauty .= &quot;]&quot;;
-        }
-        else {
-          $beauty .= &quot;.[$brevisions[0]]&quot;;
-        }
-      }
-      $beauty .= &quot;)&quot;;
-    }
-  }
-
-  # Okay; any qunks that were done according to branch are taken care
-  # of, and marked as printed.  Now print everyone else.
-
-  foreach my $qunkref (@qunkrefs)
-  {
-    next if (defined ($$qunkref{'printed'}));   # skip if already printed
-
-    if ($fbegun) {
-      $beauty .= &quot;, &quot;;
-    }
-    else {
-      $fbegun = 1;
-    }
-    $beauty .= substr ($$qunkref{'filename'}, length ($common_dir));
-    # todo: Shlomo's change was this:
-    # $beauty .= substr ($$qunkref{'filename'},
-    #              (($common_dir eq &quot;./&quot;) ? &quot;&quot; : length ($common_dir)));
-    $$qunkref{'printed'} = 1;  # Set a mark bit.
-
-    if ($Show_Revisions || $Show_Tags)
-    {
-      my $started_addendum = 0;
-
-      if ($Show_Revisions) {
-        $started_addendum = 1;
-        $beauty .= &quot; (&quot;;
-        $beauty .= &quot;$$qunkref{'revision'}&quot;;
-      }
-      if ($Show_Tags &amp;&amp; (defined $$qunkref{'tags'})) {
-        my @tags = grep ($non_unanimous_tags{$_}, @{$$qunkref{'tags'}});
-        if ((scalar (@tags)) &gt; 0) {
-          if ($started_addendum) {
-            $beauty .= &quot;, &quot;;
-          }
-          else {
-            $beauty .= &quot; (tags: &quot;;
-          }
-          $beauty .= join (', ', @tags);
-          $started_addendum = 1;
-        }
-      }
-      if ($started_addendum) {
-        $beauty .= &quot;)&quot;;
-      }
-    }
-  }
-
-  # Unanimous tags always come last.
-  if ($Show_Tags &amp;&amp; %unanimous_tags)
-  {
-    $beauty .= &quot; (utags: &quot;;
-    $beauty .= join (', ', sort keys (%unanimous_tags));
-    $beauty .= &quot;)&quot;;
-  }
-
-  # todo: still have to take care of branch_roots?
-
-  $beauty = &quot;* $beauty:&quot;;
-
-  return $beauty;
-}
-
-
-sub common_path_prefix ()
-{
-  my $path1 = shift;
-  my $path2 = shift;
-
-  my ($dir1, $dir2);
-  (undef, $dir1, undef) = fileparse ($path1);
-  (undef, $dir2, undef) = fileparse ($path2);
-
-  # Transmogrify Windows filenames to look like Unix.
-  # (It is far more likely that someone is running cvs2cl.pl under
-  # Windows than that they would genuinely have backslashes in their
-  # filenames.)
-  $dir1 =~ tr#\\#/#;
-  $dir2 =~ tr#\\#/#;
-
-  my $accum1 = &quot;&quot;;
-  my $accum2 = &quot;&quot;;
-  my $last_common_prefix = &quot;&quot;;
-
-  while ($accum1 eq $accum2)
-  {
-    $last_common_prefix = $accum1;
-    last if ($accum1 eq $dir1);
-    my ($tmp1) = split (/\//, (substr ($dir1, length ($accum1))));
-    my ($tmp2) = split (/\//, (substr ($dir2, length ($accum2))));
-    $accum1 .= &quot;$tmp1/&quot; if (defined $tmp1 and $tmp1 ne '');
-    $accum2 .= &quot;$tmp2/&quot; if (defined $tmp2 and $tmp2 ne '');
-  }
-
-  return $last_common_prefix;
-}
-
-
-sub preprocess_msg_text ()
-{
-  my $text = shift;
-
-  # Strip out carriage returns (as they probably result from DOSsy editors).
-  $text =~ s/\r\n/\n/g;
-
-  # If it *looks* like two newlines, make it *be* two newlines:
-  $text =~ s/\n\s*\n/\n\n/g;
-
-  if ($XML_Output)
-  {
-    $text = &amp;xml_escape ($text);
-    $text = &quot;&lt;msg&gt;${text}&lt;/msg&gt;\n&quot;;
-  }
-  elsif (! $No_Wrap)
-  {
-    # Strip off lone newlines, but only for lines that don't begin with
-    # whitespace or a mail-quoting character, since we want to preserve
-    # that kind of formatting.  Also don't strip newlines that follow a
-    # period; we handle those specially next.  And don't strip
-    # newlines that precede an open paren.
-    1 while ($text =~ s/(^|\n)([^&gt;\s].*[^.\n])\n([^&gt;\n])/$1$2 $3/g);
-
-    # If a newline follows a period, make sure that when we bring up the
-    # bottom sentence, it begins with two spaces.
-    1 while ($text =~ s/(^|\n)([^&gt;\s].*)\n([^&gt;\n])/$1$2  $3/g);
-  }
-
-  return $text;
-}
-
-
-sub last_line_len ()
-{
-  my $files_list = shift;
-  my @lines = split (/\n/, $files_list);
-  my $last_line = pop (@lines);
-  return length ($last_line);
-}
-
-
-# A custom wrap function, sensitive to some common constructs used in
-# log entries.
-sub wrap_log_entry ()
-{
-  my $text = shift;                  # The text to wrap.
-  my $left_pad_str = shift;          # String to pad with on the left.
-
-  # These do NOT take left_pad_str into account:
-  my $length_remaining = shift;      # Amount left on current line.
-  my $max_line_length  = shift;      # Amount left for a blank line.
-
-  my $wrapped_text = &quot;&quot;;             # The accumulating wrapped entry.
-  my $user_indent = &quot;&quot;;              # Inherited user_indent from prev line.
-
-  my $first_time = 1;                # First iteration of the loop?
-  my $suppress_line_start_match = 0; # Set to disable line start checks.
-
-  my @lines = split (/\n/, $text);
-  while (@lines)   # Don't use `foreach' here, it won't work.
-  {
-    my $this_line = shift (@lines);
-    chomp $this_line;
-
-    if ($this_line =~ /^(\s+)/) {
-      $user_indent = $1;
-    }
-    else {
-      $user_indent = &quot;&quot;;
-    }
-
-    # If it matches any of the line-start regexps, print a newline now...
-    if ($suppress_line_start_match)
-    {
-      $suppress_line_start_match = 0;
-    }
-    elsif (($this_line =~ /^(\s*)\*\s+[a-zA-Z0-9]/)
-           || ($this_line =~ /^(\s*)\* [a-zA-Z0-9_\.\/\+-]+/)
-           || ($this_line =~ /^(\s*)\([a-zA-Z0-9_\.\/\+-]+(\)|,\s*)/)
-           || ($this_line =~ /^(\s+)(\S+)/)
-           || ($this_line =~ /^(\s*)- +/)
-           || ($this_line =~ /^()\s*$/)
-           || ($this_line =~ /^(\s*)\*\) +/)
-           || ($this_line =~ /^(\s*)[a-zA-Z0-9](\)|\.|\:) +/))
-    {
-      # Make a line break immediately, unless header separator is set
-      # and this line is the first line in the entry, in which case
-      # we're getting the blank line for free already and shouldn't
-      # add an extra one.
-      unless (($After_Header ne &quot; &quot;) and ($first_time))
-      {
-        if ($this_line =~ /^()\s*$/) {
-          $suppress_line_start_match = 1;
-          $wrapped_text .= &quot;\n${left_pad_str}&quot;;
-        }
-
-        $wrapped_text .= &quot;\n${left_pad_str}&quot;;
-      }
-
-      $length_remaining = $max_line_length - (length ($user_indent));
-    }
-
-    # Now that any user_indent has been preserved, strip off leading
-    # whitespace, so up-folding has no ugly side-effects.
-    $this_line =~ s/^\s*//;
-
-    # Accumulate the line, and adjust parameters for next line.
-    my $this_len = length ($this_line);
-    if ($this_len == 0)
-    {
-      # Blank lines should cancel any user_indent level.
-      $user_indent = &quot;&quot;;
-      $length_remaining = $max_line_length;
-    }
-    elsif ($this_len &gt;= $length_remaining) # Line too long, try breaking it.
-    {
-      # Walk backwards from the end.  At first acceptable spot, break
-      # a new line.
-      my $idx = $length_remaining - 1;
-      if ($idx &lt; 0) { $idx = 0 };
-      while ($idx &gt; 0)
-      {
-        if (substr ($this_line, $idx, 1) =~ /\s/)
-        {
-          my $line_now = substr ($this_line, 0, $idx);
-          my $next_line = substr ($this_line, $idx);
-          $this_line = $line_now;
-
-          # Clean whitespace off the end.
-          chomp $this_line;
-
-          # The current line is ready to be printed.
-          $this_line .= &quot;\n${left_pad_str}&quot;;
-
-          # Make sure the next line is allowed full room.
-          $length_remaining = $max_line_length - (length ($user_indent));
-
-          # Strip next_line, but then preserve any user_indent.
-          $next_line =~ s/^\s*//;
-
-          # Sneak a peek at the user_indent of the upcoming line, so
-          # $next_line (which will now precede it) can inherit that
-          # indent level.  Otherwise, use whatever user_indent level
-          # we currently have, which might be none.
-          my $next_next_line = shift (@lines);
-          if ((defined ($next_next_line)) &amp;&amp; ($next_next_line =~ /^(\s+)/)) {
-            $next_line = $1 . $next_line if (defined ($1));
-            # $length_remaining = $max_line_length - (length ($1));
-            $next_next_line =~ s/^\s*//;
-          }
-          else {
-            $next_line = $user_indent . $next_line;
-          }
-          if (defined ($next_next_line)) {
-            unshift (@lines, $next_next_line);
-          }
-          unshift (@lines, $next_line);
-
-          # Our new next line might, coincidentally, begin with one of
-          # the line-start regexps, so we temporarily turn off
-          # sensitivity to that until we're past the line.
-          $suppress_line_start_match = 1;
-
-          last;
-        }
-        else
-        {
-          $idx--;
-        }
-      }
-
-      if ($idx == 0)
-      {
-        # We bottomed out because the line is longer than the
-        # available space.  But that could be because the space is
-        # small, or because the line is longer than even the maximum
-        # possible space.  Handle both cases below.
-
-        if ($length_remaining == ($max_line_length - (length ($user_indent))))
-        {
-          # The line is simply too long -- there is no hope of ever
-          # breaking it nicely, so just insert it verbatim, with
-          # appropriate padding.
-          $this_line = &quot;\n${left_pad_str}${this_line}&quot;;
-        }
-        else
-        {
-          # Can't break it here, but may be able to on the next round...
-          unshift (@lines, $this_line);
-          $length_remaining = $max_line_length - (length ($user_indent));
-          $this_line = &quot;\n${left_pad_str}&quot;;
-        }
-      }
-    }
-    else  # $this_len &lt; $length_remaining, so tack on what we can.
-    {
-      # Leave a note for the next iteration.
-      $length_remaining = $length_remaining - $this_len;
-
-      if ($this_line =~ /\.$/)
-      {
-        $this_line .= &quot;  &quot;;
-        $length_remaining -= 2;
-      }
-      else  # not a sentence end
-      {
-        $this_line .= &quot; &quot;;
-        $length_remaining -= 1;
-      }
-    }
-
-    # Unconditionally indicate that loop has run at least once.
-    $first_time = 0;
-
-    $wrapped_text .= &quot;${user_indent}${this_line}&quot;;
-  }
-
-  # One last bit of padding.
-  $wrapped_text .= &quot;\n&quot;;
-
-  return $wrapped_text;
-}
-
-
-sub xml_escape ()
-{
-  my $txt = shift;
-  $txt =~ s/&amp;/&amp;/g;
-  $txt =~ s/&lt;/&lt;/g;
-  $txt =~ s/&gt;/&gt;/g;
-  return $txt;
-}
-
-
-sub maybe_read_user_map_file ()
-{
-  my %expansions;
-
-  if ($User_Map_File)
-  {
-    open (MAPFILE, &quot;&lt;$User_Map_File&quot;)
-        or die (&quot;Unable to open $User_Map_File ($!)&quot;);
-
-    while (&lt;MAPFILE&gt;)
-    {
-      next if /^\s*#/;  # Skip comment lines.
-      next if not /:/;  # Skip lines without colons.
-
-      # It is now safe to split on ':'.
-      my ($username, $expansion) = split ':';
-      chomp $expansion;
-      $expansion =~ s/^'(.*)'$/$1/;
-      $expansion =~ s/^&quot;(.*)&quot;$/$1/;
-
-      # If it looks like the expansion has a real name already, then
-      # we toss the username we got from CVS log.  Otherwise, keep
-      # it to use in combination with the email address.
-
-      if ($expansion =~ /^\s*&lt;{0,1}\<A HREF="https://lists.berlios.de/mailman/listinfo/upwatch-commits">S+ at .</A>*/) {
-        # Also, add angle brackets if none present
-        if (! ($expansion =~ /&lt;\S+@\S+&gt;/)) {
-          $expansions{$username} = &quot;$username &lt;$expansion&gt;&quot;;
-        }
-        else {
-          $expansions{$username} = &quot;$username $expansion&quot;;
-        }
-      }
-      else {
-        $expansions{$username} = $expansion;
-      }
-    }
-
-    close (MAPFILE);
-  }
-
-  return %expansions;
-}
-
-
-sub parse_options ()
-{
-  # Check this internally before setting the global variable.
-  my $output_file;
-
-  # If this gets set, we encountered unknown options and will exit at
-  # the end of this subroutine.
-  my $exit_with_admonishment = 0;
-
-  while (my $arg = shift (@ARGV))
-  {
-    if ($arg =~ /^-h$|^-help$|^--help$|^--usage$|^-?$/) {
-      $Print_Usage = 1;
-    }
-    elsif ($arg =~ /^--delta$/) {
-      my $narg = shift(@ARGV) || die &quot;$arg needs argument.\n&quot;;
-      if ($narg =~ /^([A-Za-z][A-Za-z0-9_\-]*):([A-Za-z][A-Za-z0-9_\-]*)$/) {
-	$Delta_From = $1;
-	$Delta_To = $2;
-	$Delta_Mode = 1;
-      } else {
-	die &quot;--delta FROM_TAG:TO_TAG is what you meant to say.\n&quot;;
-      }
-    }
-    elsif ($arg =~ /^--debug$/) {        # unadvertised option, heh
-      $Debug = 1;
-    }
-    elsif ($arg =~ /^--version$/) {
-      $Print_Version = 1;
-    }
-    elsif ($arg =~ /^-g$|^--global-opts$/) {
-      my $narg = shift (@ARGV) || die &quot;$arg needs argument.\n&quot;;
-      # Don't assume CVS is called &quot;cvs&quot; on the user's system:
-      $Log_Source_Command =~ s/(^\S*)/$1 $narg/;
-    }
-    elsif ($arg =~ /^-l$|^--log-opts$/) {
-      my $narg = shift (@ARGV) || die &quot;$arg needs argument.\n&quot;;
-      $Log_Source_Command .= &quot; $narg&quot;;
-    }
-    elsif ($arg =~ /^-f$|^--file$/) {
-      my $narg = shift (@ARGV) || die &quot;$arg needs argument.\n&quot;;
-      $output_file = $narg;
-    }
-    elsif ($arg =~ /^--accum$/) {
-      $Cumulative = 1;
-    }
-    elsif ($arg =~ /^--fsf$/) {
-      $FSF_Style = 1;
-    }
-    elsif ($arg =~ /^-U$|^--usermap$/) {
-      my $narg = shift (@ARGV) || die &quot;$arg needs argument.\n&quot;;
-      $User_Map_File = $narg;
-    }
-    elsif ($arg =~ /^-W$|^--window$/) {
-      defined(my $narg = shift (@ARGV)) || die &quot;$arg needs argument.\n&quot;;
-      $Max_Checkin_Duration = $narg;
-    }
-    elsif ($arg =~ /^-I$|^--ignore$/) {
-      my $narg = shift (@ARGV) || die &quot;$arg needs argument.\n&quot;;
-      push (@Ignore_Files, $narg);
-    }
-    elsif ($arg =~ /^-C$|^--case-insensitive$/) {
-      $Case_Insensitive = 1;
-    }
-    elsif ($arg =~ /^-R$|^--regexp$/) {
-      my $narg = shift (@ARGV) || die &quot;$arg needs argument.\n&quot;;
-      $Regexp_Gate = $narg;
-    }
-    elsif ($arg =~ /^--stdout$/) {
-      $Output_To_Stdout = 1;
-    }
-    elsif ($arg =~ /^--version$/) {
-      $Print_Version = 1;
-    }
-    elsif ($arg =~ /^-d$|^--distributed$/) {
-      $Distributed = 1;
-    }
-    elsif ($arg =~ /^-P$|^--prune$/) {
-      $Prune_Empty_Msgs = 1;
-    }
-    elsif ($arg =~ /^-S$|^--separate-header$/) {
-      $After_Header = &quot;\n\n&quot;;
-    }
-    elsif ($arg =~ /^--no-wrap$/) {
-      $No_Wrap = 1;
-    }
-    elsif ($arg =~ /^--gmt$|^--utc$/) {
-      $UTC_Times = 1;
-    }
-    elsif ($arg =~ /^-w$|^--day-of-week$/) {
-      $Show_Day_Of_Week = 1;
-    }
-    elsif ($arg =~ /^-r$|^--revisions$/) {
-      $Show_Revisions = 1;
-    }
-    elsif ($arg =~ /^-t$|^--tags$/) {
-      $Show_Tags = 1;
-    }
-    elsif ($arg =~ /^-T$|^--tagdates$/) {
-      $Show_Tag_Dates = 1;
-    }
-    elsif ($arg =~ /^-b$|^--branches$/) {
-      $Show_Branches = 1;
-    }
-    elsif ($arg =~ /^-F$|^--follow$/) {
-      my $narg = shift (@ARGV) || die &quot;$arg needs argument.\n&quot;;
-      push (@Follow_Branches, $narg);
-    }
-    elsif ($arg =~ /^--stdin$/) {
-      $Input_From_Stdin = 1;
-    }
-    elsif ($arg =~ /^--header$/) {
-      my $narg = shift (@ARGV) || die &quot;$arg needs argument.\n&quot;;
-      $ChangeLog_Header = &amp;slurp_file ($narg);
-      if (! defined ($ChangeLog_Header)) {
-        $ChangeLog_Header = &quot;&quot;;
-      }
-    }
-    elsif ($arg =~ /^--xml-encoding$/) {
-      my $narg = shift (@ARGV) || die &quot;$arg needs argument.\n&quot;;
-      $XML_Encoding = $narg ;
-    }
-    elsif ($arg =~ /^--xml$/) {
-      $XML_Output = 1;
-    }
-    elsif ($arg =~ /^--hide-filenames$/) {
-      $Hide_Filenames = 1;
-      $After_Header = &quot;&quot;;
-    }
-    elsif ($arg =~ /^--ignore-tag$/ ) {
-      die &quot;$arg needs argument.\n&quot;
-        unless @ARGV;
-      push @ignore_tags, shift @ARGV;
-    }
-    else {
-      # Just add a filename as argument to the log command
-      $Log_Source_Command .= &quot; '$arg'&quot;;
-    }
-  }
-
-  ## Check for contradictions...
-
-  if ($Output_To_Stdout &amp;&amp; $Distributed) {
-    print STDERR &quot;cannot pass both --stdout and --distributed\n&quot;;
-    $exit_with_admonishment = 1;
-  }
-
-  if ($Output_To_Stdout &amp;&amp; $output_file) {
-    print STDERR &quot;cannot pass both --stdout and --file\n&quot;;
-    $exit_with_admonishment = 1;
-  }
-
-  if ($XML_Output &amp;&amp; $Cumulative) {
-    print STDERR &quot;cannot pass both --xml and --accum\n&quot;;
-    $exit_with_admonishment = 1;
-  }
-
-  # Or if any other error message has already been printed out, we
-  # just leave now:
-  if ($exit_with_admonishment) {
-    &amp;usage ();
-    exit (1);
-  }
-  elsif ($Print_Usage) {
-    &amp;usage ();
-    exit (0);
-  }
-  elsif ($Print_Version) {
-    &amp;version ();
-    exit (0);
-  }
-
-  ## Else no problems, so proceed.
-
-  if ($output_file) {
-    $Log_File_Name = $output_file;
-  }
-}
-
-
-sub slurp_file ()
-{
-  my $filename = shift || die (&quot;no filename passed to slurp_file()&quot;);
-  my $retstr;
-
-  open (SLURPEE, &quot;&lt;${filename}&quot;) or die (&quot;unable to open $filename ($!)&quot;);
-  my $saved_sep = $/;
-  undef $/;
-  $retstr = &lt;SLURPEE&gt;;
-  $/ = $saved_sep;
-  close (SLURPEE);
-  return $retstr;
-}
-
-
-sub debug ()
-{
-  if ($Debug) {
-    my $msg = shift;
-    print STDERR $msg;
-  }
-}
-
-
-sub version ()
-{
-  print &quot;cvs2cl.pl version ${VERSION}; distributed under the GNU GPL.\n&quot;;
-}
-
-
-sub usage ()
-{
-  &amp;version ();
-  print &lt;&lt;'END_OF_INFO';
-Generate GNU-style ChangeLogs in CVS working copies.
-
-Notes about the output format(s):
-
-   The default output of cvs2cl.pl is designed to be compact, formally
-   unambiguous, but still easy for humans to read.  It is largely
-   self-explanatory, I hope; the one abbreviation that might not be
-   obvious is &quot;utags&quot;.  That stands for &quot;universal tags&quot; -- a
-   universal tag is one held by all the files in a given change entry.
-
-   If you need output that's easy for a program to parse, use the
-   --xml option.  Note that with XML output, just about all available
-   information is included with each change entry, whether you asked
-   for it or not, on the theory that your parser can ignore anything
-   it's not looking for.
-
-Notes about the options and arguments (the actual options are listed
-last in this usage message):
-
-  * The -I and -F options may appear multiple times.
-
-  * To follow trunk revisions, use &quot;-F trunk&quot; (&quot;-F TRUNK&quot; also works).
-    This is okay because no would ever, ever be crazy enough to name a
-    branch &quot;trunk&quot;, right?  Right.
-
-  * For the -U option, the UFILE should be formatted like
-    CVSROOT/users. That is, each line of UFILE looks like this
-       jrandom:<A HREF="https://lists.berlios.de/mailman/listinfo/upwatch-commits">jrandom at red-bean.com</A>
-    or maybe even like this
-       jrandom:'Jesse Q. Random &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/upwatch-commits">jrandom at red-bean.com</A>&gt;'
-    Don't forget to quote the portion after the colon if necessary.
-
-  * Many people want to filter by date.  To do so, invoke cvs2cl.pl
-    like this:
-       cvs2cl.pl -l &quot;-d'DATESPEC'&quot;
-    where DATESPEC is any date specification valid for &quot;cvs log -d&quot;.
-    (Note that CVS 1.10.7 and below requires there be no space between
-    -d and its argument).
-
-Options/Arguments:
-
-  -h, -help, --help, or -?     Show this usage and exit
-  --version                    Show version and exit
-  -r, --revisions              Show revision numbers in output
-  -b, --branches               Show branch names in revisions when possible
-  -t, --tags                   Show tags (symbolic names) in output
-  -T, --tagdates               Show tags in output on their first occurance
-  --stdin                      Read from stdin, don't run cvs log
-  --stdout                     Output to stdout not to ChangeLog
-  -d, --distributed            Put ChangeLogs in subdirs
-  -f FILE, --file FILE         Write to FILE instead of &quot;ChangeLog&quot;
-  --fsf                        Use this if log data is in FSF ChangeLog style
-  -W SECS, --window SECS       Window of time within which log entries unify
-  -U UFILE, --usermap UFILE    Expand usernames to email addresses from UFILE
-  -R REGEXP, --regexp REGEXP   Include only entries that match REGEXP
-  -I REGEXP, --ignore REGEXP   Ignore files whose names match REGEXP
-  -C, --case-insensitive       Any regexp matching is done case-insensitively
-  -F BRANCH, --follow BRANCH   Show only revisions on or ancestral to BRANCH
-  -S, --separate-header        Blank line between each header and log message
-  --no-wrap                    Don't auto-wrap log message (recommend -S also)
-  --gmt, --utc                 Show times in GMT/UTC instead of local time
-  --accum                      Add to an existing ChangeLog (incompat w/ --xml)
-  -w, --day-of-week            Show day of week
-  --header FILE                Get ChangeLog header from FILE (&quot;-&quot; means stdin)
-  --xml                        Output XML instead of ChangeLog format
-  --xml-encoding ENCODING      Insert encoding clause in XML header
-  --hide-filenames             Don't show filenames (ignored for XML output)
-  -P, --prune                  Don't show empty log messages
-  -g OPTS, --global-opts OPTS  Invoke like this &quot;cvs OPTS log ...&quot;
-  -l OPTS, --log-opts OPTS     Invoke like this &quot;cvs ... log OPTS&quot;
-  FILE1 [FILE2 ...]            Show only log information for the named FILE(s)
-
-See <A HREF="http://www.red-bean.com/cvs2cl">http://www.red-bean.com/cvs2cl</A> for maintenance and bug info.
-END_OF_INFO
-}
-
-__END__
-
-=head1 NAME
-
-cvs2cl.pl - produces GNU-style ChangeLogs in CVS working copies, by
-    running &quot;cvs log&quot; and parsing the output.  Shared log entries are
-    unified in an intuitive way.
-
-=head1 DESCRIPTION
-
-This script generates GNU-style ChangeLog files from CVS log
-information.  Basic usage: just run it inside a working copy and a
-ChangeLog will appear.  It requires repository access (i.e., 'cvs log'
-must work).  Run &quot;cvs2cl.pl --help&quot; to see more advanced options.
-
-See <A HREF="http://www.red-bean.com/cvs2cl">http://www.red-bean.com/cvs2cl</A> for updates, and for instructions
-on getting anonymous CVS access to this script.
-
-Maintainer: Karl Fogel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/upwatch-commits">kfogel at red-bean.com</A>&gt;
-Please report bugs to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/upwatch-commits">bug-cvs2cl at red-bean.com</A>&gt;.
-
-=head1 README
-
-This script generates GNU-style ChangeLog files from CVS log
-information.  Basic usage: just run it inside a working copy and a
-ChangeLog will appear.  It requires repository access (i.e., 'cvs log'
-must work).  Run &quot;cvs2cl.pl --help&quot; to see more advanced options.
-
-See <A HREF="http://www.red-bean.com/cvs2cl">http://www.red-bean.com/cvs2cl</A> for updates, and for instructions
-on getting anonymous CVS access to this script.
-
-Maintainer: Karl Fogel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/upwatch-commits">kfogel at red-bean.com</A>&gt;
-Please report bugs to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/upwatch-commits">bug-cvs2cl at red-bean.com</A>&gt;.
-
-=head1 PREREQUISITES
-
-This script requires C&lt;Text::Wrap&gt;, C&lt;Time::Local&gt;, and
-C&lt;File::Basename&gt;.
-It also seems to require C&lt;Perl 5.004_04&gt; or higher.
-
-=pod OSNAMES
-
-any
-
-=pod SCRIPT CATEGORIES
-
-Version_Control/CVS
-
-=cut
-
-
--*- -*- -*- -*- -*- -*- -*- -*- -*- -*- -*- -*- -*- -*- -*- -*- -*- -*-
-
-Note about a bug-slash-opportunity:
------------------------------------
-
-There's a bug in Text::Wrap, which affects cvs2cl.  This script
-reveals it:
-
-  #!/usr/bin/perl -w
-
-  use Text::Wrap;
-
-  my $test_text =
-  &quot;This script demonstrates a bug in Text::Wrap.  The very long line
-  following this paragraph will be relocated relative to the surrounding
-  text:
-
-  ====================================================================
-
-  See?  When the bug happens, we'll get the line of equal signs below
-  this paragraph, even though it should be above.&quot;;
-
-
-  # Print out the test text with no wrapping:
-  print &quot;$test_text&quot;;
-  print &quot;\n&quot;;
-  print &quot;\n&quot;;
-
-  # Now print it out wrapped, and see the bug:
-  print wrap (&quot;\t&quot;, &quot;        &quot;, &quot;$test_text&quot;);
-  print &quot;\n&quot;;
-  print &quot;\n&quot;;
-
-If the line of equal signs were one shorter, then the bug doesn't
-happen.  Interesting.
-
-Anyway, rather than fix this in Text::Wrap, we might as well write a
-new wrap() which has the following much-needed features:
-
-* initial indentation, like current Text::Wrap()
-* subsequent line indentation, like current Text::Wrap()
-* user chooses among: force-break long words, leave them alone, or die()?
-* preserve existing indentation: chopped chunks from an indented line
-  are indented by same (like this line, not counting the asterisk!)
-* optional list of things to preserve on line starts, default &quot;&gt;&quot;
-
-Note that the last two are essentially the same concept, so unify in
-implementation and give a good interface to controlling them.
-
-And how about:
-
-Optionally, when encounter a line pre-indented by same as previous
-line, then strip the newline and refill, but indent by the same.
-Yeah...

Modified: upwatch/libdbi/common/Makefile.am
===================================================================
--- upwatch/libdbi/common/Makefile.am	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/common/Makefile.am	2006-07-21 23:12:45 UTC (rev 633)
@@ -2,6 +2,5 @@
 
 EXTRA_DIST = db.c generic_options.def dbase_options.def \
   main.c man1.tpl spec.tpl init.tpl minimal_options.def \
-  probe.tpl probe_generic.def common.h license_proprietary.def \
-  license_gpl.def
+  probe.tpl probe_generic.def common.h license_gpl.def
 

Deleted: upwatch/libdbi/common/license_proprietary.def
===================================================================
--- upwatch/libdbi/common/license_proprietary.def	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/common/license_proprietary.def	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,9 +0,0 @@
-copyright = {
-  date = &quot;2002-2004&quot;;
-  author=  &quot;Ron Arts&quot;;
-  owner = &quot;Upwatch BV&quot;;
-  eaddr = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/upwatch-commits">info at upwatch.com</A>&quot;;
-  type = &quot;NOTE&quot;;
-  text = 
-'Redistribution Prohibited. Violation will be prosecuted to the maximum extent possible by applicable law.';
-};

Modified: upwatch/libdbi/common/probe.tpl
===================================================================
--- upwatch/libdbi/common/probe.tpl	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/common/probe.tpl	2006-07-21 23:12:45 UTC (rev 633)
@@ -24,7 +24,7 @@
   delay int unsigned NOT NULL default '1',	-- after this many minutes of red light
   disable enum('yes', 'no') not null default 'no', -- disable this probe
   hide enum('yes', 'no') not null default 'no', -- hide probe results from viewing
-  ipaddress varchar(15) NOT NULL default '127.0.0.1',	-- target ipaddress 
+  ipaddress varchar(128) NOT NULL default '127.0.0.1',	-- target ipaddress or hostname
   description text NOT NULL default '',		-- description
   freq smallint unsigned NOT NULL default '1',	-- frequency in minutes
   yellow float NOT NULL default '[+yellow+]',	-- value for yellow alert

Modified: upwatch/libdbi/compat/Makefile.am
===================================================================
--- upwatch/libdbi/compat/Makefile.am	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/compat/Makefile.am	2006-07-21 23:12:45 UTC (rev 633)
@@ -2,4 +2,4 @@
 SERVERONLY = bb
 endif
 
-SUBDIRS = ${SERVERONLY} sometests
+SUBDIRS = ${SERVERONLY}

Modified: upwatch/libdbi/configure.ac
===================================================================
--- upwatch/libdbi/configure.ac	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/configure.ac	2006-07-21 23:12:45 UTC (rev 633)
@@ -7,6 +7,7 @@
 AM_INIT_AUTOMAKE($PACKAGE,$VERSION)
 AM_CONFIG_HEADER(config.h:config-h.in)
 AC_SUBST(VERSION)
+AM_PROG_AS
 
 AC_DEFINE_UNQUOTED([RELEASE], [&quot;${RELEASE}&quot;], [Package release string])
 
@@ -58,88 +59,89 @@
     if test &quot;$oldincludedir&quot; = '/usr/include' ; 	then oldincludedir='/usr/include' ; fi
     if test &quot;$infodir&quot; = '${prefix}/info' ; 		then infodir='/usr/share/info' ; fi
     if test &quot;$mandir&quot; = '${prefix}/man' ;		then mandir='/usr/share/man' ; fi
+    LDFLAGS=&quot;${LDFLAGS} -L/usr/lib64&quot;
     ;;
   *-*-freebsd*) 
     freebsd=true
-    if test &quot;$bindir&quot; = '${exec_prefix}/bin' ; 		then bindir='/usr/bin' ; fi
-    if test &quot;$sbindir&quot; = '${exec_prefix}/sbin' ; 	then sbindir='/usr/sbin' ; fi
-    if test &quot;$libexecdir&quot; = '${exec_prefix}/libexec';	then libexecdir='/usr/libexec' ; fi
-    if test &quot;$datadir&quot; = '${prefix}/share' ;		then datadir='/usr/local/share' ; fi
-    if test &quot;$sysconfdir&quot; = '${prefix}/etc' ;		then sysconfdir='/etc' ; fi
-    if test &quot;$sharedstatedir&quot; = '${prefix}/com' ;	then sharedstatedir='/usr/local/com' ; fi
-    if test &quot;$localstatedir&quot; = '${prefix}/var' ; 	then localstatedir='/var' ; fi
-    if test &quot;$libdir&quot; = '${exec_prefix}/lib' ; 		then libdir='/usr/lib' ; fi
-    if test &quot;$includedir&quot; = '${prefix}/include' ; 	then includedir='/usr/include' ; fi
-    if test &quot;$oldincludedir&quot; = '/usr/include' ; 	then oldincludedir='/usr/include' ; fi
-    if test &quot;$infodir&quot; = '${prefix}/info' ; 		then infodir='/usr/share/info' ; fi
-    if test &quot;$mandir&quot; = '${prefix}/man' ;		then mandir='/usr/share/man' ; fi
+    if ! test &quot;$bindir&quot; = '${exec_prefix}/bin' ; 		then bindir='/usr//local/bin' ; fi
+    if ! test &quot;$sbindir&quot; = '${exec_prefix}/sbin' ; 	then sbindir='/usr/local/sbin' ; fi
+    if ! test &quot;$libexecdir&quot; = '${exec_prefix}/libexec';	then libexecdir='/usr/local/libexec' ; fi
+    if ! test &quot;$datadir&quot; = '${prefix}/share' ;		then datadir='/usr/local/share' ; fi
+    if ! test &quot;$sysconfdir&quot; = '${prefix}/etc' ;		then sysconfdir='/usr/local/etc' ; fi
+    if ! test &quot;$sharedstatedir&quot; = '${prefix}/com' ;	then sharedstatedir='/usr/local/com' ; fi
+    if ! test &quot;$localstatedir&quot; = '${prefix}/var' ; 	then localstatedir='/var' ; fi
+    if ! test &quot;$libdir&quot; = '${exec_prefix}/lib' ; 		then libdir='/usr/local/lib' ; fi
+    if ! test &quot;$includedir&quot; = '${prefix}/include' ; 	then includedir='/usr/local/include' ; fi
+    if ! test &quot;$oldincludedir&quot; = '/usr/include' ; 	then oldincludedir='/usr/local/include' ; fi
+    if ! test &quot;$infodir&quot; = '${prefix}/info' ; 		then infodir='/usr/local/share/info' ; fi
+    if ! test &quot;$mandir&quot; = '${prefix}/man' ;		then mandir='/usr/local/share/man' ; fi
     CFLAGS=&quot;${CFLAGS} -I/usr/local/include&quot;
     LDFLAGS=&quot;-L/usr/local/lib&quot;
     ;;
   *-*-netbsd*) 
     netbsd=true
-    if test &quot;$bindir&quot; = '${exec_prefix}/bin' ; 		then bindir='/usr/bin' ; fi
-    if test &quot;$sbindir&quot; = '${exec_prefix}/sbin' ; 	then sbindir='/usr/sbin' ; fi
-    if test &quot;$libexecdir&quot; = '${exec_prefix}/libexec';	then libexecdir='/usr/libexec' ; fi
-    if test &quot;$datadir&quot; = '${prefix}/share' ;		then datadir='/usr/local/share' ; fi
-    if test &quot;$sysconfdir&quot; = '${prefix}/etc' ;		then sysconfdir='/etc' ; fi
-    if test &quot;$sharedstatedir&quot; = '${prefix}/com' ;	then sharedstatedir='/usr/local/com' ; fi
-    if test &quot;$localstatedir&quot; = '${prefix}/var' ; 	then localstatedir='/var' ; fi
-    if test &quot;$libdir&quot; = '${exec_prefix}/lib' ; 		then libdir='/usr/lib' ; fi
-    if test &quot;$includedir&quot; = '${prefix}/include' ; 	then includedir='/usr/include' ; fi
-    if test &quot;$oldincludedir&quot; = '/usr/include' ; 	then oldincludedir='/usr/include' ; fi
-    if test &quot;$infodir&quot; = '${prefix}/info' ; 		then infodir='/usr/share/info' ; fi
-    if test &quot;$mandir&quot; = '${prefix}/man' ;		then mandir='/usr/share/man' ; fi
+    if ! test &quot;$bindir&quot; = '${exec_prefix}/bin' ; 		then bindir='/usr/local/bin' ; fi
+    if ! test &quot;$sbindir&quot; = '${exec_prefix}/sbin' ; 	then sbindir='/usr/local/sbin' ; fi
+    if ! test &quot;$libexecdir&quot; = '${exec_prefix}/libexec';	then libexecdir='/usr/local/libexec' ; fi
+    if ! test &quot;$datadir&quot; = '${prefix}/share' ;		then datadir='/usr/local/share' ; fi
+    if ! test &quot;$sysconfdir&quot; = '${prefix}/etc' ;		then sysconfdir='/usr/local/etc' ; fi
+    if ! test &quot;$sharedstatedir&quot; = '${prefix}/com' ;	then sharedstatedir='/usr/local/com' ; fi
+    if ! test &quot;$localstatedir&quot; = '${prefix}/var' ; 	then localstatedir='/var' ; fi
+    if ! test &quot;$libdir&quot; = '${exec_prefix}/lib' ; 		then libdir='/usr/local/lib' ; fi
+    if ! test &quot;$includedir&quot; = '${prefix}/include' ; 	then includedir='/usr/local/include' ; fi
+    if ! test &quot;$oldincludedir&quot; = '/usr/include' ; 	then oldincludedir='/usr/local/include' ; fi
+    if ! test &quot;$infodir&quot; = '${prefix}/info' ; 		then infodir='/usr/local/share/info' ; fi
+    if ! test &quot;$mandir&quot; = '${prefix}/man' ;		then mandir='/usr/local/share/man' ; fi
     CFLAGS=&quot;${CFLAGS} -I/usr/local/include -I/usr/pkg/include&quot;
     LDFLAGS=&quot;-L/usr/local/lib -L/usr/pkg/lib&quot;
     ;;
   *-*-openbsd*)
     openbsd=true
-    if test &quot;$bindir&quot; = '${exec_prefix}/bin' ;          then bindir='/usr/bin' ; fi
-    if test &quot;$sbindir&quot; = '${exec_prefix}/sbin' ;        then sbindir='/usr/sbin' ; fi
-    if test &quot;$libexecdir&quot; = '${exec_prefix}/libexec';   then libexecdir='/usr/libexec' ; fi
-    if test &quot;$datadir&quot; = '${prefix}/share' ;            then datadir='/usr/local/share' ; fi
-    if test &quot;$sysconfdir&quot; = '${prefix}/etc' ;           then sysconfdir='/etc' ; fi
-    if test &quot;$sharedstatedir&quot; = '${prefix}/com' ;       then sharedstatedir='/usr/local/com' ; fi
-    if test &quot;$localstatedir&quot; = '${prefix}/var' ;        then localstatedir='/var' ; fi
-    if test &quot;$libdir&quot; = '${exec_prefix}/lib' ;          then libdir='/usr/lib' ; fi
-    if test &quot;$includedir&quot; = '${prefix}/include' ;       then includedir='/usr/include' ; fi
-    if test &quot;$oldincludedir&quot; = '/usr/include' ;         then oldincludedir='/usr/include' ; fi
-    if test &quot;$infodir&quot; = '${prefix}/info' ;             then infodir='/usr/share/info' ; fi
-    if test &quot;$mandir&quot; = '${prefix}/man' ;               then mandir='/usr/share/man' ; fi
+    if ! test &quot;$bindir&quot; = '${exec_prefix}/bin' ;          then bindir='/usr/local/bin' ; fi
+    if ! test &quot;$sbindir&quot; = '${exec_prefix}/sbin' ;        then sbindir='/usr/local/sbin' ; fi
+    if ! test &quot;$libexecdir&quot; = '${exec_prefix}/libexec';   then libexecdir='/usr/local/libexec' ; fi
+    if ! test &quot;$datadir&quot; = '${prefix}/share' ;            then datadir='/usr/local/share' ; fi
+    if ! test &quot;$sysconfdir&quot; = '${prefix}/etc' ;           then sysconfdir='/etc' ; fi
+    if ! test &quot;$sharedstatedir&quot; = '${prefix}/com' ;       then sharedstatedir='/usr/local/com' ; fi
+    if ! test &quot;$localstatedir&quot; = '${prefix}/var' ;        then localstatedir='/var' ; fi
+    if ! test &quot;$libdir&quot; = '${exec_prefix}/lib' ;          then libdir='/usr/local/lib' ; fi
+    if ! test &quot;$includedir&quot; = '${prefix}/include' ;       then includedir='/usr/local/include' ; fi
+    if ! test &quot;$oldincludedir&quot; = '/usr/include' ;         then oldincludedir='/usr/local/include' ; fi
+    if ! test &quot;$infodir&quot; = '${prefix}/info' ;             then infodir='/usr/local/share/info' ; fi
+    if ! test &quot;$mandir&quot; = '${prefix}/man' ;               then mandir='/usr/local/share/man' ; fi
     CFLAGS=&quot;${CFLAGS} -I/usr/local/include&quot;
     LDFLAGS=&quot;-L/usr/local/lib&quot;
     ;;
   *-*-solaris*)
     solaris=true
-    if test &quot;$bindir&quot; = '${exec_prefix}/bin' ; 		then bindir='/usr/bin' ; fi
-    if test &quot;$sbindir&quot; = '${exec_prefix}/sbin' ; 	then sbindir='/usr/sbin' ; fi
-    if test &quot;$libexecdir&quot; = '${exec_prefix}/libexec';	then libexecdir='/usr/libexec' ; fi
-    if test &quot;$datadir&quot; = '${prefix}/share' ;		then datadir='/usr/share' ; fi
-    if test &quot;$sysconfdir&quot; = '${prefix}/etc' ;		then sysconfdir='/etc' ; fi
-    if test &quot;$sharedstatedir&quot; = '${prefix}/com' ;	then sharedstatedir='/usr/local/com' ; fi
-    if test &quot;$localstatedir&quot; = '${prefix}/var' ; 	then localstatedir='/var' ; fi
-    if test &quot;$libdir&quot; = '${exec_prefix}/lib' ; 		then libdir='/usr/local/lib' ; fi
-    if test &quot;$includedir&quot; = '${prefix}/include' ; 	then includedir='/usr/include' ; fi
-    if test &quot;$oldincludedir&quot; = '/usr/include' ; 	then oldincludedir='/usr/include' ; fi
-    if test &quot;$infodir&quot; = '${prefix}/info';  		then infodir='/usr/share/info' ; fi
-    if test &quot;$mandir&quot; = '${prefix}/man' ;		then mandir='/usr/share/man' ; fi
+    if ! test &quot;$bindir&quot; = '${exec_prefix}/bin' ; 		then bindir='/usr/local/bin' ; fi
+    if ! test &quot;$sbindir&quot; = '${exec_prefix}/sbin' ; 	then sbindir='/usr/local/sbin' ; fi
+    if ! test &quot;$libexecdir&quot; = '${exec_prefix}/libexec';	then libexecdir='/usr/local/libexec' ; fi
+    if ! test &quot;$datadir&quot; = '${prefix}/share' ;		then datadir='/usr/local/share' ; fi
+    if ! test &quot;$sysconfdir&quot; = '${prefix}/etc' ;		then sysconfdir='/etc' ; fi
+    if ! test &quot;$sharedstatedir&quot; = '${prefix}/com' ;	then sharedstatedir='/usr/local/com' ; fi
+    if ! test &quot;$localstatedir&quot; = '${prefix}/var' ; 	then localstatedir='/var' ; fi
+    if ! test &quot;$libdir&quot; = '${exec_prefix}/lib' ; 		then libdir='/usr/local/lib' ; fi
+    if ! test &quot;$includedir&quot; = '${prefix}/include' ; 	then includedir='/usr/local/include' ; fi
+    if ! test &quot;$oldincludedir&quot; = '/usr/include' ; 	then oldincludedir='/usr/local/include' ; fi
+    if ! test &quot;$infodir&quot; = '${prefix}/info';  		then infodir='/usr/local/share/info' ; fi
+    if ! test &quot;$mandir&quot; = '${prefix}/man' ;		then mandir='/usr/local/share/man' ; fi
     LIBS=&quot;-lgen ${LIBS}&quot;
     ;;
   *-*-cygwin*)
     cygwin=true
-    if test &quot;$bindir&quot; = '${exec_prefix}/bin' ; 		then bindir='/usr/bin' ; fi
-    if test &quot;$sbindir&quot; = '${exec_prefix}/sbin' ; 	then sbindir='/usr/sbin' ; fi
-    if test &quot;$libexecdir&quot; = '${exec_prefix}/libexec';	then libexecdir='/usr/libexec' ; fi
-    if test &quot;$datadir&quot; = '${prefix}/share' ;		then datadir='/usr/share' ; fi
-    if test &quot;$sysconfdir&quot; = '${prefix}/etc' ;		then sysconfdir='/etc' ; fi
-    if test &quot;$sharedstatedir&quot; = '${prefix}/com' ;	then sharedstatedir='/usr/local/com' ; fi
-    if test &quot;$localstatedir&quot; = '${prefix}/var' ; 	then localstatedir='/var' ; fi
-    if test &quot;$libdir&quot; = '${exec_prefix}/lib' ; 		then libdir='/usr/local/lib' ; fi
-    if test &quot;$includedir&quot; = '${prefix}/include' ; 	then includedir='/usr/include' ; fi
-    if test &quot;$oldincludedir&quot; = '/usr/include' ; 	then oldincludedir='/usr/include' ; fi
-    if test &quot;$infodir&quot; = '${prefix}/info';  		then infodir='/usr/share/info' ; fi
-    if test &quot;$mandir&quot; = '${prefix}/man' ;		then mandir='/usr/share/man' ; fi
+    if ! test &quot;$bindir&quot; = '${exec_prefix}/bin' ; 		then bindir='/usr/bin' ; fi
+    if ! test &quot;$sbindir&quot; = '${exec_prefix}/sbin' ; 	then sbindir='/usr/sbin' ; fi
+    if ! test &quot;$libexecdir&quot; = '${exec_prefix}/libexec';	then libexecdir='/usr/libexec' ; fi
+    if ! test &quot;$datadir&quot; = '${prefix}/share' ;		then datadir='/usr/share' ; fi
+    if ! test &quot;$sysconfdir&quot; = '${prefix}/etc' ;		then sysconfdir='/etc' ; fi
+    if ! test &quot;$sharedstatedir&quot; = '${prefix}/com' ;	then sharedstatedir='/usr/local/com' ; fi
+    if ! test &quot;$localstatedir&quot; = '${prefix}/var' ; 	then localstatedir='/var' ; fi
+    if ! test &quot;$libdir&quot; = '${exec_prefix}/lib' ; 		then libdir='/usr/local/lib' ; fi
+    if ! test &quot;$includedir&quot; = '${prefix}/include' ; 	then includedir='/usr/include' ; fi
+    if ! test &quot;$oldincludedir&quot; = '/usr/include' ; 	then oldincludedir='/usr/include' ; fi
+    if ! test &quot;$infodir&quot; = '${prefix}/info';  		then infodir='/usr/share/info' ; fi
+    if ! test &quot;$mandir&quot; = '${prefix}/man' ;		then mandir='/usr/share/man' ; fi
     ;;
   *)
     generic=true
@@ -219,7 +221,11 @@
 then
   enable_server=yes
   enable_monitors=yes
-  enable_iptraf=yes
+  case $host in
+    *-*-linux*)
+    enable_iptraf=yes
+    ;;
+  esac
 fi
 
 AM_CONDITIONAL(ENABLE_SERVER, test x$enable_all = xyes)
@@ -302,6 +308,19 @@
     [MYSQL_LIB_PREFIX=/usr/lib/mysql]
 )
 AC_SUBST(MYSQL_LIB_PREFIX)
+
+for libpath in /usr/lib/mysql $MYSQL_LIB_PREFIX /usr/local/lib/mysql /usr/lib /cygdrive/c/mysql/lib/opt /usr/pkg/lib/mysql /usr/lib64/mysql
+do
+  for file in $libpath/libmysqlclient.so* $libpath/mysqlclient.lib
+  do
+    if test -f $file
+    then
+      MYSQL_LIBS=&quot;-L${libpath} -lmysqlclient&quot;
+      break
+    fi
+  done
+done
+
 # path to mysql includes
 AC_ARG_WITH(mysql-include,
     [  --with-mysql-include=&lt;path&gt;        prefix of MySQL headers. Default /usr/include/mysql],
@@ -558,7 +577,7 @@
 if test &quot;$enable_server&quot; = &quot;yes&quot;
 then
 	# libesmtp
-	AC_CHECK_LIB([esmtp], [smtp_create_session], [HAVE_LIBESMTP=1], [HAVE_LIBESMTP=0])
+	AC_CHECK_LIB([esmtp], [smtp_create_session], [HAVE_LIBESMTP=1], [HAVE_LIBESMTP=0], $LIBPTHREAD_LIBS)
 	if test $HAVE_LIBESMTP -eq 1
 	then
 	        LIBESMTP_LIBS=-lesmtp
@@ -707,26 +726,9 @@
 
 if test &quot;$enable_server&quot; = &quot;yes&quot; -o &quot;$enable_monitors&quot; = &quot;yes&quot;
 then
-  AC_CONFIG_FILES([st-1.4/Makefile])
+  AC_CONFIG_FILES([st-1.7/Makefile])
 fi
 
-# server 
-if test &quot;$enable_server&quot; = &quot;yes&quot;
-then
-  AC_CONFIG_FILES([uw_setip/Makefile])
-  AC_CONFIG_FILES([uw_accept/Makefile])
-  AC_CONFIG_FILES([uw_acceptbb/Makefile])
-  AC_CONFIG_FILES([uw_purple/Makefile])
-  AC_CONFIG_FILES([uw_route/Makefile])
-  AC_CONFIG_FILES([uw_process/Makefile])
-  AC_CONFIG_FILES([uw_syncprobes/Makefile])
-  AC_CONFIG_FILES([compat/Makefile])
-  AC_CONFIG_FILES([compat/sometests/Makefile])
-  AC_CONFIG_FILES([compat/sometests/setproctitle/Makefile])
-  AC_CONFIG_FILES([compat/bb/Makefile])
-  AC_CONFIG_FILES([compat/bb/bbhimport/Makefile])
-fi
-
 # monitors
 if test &quot;$enable_monitors&quot; = &quot;yes&quot;
 then
@@ -744,15 +746,29 @@
   AC_CONFIG_FILES([uw_postgresql/Makefile])
 fi
 
-# extra
-if test &quot;$enable_iptraf&quot; = &quot;yes&quot;
+if test &quot;$enable_server&quot; = &quot;yes&quot; -o &quot;$enable_iptraf&quot; = &quot;yes&quot;
 then
 if test $HAVE_LIBPCAP -eq 1; then
   AC_CONFIG_FILES([uw_iptraf/Makefile])
 fi
 fi
 
-( cd libstatgrab ; ./configure --disable-manpages --disable-examples \
+# server 
+if test &quot;$enable_server&quot; = &quot;yes&quot;
+then
+AC_CONFIG_FILES([uw_setip/Makefile])
+AC_CONFIG_FILES([uw_accept/Makefile])
+AC_CONFIG_FILES([uw_acceptbb/Makefile])
+AC_CONFIG_FILES([uw_purple/Makefile])
+AC_CONFIG_FILES([uw_route/Makefile])
+AC_CONFIG_FILES([uw_process/Makefile])
+AC_CONFIG_FILES([uw_syncprobes/Makefile])
+AC_CONFIG_FILES([compat/Makefile])
+AC_CONFIG_FILES([compat/bb/Makefile])
+AC_CONFIG_FILES([compat/bb/bbhimport/Makefile])
+fi
+
+( cd libstatgrab-0.13 ; ./configure --disable-manpages --disable-examples \
   --disable-statgrab --disable-saidar --disable-shared ; cd .. )
 
 if test &quot;$enable_xmbmon&quot; = &quot;yes&quot;

Modified: upwatch/libdbi/doc/about.xml
===================================================================
--- upwatch/libdbi/doc/about.xml	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/doc/about.xml	2006-07-21 23:12:45 UTC (rev 633)
@@ -30,13 +30,15 @@
     &lt;listitem&gt;&lt;para&gt;Extensive and complete documentation, partly generated from source&lt;/para&gt;&lt;/listitem&gt;
     &lt;listitem&gt;&lt;para&gt;Multi-tenanting: multiple companies can run monitoring services for network
     of multiple client-companies using the same backend+probe serverpark&lt;/para&gt;&lt;/listitem&gt;
-    &lt;listitem&gt;&lt;para&gt;OS support: clients available for Linux, Windows, FreeBSD, Solaris, server runs on
-    linux or freeBSD, remote monitoring is linux only.&lt;/para&gt;&lt;/listitem&gt;
+    &lt;listitem&gt;&lt;para&gt;OS support: clients available for Linux, OpenBSD, NetBSD, Windows, FreeBSD, Solaris, server runs on
+    Linux, OpenBSD or NetBSD, remote monitoring is linux only.&lt;/para&gt;&lt;/listitem&gt;
     &lt;listitem&gt;&lt;para&gt;Monitoring results are in XML, and can be pre- and postprocessed&lt;/para&gt;&lt;/listitem&gt;
-    &lt;listitem&gt;&lt;para&gt;Secure: run as ordinary user, developed with security in mind&lt;/para&gt;&lt;/listitem&gt;
+    &lt;listitem&gt;&lt;para&gt;Secure: runs mostly as ordinary user, developed with security in mind&lt;/para&gt;&lt;/listitem&gt;
     &lt;listitem&gt;&lt;para&gt;Compatible with all Big Brother clients, imports bb-hosts file&lt;/para&gt;&lt;/listitem&gt;
+&lt;!-- We have no GUI
     &lt;listitem&gt;&lt;para&gt;GUI is multi-language enabled (uses gettext)&lt;/para&gt;&lt;/listitem&gt;
-    &lt;listitem&gt;&lt;para&gt;GUI has mobile client support&lt;/para&gt;&lt;/listitem&gt;
+    &lt;listitem&gt;&lt;para&gt;GUI has mobile client support&lt;/para&gt;&lt;/listitem&gt; 
+--&gt;
     &lt;listitem&gt;&lt;para&gt;Generates realtime graphs from the database&lt;/para&gt;&lt;/listitem&gt;
     &lt;listitem&gt;&lt;para&gt;Notifications by email or SMS.&lt;/para&gt;&lt;/listitem&gt;
     &lt;listitem&gt;&lt;para&gt;Clients for: HTTP GET, IMAP, MSSQL, MySQL, PING, POP3, PostgreSQL, SMTP, 
@@ -44,7 +46,8 @@
     &lt;listitem&gt;&lt;para&gt;Local client detects: CPU load, loadavg, swap use, I/O use, memory use, and
     where supported hardware info like CPU temperature, fan speed and Power voltages. Also you can
     set it up to scan any logfile using regular expressions you supply.&lt;/para&gt;&lt;/listitem&gt;
-    &lt;listitem&gt;&lt;para&gt;Fully opensource: GUI built on Apache/PHP, Backend on C/Perl, 
+    &lt;listitem&gt;&lt;para&gt;Fully opensource: Backend on C/Perl, 
+    &lt;!-- &lt;listitem&gt;&lt;para&gt;Fully opensource: GUI built on Apache/PHP, Backend on C/Perl,  --&gt;
     Database is MySQL. Uses GNU configure.&lt;/para&gt;&lt;/listitem&gt;
     &lt;/itemizedlist&gt;
     &lt;/sect1&gt;

Modified: upwatch/libdbi/doc/admin-guide.html
===================================================================
(Binary files differ)

Modified: upwatch/libdbi/doc/admin-guide.txt
===================================================================
(Binary files differ)

Modified: upwatch/libdbi/doc/client-configuration.xml
===================================================================
--- upwatch/libdbi/doc/client-configuration.xml	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/doc/client-configuration.xml	2006-07-21 23:12:45 UTC (rev 633)
@@ -163,42 +163,6 @@
       &lt;/itemizedlist&gt;
 
        &lt;/sect3&gt;
-       &lt;sect3 id=&quot;OpenBSD_problems&quot;&gt;
-       &lt;title&gt;OpenBSD problems&lt;/title&gt;
-&lt;para&gt;
-&lt;literallayout&gt;
-&gt;From: &quot;andreas guetl&quot; 
-&gt;To: 
-&gt;Subject: fix for mbmon on openbsd
-&gt;Date: Fri, 5 Sep 2003 10:35:37 +0200
-
-hello!
-
-i tried various progs for monitoring cpu-temp on openbsd boxes
-but none of them worked. then i found the solution on
-<A HREF="http://archives.neohapsis.com/archives/openbsd/2001-02/2550.html">http://archives.neohapsis.com/archives/openbsd/2001-02/2550.html</A>
-and id simply did the trick, not only for healthd (which gave me
-wrong values) but also for mbmon which works very fine.
-
-1.) enable the option APERTURE in the kernel
-enabled by default but disabled in any selfmade kernel, who needs
-x on openbsd ;)
-
-2.) uncomment machdep.allowaperture in /etc/sysctl.conf and change
-the value from 2 to 1
-
-after rebooting with the new kernel the monitoring works really
-fine.
-
-thanks for your fine program!!
-
-(but what has the agp-aperture to do with monitoring hw?)
-
-so long,
-andy 
-&lt;/literallayout&gt;
-&lt;/para&gt;
-       &lt;/sect3&gt;
        &lt;/sect2&gt;
     &lt;/sect1&gt;
     &lt;sect1 id=&quot;Monitoring_specific_logfiles&quot;&gt;
@@ -214,10 +178,13 @@
        &lt;filename&gt;/etc/upwatch.d/uw_sysstat.d/errlog&lt;/filename&gt; (except &lt;filename&gt;rmacros.txt&lt;/filename&gt;
        and &lt;filename&gt;macros.txt&lt;/filename&gt;). 
        These files should contain regular expressions prefixed by one of the keywords 
-       &lt;command&gt;green&lt;/command&gt;, &lt;command&gt;yellow&lt;/command&gt;, or &lt;command&gt;red&lt;/command&gt;. Next 
+       &lt;command&gt;green&lt;/command&gt;, &lt;command&gt;yellow&lt;/command&gt;, &lt;command&gt;red&lt;/command&gt; or &lt;command&gt;ignore&lt;/command&gt;. Next 
        uw_sysstat starts scanning &lt;filename&gt;/var/log/messages&lt;/filename&gt;. It reads a line
        from the logfile and the following happens:&lt;/para&gt;
        &lt;itemizedlist&gt;
+       &lt;listitem&gt;&lt;para&gt;Check against the ignore list. If a match is found, flag green
+       condition, and continue with the next line. This is mostly used to skip lines that
+       would otherwise be flagged as red, for example because they contain the word ERROR.&lt;/para&gt;&lt;/listitem&gt;
        &lt;listitem&gt;&lt;para&gt;Check against the red list. If match found, flag red
        condition, and send the offending line to the upwatch server&lt;/para&gt;&lt;/listitem&gt;
        &lt;listitem&gt;&lt;para&gt;Check line against the yellow list. If matches, flag yellow

Modified: upwatch/libdbi/doc/client-install.xml
===================================================================
--- upwatch/libdbi/doc/client-install.xml	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/doc/client-install.xml	2006-07-21 23:12:45 UTC (rev 633)
@@ -45,6 +45,8 @@
                 you'll need the following on your system to build upwatch:&lt;/para&gt;
             &lt;itemizedlist&gt;
                 &lt;listitem&gt;&lt;para&gt;lynx&lt;/para&gt;&lt;/listitem&gt;
+                &lt;listitem&gt;&lt;para&gt;autoconf 2.59&lt;/para&gt;&lt;/listitem&gt;
+                &lt;listitem&gt;&lt;para&gt;automake 1.9&lt;/para&gt;&lt;/listitem&gt;
                 &lt;listitem&gt;&lt;para&gt;autogen 5.3.6 (autogen.sourceforge.net)&lt;/para&gt;&lt;/listitem&gt;
                 &lt;listitem&gt;&lt;para&gt;autogen needs libguile and umb-scheme&lt;/para&gt;&lt;/listitem&gt;
                 &lt;listitem&gt;&lt;para&gt;RPM tools, if you want to build RPM's&lt;/para&gt;&lt;/listitem&gt;
@@ -63,6 +65,8 @@
               $ cd upwatch-x.x
               $ ./configure
               $ make 
+              $ groupadd upwatch
+              $ useradd -d /etc/upwatch.d -s /sbin/nologin -g upwatch upwatch
               $ make install
            &lt;/literallayout&gt;
         &lt;para&gt; Nothing to it... In case of problems, you're probably missing some library or

Modified: upwatch/libdbi/doc/howitallworks.xml
===================================================================
--- upwatch/libdbi/doc/howitallworks.xml	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/doc/howitallworks.xml	2006-07-21 23:12:45 UTC (rev 633)
@@ -105,10 +105,6 @@
            &lt;varname&gt;uw_send&lt;/varname&gt; queue, which is emptied by the uw_send process which sends
            all files to a remote queue on another host (received and queued by uw_accept).
         &lt;/para&gt;
-        &lt;para&gt; &lt;varname&gt;uw_examine&lt;/varname&gt; can do some additional tests like traceroute to the target host.
-           It attaches this report
-           to the probe result, and in its turn puts everything in an &lt;varname&gt;uw_process&lt;/varname&gt; or
-           &lt;varname&gt;uw_send&lt;/varname&gt; queue.&lt;/para&gt;
        &lt;/sect2&gt;
        &lt;sect2 id=&quot;uw_process_storing_results_in_the_database&quot;&gt;
         &lt;title&gt;uw_process: storing results in the database&lt;/title&gt;

Modified: upwatch/libdbi/doc/installation.xml
===================================================================
--- upwatch/libdbi/doc/installation.xml	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/doc/installation.xml	2006-07-21 23:12:45 UTC (rev 633)
@@ -120,7 +120,7 @@
         &lt;para&gt;You actually need to create two databases, one for the probes to read from, and one 
         for the results to be written to. The first database should be called upwatch, the other
         one can be any name (in this example we use netland). If you have a new database installation
-        create a password for the root account, and remove the anonymous accounts as follows:&lt;para&gt;
+        create a password for the root account, and remove the anonymous accounts as follows:
         &lt;literallayout&gt;
            $ mysql -u root 
            mysql&gt; DELETE FROM mysql.user WHERE User = '';

Modified: upwatch/libdbi/doc/program-guide.html
===================================================================
(Binary files differ)

Modified: upwatch/libdbi/doc/program-guide.txt
===================================================================
(Binary files differ)

Modified: upwatch/libdbi/doc/upwatch.html
===================================================================
(Binary files differ)

Modified: upwatch/libdbi/doc/upwatch.txt
===================================================================
(Binary files differ)

Copied: upwatch/libdbi/libstatgrab-0.13 (from rev 632, upwatch/trunk/libstatgrab-0.13)

Modified: upwatch/libdbi/patches/README
===================================================================
--- upwatch/libdbi/patches/README	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/patches/README	2006-07-21 23:12:45 UTC (rev 633)
@@ -11,9 +11,3 @@
 Adds timeout support to the linux libpcap library.
 Don't know if that's still needed for the newest versions.
 
-
-libstatgrab-openbsd.patch
-
-Old patch to add openbsd support to libpcap
-
-

Deleted: upwatch/libdbi/patches/libstatgrab-openbsd.patch
===================================================================
--- upwatch/libdbi/patches/libstatgrab-openbsd.patch	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/patches/libstatgrab-openbsd.patch	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,32 +0,0 @@
-diff -uNr libstatgrab-orig/configure.in libstatgrab/configure.in
---- libstatgrab-orig/configure.in	2004-05-30 21:56:28.000000000 +0200
-+++ libstatgrab/configure.in	2004-06-09 19:00:00.000000000 +0200
-@@ -40,6 +40,12 @@
-                 [],
-                 [#include &lt;sys/disk.h&gt;])
- 
-+# ds_bytes has been removed in OpenBSD
-+AC_CHECK_MEMBER(struct disk_sysctl.ds_bytes,
-+                [AC_DEFINE(HAVE_DS_BYTES, , [Removed in OpenBSD])],
-+                [],
-+                [#include &lt;sys/disk.h&gt;])
-+
- # Check for sys/loadavg.h
- AC_CHECK_HEADERS([sys/loadavg.h])
- 
-diff -uNr libstatgrab-orig/src/libstatgrab/disk_stats.c libstatgrab/src/libstatgrab/disk_stats.c
---- libstatgrab-orig/src/libstatgrab/disk_stats.c	2004-05-30 21:56:28.000000000 +0200
-+++ libstatgrab/src/libstatgrab/disk_stats.c	2004-06-09 19:01:26.000000000 +0200
-@@ -415,6 +415,12 @@
- #endif
- #else
-
-+#ifdef HAVE_DS_BYTES
-+                rbytes = wbytes = stats[i].ds_bytes;
-+#else
-+                rbytes = stats[i].ds_rbytes;
-+                wbytes = stats[i].ds_wbytes;
-+#endif
- #endif
- 
- 		/* Don't keep stats for disks that have never been used. */

Deleted: upwatch/libdbi/patches/xmbmon203.patch
===================================================================
--- upwatch/libdbi/patches/xmbmon203.patch	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/patches/xmbmon203.patch	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,54 +0,0 @@
---- xmbmon203-orig/Makefile.in	2003-07-04 05:13:45.000000000 +0200
-+++ xmbmon203/Makefile.in	2004-05-25 16:40:11.660167592 +0200
-@@ -37,14 +37,16 @@
- RM=rm -f
- INSTALL=install
- 
--INST_DIR=/usr/local/bin
-+INST_DIR=$(DESTDIR)/usr/local/bin
- INST_XDIR=/usr/X11R6/bin
- INST_XRDIR=/usr/X11R6/lib/X11/app-defaults
-  
- .c.o:
- 	$(CC) -c $(CFLAGS) $*.c
- 
--PROGRAM = mbmon xmbmon
-+PROGRAM = mbmon xmbmon.a
-+PACKAGE = upwatch
-+VERSION = `cat ../VERSION`
- 
- TESTPROG = testpci testsmb testhwm testfan
- 
-@@ -55,6 +57,17 @@
- 
- all: $(PROGRAM)
- 
-+distdir: 
-+	mkdir -p ../$(PACKAGE)-$(VERSION)/xmbmon203/AC-TOOLS
-+	cp *.c *.h Makefile.* *.txt configure *.in *.resources ../$(PACKAGE)-$(VERSION)/xmbmon203
-+	cp AC-TOOLS/config.* AC-TOOLS/install-sh ../$(PACKAGE)-$(VERSION)/xmbmon203/AC-TOOLS
-+
-+check:
-+	echo check OK
-+
-+xmbmon.a: $(OBJS)
-+	$(AR) -r xmbmon.a *.o
-+
- mbmon: mbmon.c mbmon.h methods.h pci_pm.h smbuses.h sensors.h $(OBJS)
- 	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ mbmon.c $(OBJS) $(SPLIBS)
- 
-@@ -130,8 +143,12 @@
- 	$(RM) Makefile config.cache config.log config.h config.status
- 
- install: $(PROGRAM)
--	$(INSTALL) -o root -g wheel -m 4555 -c -p mbmon $(INST_DIR)
--	$(INSTALL) -o root -g wheel -m 4555 -c -p xmbmon $(INST_XDIR)
-+	mkdir -p $(INST_DIR)
-+	if test `${ID} -u` -eq 0; then \
-+	  $(INSTALL) -o root -g wheel -m 4555 -c -p mbmon $(INST_DIR); \
-+	else \
-+	  cp mbmon $(INST_DIR); \
-+	fi
- 
- lint:
- 	$(LINT) $(INCLUDES) $(DEFS) $(FONTDEFINES) $(SRCS) -lm

Copied: upwatch/libdbi/st-1.7 (from rev 632, upwatch/trunk/st-1.7)

Modified: upwatch/libdbi/upwatch/generic.h
===================================================================
--- upwatch/libdbi/upwatch/generic.h	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/upwatch/generic.h	2006-07-21 23:12:45 UTC (rev 633)
@@ -43,7 +43,7 @@
 extern int _logline;
 extern int _log2stderr;
 extern int _log2syslog;
-extern char *_logfilename;
+extern const char *_logfilename;
 
 extern int run(void);
 extern int init(void);

Modified: upwatch/libdbi/upwatch/log.c
===================================================================
--- upwatch/libdbi/upwatch/log.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/upwatch/log.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -19,7 +19,7 @@
 char *progname;
 int _log2stderr;
 int _log2syslog;
-char *_logfilename;
+const char *_logfilename;
 
 /****************************
  logging utility function

Deleted: upwatch/libdbi/upwatch-spec.spec
===================================================================
--- upwatch/libdbi/upwatch-spec.spec	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/upwatch-spec.spec	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,176 +0,0 @@
-
-Summary: UpWatch - The Best monitoring framework
-Vendor: <A HREF="http://www.upwatch.com">http://www.upwatch.com</A>
-Name: upwatch
-Version: 0.1
-Release: 1
-Source: <A HREF="http://www.upwatch.com/%{name">http://www.upwatch.com/%{name</A>}-%{version}.tar.gz
-Packager: Ron Arts &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/upwatch-commits">raarts at upwatch.com</A>&gt;
-License: GPL 
-Group: Application/Monitoring
-BuildRoot: %{_tmppath}/%{name}-%{version}-root
-BuildRequires: gzip glib2-devel mysql-devel curl-devel autogen 
-
-%define strip_binaries 1
-%define gzip_man 1
-%define  __prefix /usr
-
-Prefix: %{__prefix} 
-
-%description
-Upwatch is a full-fledged monitoring and report engine for
-internet hosts. It boasts support for various services, long-time
-history, graphs, and notification
-
-This package contains all upwatch documentation, plus supporting files
-like the database schema.
-
-
-
-%package uw_accept
-Summary: UpWatch - Upwatch daemon for accepting reports
-Group: Application/Monitoring
-Requires: libpcap mysql glib2 curl &gt;= 7.9.3 autogen &gt;= 5.3.6 libnet &gt;= 1.0.2
-
-%description uw_accept
-uw_accept listen on port 1985 for incoming upwatch reports.
-Using a POP3-like protocol it asks for a username and password
-and copies incoming files to a queue
-
-%files uw_accept
-%defattr(-,root,root)
-/usr/bin/uw_accept
-%config(noreplace) /etc/uw_accept.conf
-%config(noreplace) /etc/upwatch.d/uw_accept.conf
-/usr/share/man/man1/uw_accept.1.gz
-
-
-%package uw_httpget
-Summary: UpWatch - Upwatch parallel probe daemon
-Group: Application/Monitoring
-Requires: libpcap mysql glib2 curl &gt;= 7.9.3 autogen &gt;= 5.3.6 libnet &gt;= 1.0.2
-
-%description uw_httpget
-uw_httpget reads a list of hosts from the database, and 
-sends http GET requests to each host. This happens in parallel, 
-so uw_httpget can process thousands of hosts in a very short period.
-
-%files uw_httpget
-%defattr(-,root,root)
-/usr/bin/uw_httpget
-%config(noreplace) /etc/uw_httpget.conf
-%config(noreplace) /etc/upwatch.d/uw_httpget.conf
-/usr/share/man/man1/uw_httpget.1.gz
-
-
-%package uw_ping
-Summary: UpWatch - Upwatch parallel ping daemon
-Group: Application/Monitoring
-Requires: libpcap mysql glib2 curl &gt;= 7.9.3 autogen &gt;= 5.3.6 libnet &gt;= 1.0.2
-
-%description uw_ping
-uw_ping reads a list of hosts from the database, and sends ping 
-packets to each host.  This happens in parallel, so uw_ping can 
-process thousands of hosts in a very short period.
-
-%files uw_ping
-%defattr(-,root,root)
-/usr/bin/uw_ping
-%config(noreplace) /etc/uw_ping.conf
-%config(noreplace) /etc/upwatch.d/uw_ping.conf
-/usr/share/man/man1/uw_ping.1.gz
-
-
-%package uw_process
-Summary: UpWatch - Upwatch parallel probe daemon
-Group: Application/Monitoring
-Requires: libpcap mysql glib2 curl &gt;= 7.9.3 autogen &gt;= 5.3.6 libnet &gt;= 1.0.2
-
-%description uw_process
-uw_process sends all files in the queue to a central server using 
-the uw_process protocol. This is a very simple protocol and looks
-something like POP3.
-
-%files uw_process
-%defattr(-,root,root)
-/usr/bin/uw_process
-%config(noreplace) /etc/uw_process.conf
-%config(noreplace) /etc/upwatch.d/uw_process.conf
-/usr/share/man/man1/uw_process.1.gz
-
-
-%package uw_send
-Summary: UpWatch - Upwatch parallel probe daemon
-Group: Application/Monitoring
-Requires: libpcap mysql glib2 curl &gt;= 7.9.3 autogen &gt;= 5.3.6 libnet &gt;= 1.0.2
-
-%description uw_send
-uw_send sends all files in the queue to a central server using 
-the uw_send protocol. This is a very simple protocol and looks
-something like POP3.
-
-%files uw_send
-%defattr(-,root,root)
-/usr/bin/uw_send
-%config(noreplace) /etc/uw_send.conf
-%config(noreplace) /etc/upwatch.d/uw_send.conf
-/usr/share/man/man1/uw_send.1.gz
-
-
-%package uw_traceroute
-Summary: UpWatch - Upwatch problem investigator daemon
-Group: Application/Monitoring
-Requires: libpcap mysql glib2 curl &gt;= 7.9.3 autogen &gt;= 5.3.6 libnet &gt;= 1.0.2
-
-%description uw_traceroute
-When some probe cannot get to its destination, it hands the
-problem over to uw_traceroute, which does a traceroute (either icmp, 
-tcp or udp) to the destination, and reports on its findings.
-
-%files uw_traceroute
-%defattr(-,root,root)
-/usr/bin/uw_traceroute
-%config(noreplace) /etc/uw_traceroute.conf
-%config(noreplace) /etc/upwatch.d/uw_traceroute.conf
-/usr/share/man/man1/uw_traceroute.1.gz
-
-
-%prep
-%setup  
-
-%build 
-%configure
-make 
-make check
-
-%install
-[ &quot;$RPM_BUILD_ROOT&quot; != &quot;/&quot; ] &amp;&amp; rm -rf $RPM_BUILD_ROOT
-mkdir -p $RPM_BUILD_ROOT
-make DESTDIR=$RPM_BUILD_ROOT install
-
-mkdir -p $RPM_BUILD_ROOT/etc/upwatch.d
-install -m 644 config/upwatch.conf $RPM_BUILD_ROOT/etc/
-install -m 644 uw_accept/uw_accept.conf $RPM_BUILD_ROOT/etc/upwatch.d
-install -m 644 uw_process/uw_process.conf $RPM_BUILD_ROOT/etc/upwatch.d
-
-%if %{strip_binaries}
-{ cd $RPM_BUILD_ROOT
-  strip .%{__prefix}/bin/* || /bin/true
-}
-%endif
-%if %{gzip_man}
-{ cd $RPM_BUILD_ROOT
-  gzip .%{_mandir}/man1/*.1 
-}
-%endif
-
-%clean
-#[ &quot;$RPM_BUILD_ROOT&quot; != &quot;/&quot; ] &amp;&amp; rm -rf $RPM_BUILD_ROOT
-
-%files
-%doc AUTHORS COPYING ChangeLog NEWS README 
-
-%changelog
-* Mon Sep 2 2002 Ron Arts &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/upwatch-commits">raarts at upwatch.com</A>&gt;
-- Rel. 1: First package version
-

Modified: upwatch/libdbi/util/chklog.c
===================================================================
--- upwatch/libdbi/util/chklog.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/util/chklog.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -33,7 +33,7 @@
 
   setvbuf(stdout, (char *)NULL, _IOLBF, 0); // make stdout linebuffered
 
-  logregex_refresh_type(&quot;/etc/upwatch.d/uw_sysstat.d&quot;, OPT_ARG(TYPE));
+  logregex_refresh_type(&quot;/etc/upwatch.d/uw_sysstat.d&quot;, (char *) &amp;OPT_ARG(TYPE));
 
   if (strcmp(*argv, &quot;-&quot;) == 0) {
     in = stdin;
@@ -57,7 +57,7 @@
     }
     buffer[strlen(buffer)-1] = 0;
     if (HAVE_OPT(MATCH)) {
-      if (logregex_matchline(OPT_ARG(TYPE), buffer, &amp;color)) {
+      if (logregex_matchline((char *) &amp;OPT_ARG(TYPE), buffer, &amp;color)) {
         if (HAVE_OPT(LINE_INFO)) {
           printf(&quot;line %u: %d: &quot;, line, color);
         }
@@ -65,13 +65,13 @@
       }
     }
     if (HAVE_OPT(REVERSE)) {
-      logregex_rmatchline(OPT_ARG(TYPE), buffer);
+      logregex_rmatchline((char *) &amp;OPT_ARG(TYPE), buffer);
       printf(&quot;green %s\n&quot;, buffer);
     }
   }
   fclose(in);
   if (HAVE_OPT(STATS)) {
-    logregex_print_stats(OPT_ARG(TYPE));
+    logregex_print_stats((char *) &amp;OPT_ARG(TYPE));
   }
   return 0;
 }

Modified: upwatch/libdbi/util/chklog_options.def
===================================================================
--- upwatch/libdbi/util/chklog_options.def	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/util/chklog_options.def	2006-07-21 23:12:45 UTC (rev 633)
@@ -27,7 +27,7 @@
     arg_type  = string;
     descrip   = &quot;print lines and error info in output lines&quot;;
     doc       =
-&quot;Print line numbers and erros statuses.&quot;;
+&quot;Print line numbers and error statuses.&quot;;
 };
 
 flag = {

Modified: upwatch/libdbi/util/uwq_options.def
===================================================================
--- upwatch/libdbi/util/uwq_options.def	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/util/uwq_options.def	2006-07-21 23:12:45 UTC (rev 633)
@@ -36,6 +36,6 @@
 #include license_gpl.def
 #include minimal_options.def
 
-#include dbase_options_ign.def
 #include generic_options_ign.def
 #include option_realm_ign.def
+#include dbase_options_ign.def

Modified: upwatch/libdbi/util/uwregexp.c
===================================================================
--- upwatch/libdbi/util/uwregexp.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/util/uwregexp.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -38,7 +38,7 @@
       break;
     }
 
-    logregex_refresh_type(&quot;/etc/upwatch.d/uw_sysstat.d&quot;, style);
+    logregex_refresh_type(&quot;/etc/upwatch.d/uw_sysstat.d&quot;, (char *) &amp;style);
     logregex_expand_macros(style, regexp, buf);
 
     printf(&quot;Resulting regex: %s\n&quot;, buf);
@@ -58,5 +58,6 @@
     free(regexp);
   }
   printf(&quot;\n&quot;);
+  exit(0);
 }
 

Modified: upwatch/libdbi/util/uwsaidar.c
===================================================================
--- upwatch/libdbi/util/uwsaidar.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/util/uwsaidar.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -17,7 +17,7 @@
  * along with this program; if not, write to the Free Software
  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
  *
- * $Id: uwsaidar.c,v 1.2 2004/05/30 20:14:58 raarts Exp $
+ * $Id: saidar.c,v 1.34 2005/09/07 14:15:40 tdb Exp $
  */
 
 #ifdef HAVE_CONFIG_H
@@ -69,8 +69,14 @@
 char *size_conv(long long number){
 	char type[] = {'B', 'K', 'M', 'G', 'T'};
 	int x=0;
+	int sign=1;
 	static char string[10];
 
+	if(number &lt; 0){
+		sign=-1;
+		number=-number;
+	}
+
 	for(;x&lt;5;x++){
 		if( (number/1024) &lt; (100)) {
 			break;
@@ -78,7 +84,9 @@
 		number = (number/1024);
 	}
 
-	snprintf(string, 10, &quot;%lld%c&quot;, number, type[x]);	
+	number = number*sign;
+
+	snprintf(string, 10, &quot;%lld%c&quot;, number, type[x]);
 	return string;
 	
 }
@@ -327,8 +335,11 @@
 		r=0;
 		w=0;
 		for(counter=0;counter&lt;stats.disk_io_entries;counter++){
+			char name[12];
+			strncpy(name, disk_io_stat_ptr-&gt;disk_name, sizeof(name));
+			name[sizeof(name)-1] = '\0'; /* strncpy doesn't terminate longer strings */
 			move(line, 0);
-			printw(&quot;%s&quot;, disk_io_stat_ptr-&gt;disk_name);
+			printw(&quot;%s&quot;, name);
 			move(line, 12);
 			rt = (disk_io_stat_ptr-&gt;systime)? (disk_io_stat_ptr-&gt;read_bytes/disk_io_stat_ptr-&gt;systime): disk_io_stat_ptr-&gt;read_bytes;
 			printw(&quot;%7s&quot;, size_conv(rt));
@@ -354,8 +365,11 @@
 		/* Network */
 		network_stat_ptr = stats.network_io_stats;
 		for(counter=0;counter&lt;stats.network_io_entries;counter++){
+			char name[20];
+			strncpy(name, network_stat_ptr-&gt;interface_name, sizeof(name));
+			name[sizeof(name)-1] = '\0'; /* strncpy doesn't terminate longer strings */
 			move(line, 42);
-			printw(&quot;%s&quot;, network_stat_ptr-&gt;interface_name);
+			printw(&quot;%s&quot;, name);
 			move(line, 62);
 			rt = (network_stat_ptr-&gt;systime)? (network_stat_ptr-&gt;rx / network_stat_ptr-&gt;systime): network_stat_ptr-&gt;rx;
 			printw(&quot;%7s&quot;, size_conv(rt));
@@ -372,12 +386,15 @@
 		/* Disk */
 		disk_stat_ptr = stats.fs_stats;
 		for(counter=0;counter&lt;stats.fs_entries;counter++){
+			char name[20];
+			strncpy(name, disk_stat_ptr-&gt;mnt_point, sizeof(name));
+			name[sizeof(name)-1] = '\0'; /* strncpy doesn't terminate longer strings */
 			move(line, 42);
-			printw(&quot;%s&quot;, disk_stat_ptr-&gt;mnt_point);
+			printw(&quot;%s&quot;, name);
 			move(line, 62);
 			printw(&quot;%7s&quot;, size_conv(disk_stat_ptr-&gt;avail));
 			move(line, 73);
-			printw(&quot;%5.2f%%&quot;, 100.00 * ((float) disk_stat_ptr-&gt;used / (float) (disk_stat_ptr-&gt;used + disk_stat_ptr-&gt;avail)));
+			printw(&quot;%6.2f%%&quot;, 100.00 * ((float) disk_stat_ptr-&gt;used / (float) (disk_stat_ptr-&gt;used + disk_stat_ptr-&gt;avail)));
 			disk_stat_ptr++;
 			line++;
 		}
@@ -386,7 +403,7 @@
 	refresh();
 }
 
-void sig_winch_handler(int sig){
+void sig_winch_handler(int dummy){
 	clear();
 	display_headings();
 	display_data();

Modified: upwatch/libdbi/uw_accept/run.c
===================================================================
--- upwatch/libdbi/uw_accept/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_accept/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -7,7 +7,7 @@
 #include &lt;netdb.h&gt;
 #include &lt;signal.h&gt;
 #include &lt;string.h&gt;
-#include &lt;malloc.h&gt;
+#include &lt;stdlib.h&gt;
 #include &lt;ctype.h&gt;
 
 #include &lt;generic.h&gt;

Modified: upwatch/libdbi/uw_acceptbb/run.c
===================================================================
--- upwatch/libdbi/uw_acceptbb/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_acceptbb/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -10,7 +10,7 @@
 
 #include &lt;signal.h&gt;
 #include &lt;string.h&gt;
-#include &lt;malloc.h&gt;
+#include &lt;stdlib.h&gt;
 #include &lt;ctype.h&gt;
 
 #include &lt;st.h&gt;
@@ -183,7 +183,7 @@
     LOG(LOG_DEBUG, &quot;timeout function&quot;);
     if (doc) {
       int ct  = STACKCT_OPT(OUTPUT);
-      char **output = STACKLST_OPT(OUTPUT);
+      char **output = (char **) &amp;STACKLST_OPT(OUTPUT);
 
       xmlSetDocCompressMode(doc, OPT_VALUE_COMPRESS);
       for (i=0; i &lt; ct; i++) {

Modified: upwatch/libdbi/uw_acceptbb/uw_acceptbb.def
===================================================================
--- upwatch/libdbi/uw_acceptbb/uw_acceptbb.def	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_acceptbb/uw_acceptbb.def	2006-07-21 23:12:45 UTC (rev 633)
@@ -77,4 +77,5 @@
 
 #include license_gpl.def
 #include generic_options.def
+#include dbase_options.def
 

Modified: upwatch/libdbi/uw_dns/run.c
===================================================================
--- upwatch/libdbi/uw_dns/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_dns/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -271,7 +271,7 @@
 void write_results(void)
 {
   int ct  = STACKCT_OPT(OUTPUT);
-  char **output = STACKLST_OPT(OUTPUT);
+  char **output = (char **) &amp;STACKLST_OPT(OUTPUT);
   int i;
   xmlDocPtr doc;
 

Modified: upwatch/libdbi/uw_dns/uw_dns.def
===================================================================
--- upwatch/libdbi/uw_dns/uw_dns.def	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_dns/uw_dns.def	2006-07-21 23:12:45 UTC (rev 633)
@@ -92,25 +92,6 @@
 This flag may be given multiple times.';
 };
 
-flag = {
-    must-set;
-    name      = uwuser;
-    value     = U;        /* flag style option character */
-    arg_type  = string;   /* option argument indication  */
-    max       = NOLIMIT;  /* occurrence limit (none)     */
-    descrip   = &quot;Upwatch username&quot;;
-};
-
-flag = {
-    must-set;
-    name      = uwpasswd;
-    value     = P;        /* flag style option character */
-    arg_type  = string;   /* option argument indication  */
-    max       = NOLIMIT;  /* occurrence limit (none)     */
-    descrip   = &quot;UpWatch password&quot;;
-};
-
 #include license_gpl.def
 #include dbase_options.def
 #include generic_options.def
-

Modified: upwatch/libdbi/uw_httpget/run.c
===================================================================
--- upwatch/libdbi/uw_httpget/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_httpget/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -261,7 +261,7 @@
 static void write_results(void)
 {
   int ct  = STACKCT_OPT(OUTPUT);
-  const char **output = STACKLST_OPT(OUTPUT);
+  char **output = (char **) &amp;STACKLST_OPT(OUTPUT);
   int i;
   xmlDocPtr doc;
 

Modified: upwatch/libdbi/uw_httpget/uw_httpget.def
===================================================================
--- upwatch/libdbi/uw_httpget/uw_httpget.def	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_httpget/uw_httpget.def	2006-07-21 23:12:45 UTC (rev 633)
@@ -92,24 +92,7 @@
 This flag may be given multiple times.';
 };
 
-flag = {
-    must-set;
-    name      = uwuser;
-    value     = U;        /* flag style option character */
-    arg_type  = string;   /* option argument indication  */
-    max       = NOLIMIT;  /* occurrence limit (none)     */
-    descrip   = &quot;Upwatch username&quot;;
-};
-
-flag = {
-    must-set;
-    name      = uwpasswd;
-    value     = P;        /* flag style option character */
-    arg_type  = string;   /* option argument indication  */
-    max       = NOLIMIT;  /* occurrence limit (none)     */
-    descrip   = &quot;UpWatch password&quot;;
-};
-
 #include license_gpl.def
 #include dbase_options.def
 #include generic_options.def
+#include option_realm_ign.def

Modified: upwatch/libdbi/uw_imap/run.c
===================================================================
--- upwatch/libdbi/uw_imap/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_imap/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -227,7 +227,7 @@
 void write_results(void)
 {
   int ct  = STACKCT_OPT(OUTPUT);
-  const char **output = STACKLST_OPT(OUTPUT);
+  char **output = (char **) &amp;STACKLST_OPT(OUTPUT);
   int i;
   xmlDocPtr doc;
 

Modified: upwatch/libdbi/uw_iptraf/run.c
===================================================================
--- upwatch/libdbi/uw_iptraf/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_iptraf/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -3,6 +3,7 @@
 
 #include &lt;unistd.h&gt;
 #include &lt;sys/socket.h&gt;
+#include &lt;sys/types.h&gt;
 #include &lt;arpa/inet.h&gt;
 #include &lt;netinet/in_systm.h&gt;
 #include &lt;netinet/in.h&gt;
@@ -41,7 +42,7 @@
   time_t now;
   struct ipnetw *net;
   int ct  = STACKCT_OPT(OUTPUT);
-  char **output = STACKLST_OPT(OUTPUT);
+  char **output = (char **) &amp;STACKLST_OPT(OUTPUT);
   int i;
 
   doc = UpwatchXmlDoc(&quot;result&quot;, NULL);
@@ -94,7 +95,7 @@
     int i, oldcount_ipnets;
     struct ipnetw *newnet, *oldnet, *net;
     int     ct  = STACKCT_OPT( NETWORK );
-    char**  pn = STACKLST_OPT( NETWORK );
+    char**  pn = (char **) &amp;STACKLST_OPT( NETWORK );
 
     for (i=0; i &lt; OPT_VALUE_INTERVAL; i++) { // wait some seconds
       sleep(1);
@@ -150,7 +151,7 @@
   }
   if (HAVE_OPT(EXTIGNORE)) {
     int     ct  = STACKCT_OPT(EXTIGNORE);
-    char**  pn = STACKLST_OPT(EXTIGNORE);
+    char**  pn = (char **) &amp;STACKLST_OPT(EXTIGNORE);
     int i;
 
     if (ct &gt;= 255) { LOG(LOG_ERR, &quot;Too many extignore statements, only 255 are supported&quot;); }
@@ -224,7 +225,7 @@
   mypid = getpid() &amp; 0xffff;
   if (HAVE_OPT(INTERFACE)) {
     int     ct  = STACKCT_OPT( INTERFACE );
-    char**  pn = STACKLST_OPT( INTERFACE );
+    char**  pn = (char **) &amp;STACKLST_OPT( INTERFACE );
 
     while (ct--) {
       dev = *pn++;

Modified: upwatch/libdbi/uw_iptraf/uw_iptraf.def
===================================================================
--- upwatch/libdbi/uw_iptraf/uw_iptraf.def	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_iptraf/uw_iptraf.def	2006-07-21 23:12:45 UTC (rev 633)
@@ -136,3 +136,5 @@
 
 #include license_gpl.def
 #include generic_options.def
+#include dbase_options_ign.def
+

Modified: upwatch/libdbi/uw_mssql/run.c
===================================================================
--- upwatch/libdbi/uw_mssql/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_mssql/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -233,7 +233,7 @@
 void write_results(void)
 {
   int ct  = STACKCT_OPT(OUTPUT);
-  char **output = STACKLST_OPT(OUTPUT);
+  char **output = (char **) &amp;STACKLST_OPT(OUTPUT);
   int i;
   xmlDocPtr doc;
 

Modified: upwatch/libdbi/uw_mysql/run.c
===================================================================
--- upwatch/libdbi/uw_mysql/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_mysql/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -231,7 +231,7 @@
 void write_results(void)
 {
   int ct  = STACKCT_OPT(OUTPUT);
-  const char **output = STACKLST_OPT(OUTPUT);
+  char **output = (char **) &amp;STACKLST_OPT(OUTPUT);
   int i;
   xmlDocPtr doc;
 
@@ -259,8 +259,7 @@
   dbuser = probe-&gt;dbuser;
   dbpasswd = probe-&gt;dbpasswd;
 
-  option = 0 ; mysql_options(mysql, MYSQL_OPT_COMPRESS, (const char *)&amp;option);
-  option = 50; mysql_options(mysql, MYSQL_OPT_CONNECT_TIMEOUT, (const char *)&amp;option);
+  option = 50; mysql_options(mysql, MYSQL_OPT_CONNECT_TIMEOUT, (const char *) &amp;option);
   gettimeofday(&amp;start, NULL);
   if (!mysql_real_connect(mysql, dbhost, dbuser, dbpasswd, dbname, 0, NULL, 0)) {
     probe-&gt;msg = strdup(mysql_error(mysql));

Modified: upwatch/libdbi/uw_mysqlstats/run.c
===================================================================
--- upwatch/libdbi/uw_mysqlstats/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_mysqlstats/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -190,7 +190,7 @@
   xmlDocPtr doc = (xmlDocPtr) user_data;
   struct probedef *probe = (struct probedef *)value;
 
-  xmlNodePtr subtree, mysql;
+  xmlNodePtr subtree, mysqlstats;
   int color;
   char info[1024];
   char buffer[1024];
@@ -203,22 +203,22 @@
     color = STAT_GREEN;
   }
 
-  mysql = xmlNewChild(xmlDocGetRootElement(doc), NULL, &quot;mysql&quot;, NULL);
+  mysqlstats = xmlNewChild(xmlDocGetRootElement(doc), NULL, &quot;mysqlstats&quot;, NULL);
   if (probe-&gt;realm) {
-    xmlSetProp(mysql, &quot;realm&quot;, probe-&gt;realm);
+    xmlSetProp(mysqlstats, &quot;realm&quot;, probe-&gt;realm);
   }
-  sprintf(buffer, &quot;%d&quot;, probe-&gt;probeid);      xmlSetProp(mysql, &quot;id&quot;, buffer);
-  sprintf(buffer, &quot;%s&quot;, probe-&gt;ipaddress);    xmlSetProp(mysql, &quot;ipaddress&quot;, buffer);
-  sprintf(buffer, &quot;%d&quot;, (int) now);           xmlSetProp(mysql, &quot;date&quot;, buffer);
+  sprintf(buffer, &quot;%d&quot;, probe-&gt;probeid);      xmlSetProp(mysqlstats, &quot;id&quot;, buffer);
+  sprintf(buffer, &quot;%s&quot;, probe-&gt;ipaddress);    xmlSetProp(mysqlstats, &quot;ipaddress&quot;, buffer);
+  sprintf(buffer, &quot;%d&quot;, (int) now);           xmlSetProp(mysqlstats, &quot;date&quot;, buffer);
   sprintf(buffer, &quot;%d&quot;, ((int)now)+((unsigned)OPT_VALUE_EXPIRES*60)); 
-    xmlSetProp(mysql, &quot;expires&quot;, buffer);
-  sprintf(buffer, &quot;%d&quot;, color);               xmlSetProp(mysql, &quot;color&quot;, buffer);
-  sprintf(buffer, &quot;%llu&quot;, probe-&gt;selectq);      subtree = xmlNewChild(mysql, NULL, &quot;select&quot;, buffer);
-  sprintf(buffer, &quot;%llu&quot;, probe-&gt;insertq);      subtree = xmlNewChild(mysql, NULL, &quot;insert&quot;, buffer);
-  sprintf(buffer, &quot;%llu&quot;, probe-&gt;updateq);      subtree = xmlNewChild(mysql, NULL, &quot;update&quot;, buffer);
-  sprintf(buffer, &quot;%llu&quot;, probe-&gt;deleteq);      subtree = xmlNewChild(mysql, NULL, &quot;delete&quot;, buffer);
+    xmlSetProp(mysqlstats, &quot;expires&quot;, buffer);
+  sprintf(buffer, &quot;%d&quot;, color);               xmlSetProp(mysqlstats, &quot;color&quot;, buffer);
+  sprintf(buffer, &quot;%llu&quot;, probe-&gt;selectq);      subtree = xmlNewChild(mysqlstats, NULL, &quot;selectq&quot;, buffer);
+  sprintf(buffer, &quot;%llu&quot;, probe-&gt;insertq);      subtree = xmlNewChild(mysqlstats, NULL, &quot;insertq&quot;, buffer);
+  sprintf(buffer, &quot;%llu&quot;, probe-&gt;updateq);      subtree = xmlNewChild(mysqlstats, NULL, &quot;updateq&quot;, buffer);
+  sprintf(buffer, &quot;%llu&quot;, probe-&gt;deleteq);      subtree = xmlNewChild(mysqlstats, NULL, &quot;deleteq&quot;, buffer);
   if (probe-&gt;msg) {
-    subtree = xmlNewTextChild(mysql, NULL, &quot;info&quot;, probe-&gt;msg);
+    subtree = xmlNewTextChild(mysqlstats, NULL, &quot;info&quot;, probe-&gt;msg);
     free(probe-&gt;msg);
     probe-&gt;msg = NULL;
   }
@@ -227,7 +227,7 @@
 void write_results(void)
 {
   int ct  = STACKCT_OPT(OUTPUT);
-  const char **output = STACKLST_OPT(OUTPUT);
+  char **output = (char **) &amp;STACKLST_OPT(OUTPUT);
   int i;
   xmlDocPtr doc;
 
@@ -265,8 +265,7 @@
   dbuser = probe-&gt;dbuser;
   dbpasswd = probe-&gt;dbpasswd;
 
-  mysql_options(mysql, MYSQL_OPT_COMPRESS, 0);
-  mysql_options(mysql, MYSQL_OPT_CONNECT_TIMEOUT, (const char *)&amp;timeout);
+  mysql_options(mysql, MYSQL_OPT_CONNECT_TIMEOUT, (char * ) &amp;timeout);
 
   LOG(LOG_DEBUG, &quot;%s %s %s %s&quot;, dbhost, dbuser, dbpasswd, dbname);
   if (!mysql_real_connect(mysql, dbhost, dbuser, dbpasswd, dbname, 0, NULL, 0)) {

Modified: upwatch/libdbi/uw_null/run.c
===================================================================
--- upwatch/libdbi/uw_null/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_null/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -71,7 +71,7 @@
     g_ptr_array_free(arr, TRUE);
     return 0;
   }
-  g_ptr_array_sort(arr, mystrcmp);
+  g_ptr_array_sort(arr, (GCompareFunc) mystrcmp);
   if (debug &gt; 3) { fprintf(stderr, &quot;%u files in directory\n&quot;, files); sleep(3); }
 
   // now we have a sorted list of files 

Modified: upwatch/libdbi/uw_null/uw_null.def
===================================================================
--- upwatch/libdbi/uw_null/uw_null.def	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_null/uw_null.def	2006-07-21 23:12:45 UTC (rev 633)
@@ -79,7 +79,6 @@
 };
 
 #include license_gpl.def
-#include dbase_options.def
 #include generic_options.def
 #include option_realm_ign.def
-
+#include minimal_options.def

Modified: upwatch/libdbi/uw_ping/run.c
===================================================================
--- upwatch/libdbi/uw_ping/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_ping/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -272,7 +272,7 @@
 void write_results(void)
 {
   int ct  = STACKCT_OPT(OUTPUT);
-  char **output = STACKLST_OPT(OUTPUT);
+  char **output = (char **) &amp;STACKLST_OPT(OUTPUT);
   int i;
   xmlDocPtr doc;
 

Modified: upwatch/libdbi/uw_ping/uw_ping.def
===================================================================
--- upwatch/libdbi/uw_ping/uw_ping.def	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_ping/uw_ping.def	2006-07-21 23:12:45 UTC (rev 633)
@@ -92,36 +92,7 @@
 it knows which probe to retrieve from the definition table';
 };
 
-flag = {
-    must-set;
-    name      = statfile;
-    value     = K;
-    arg_type  = string;
-    descrip   = &quot;file to keep current state of probes&quot;;
-    doc       =
-'To determine if probe status changed, we keep the previous status
-in a file. This is the name of that file';
-};
-
-flag = {
-    must-set;
-    name      = uwuser;
-    value     = U;        /* flag style option character */
-    arg_type  = string;   /* option argument indication  */
-    max       = NOLIMIT;  /* occurrence limit (none)     */
-    descrip   = &quot;Upwatch username&quot;;
-};
-
-flag = {
-    must-set;
-    name      = uwpasswd;
-    value     = P;        /* flag style option character */
-    arg_type  = string;   /* option argument indication  */
-    max       = NOLIMIT;  /* occurrence limit (none)     */
-    descrip   = &quot;UpWatch password&quot;;
-};
-
 #include license_gpl.def
 #include dbase_options.def
 #include generic_options.def
-
+#include option_realm_ign.def

Modified: upwatch/libdbi/uw_pop3/run.c
===================================================================
--- upwatch/libdbi/uw_pop3/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_pop3/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -227,7 +227,7 @@
 void write_results(void)
 {
   int ct  = STACKCT_OPT(OUTPUT);
-  char **output = STACKLST_OPT(OUTPUT);
+  char **output = (char **) &amp;STACKLST_OPT(OUTPUT);
   int i;
   xmlDocPtr doc;
 

Modified: upwatch/libdbi/uw_postgresql/run.c
===================================================================
--- upwatch/libdbi/uw_postgresql/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_postgresql/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -232,7 +232,7 @@
 void write_results(void)
 {
   int ct  = STACKCT_OPT(OUTPUT);
-  const char **output = STACKLST_OPT(OUTPUT);
+  char **output = (char **) &amp;STACKLST_OPT(OUTPUT);
   int i;
   xmlDocPtr doc;
 

Modified: upwatch/libdbi/uw_process/Makefile.am
===================================================================
--- upwatch/libdbi/uw_process/Makefile.am	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_process/Makefile.am	2006-07-21 23:12:45 UTC (rev 633)
@@ -36,7 +36,7 @@
 uw_process_CFLAGS = @LIBGLIB2_CFLAGS@ @LIBXML2_CFLAGS@ @LIBOPTS_CFLAGS@ $(AM_CFLAGS) \
   $(DEF_LIBPQ) $(DEF_LIBSNMP) $(DEF_LIBTDS) $(DEF_LIBESMTP) 
 uw_process_LDADD = uw_process_$(DB_O) uw_process_$(MAIN_O) $(LIBOPTS) $(LIBUPWATCH) @LIBDBI_LIBS@ \
-  @LIBESMTP_LIBS@ @LIBGLIB2_LIBS@ @LIBXML2_LIBS@ $(SOLARISLIBS)
+  @LIBESMTP_LIBS@ @LIBGLIB2_LIBS@ @LIBXML2_LIBS@ $(SOLARISLIBS) $(LIBGTHREAD2_LIBS)
 
 BUILT_SOURCES = $(program:%=%.1) $(program:%=%.h) $(program:%=%.c) $(SPECFILES) $(INITFILES) ../probes.enum
 INCLUDES = -I../upwatch

Modified: upwatch/libdbi/uw_process/iptraf.c
===================================================================
--- upwatch/libdbi/uw_process/iptraf.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_process/iptraf.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,5 +1,6 @@
 #include &quot;config.h&quot;
 #include &lt;string.h&gt;
+#include &lt;sys/types.h&gt;
 #include &lt;sys/socket.h&gt;
 #include &lt;netinet/in.h&gt;
 #include &lt;arpa/inet.h&gt;

Modified: upwatch/libdbi/uw_process/mysqlstats.c
===================================================================
--- upwatch/libdbi/uw_process/mysqlstats.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_process/mysqlstats.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -32,7 +32,7 @@
   result = db_query(t-&gt;probe-&gt;db, 0,
                     &quot;insert into pr_mysqlstats_raw &quot;
                     &quot;set    probe = '%u', yellow = '%f', red = '%f', stattime = '%u', color = '%u', &quot;
-                    &quot;       selectq = '%u', insertq = '%u', updateq = '%u', deleteq = '%u',` &quot;
+                    &quot;       selectq = '%u', insertq = '%u', updateq = '%u', deleteq = '%u', &quot;
                     &quot;       message = '%s' &quot;,
                     def-&gt;probeid, def-&gt;yellow, def-&gt;red, res-&gt;stattime, res-&gt;color, 
                     res-&gt;selectq, res-&gt;insertq, res-&gt;updateq, res-&gt;deleteq,escmsg);

Modified: upwatch/libdbi/uw_process/run.c
===================================================================
--- upwatch/libdbi/uw_process/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_process/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -393,7 +393,7 @@
   if (HAVE_OPT(TRUST)) {
     int i, found=0;
     int     ct  = STACKCT_OPT( TRUST );
-    const char**  pn = STACKLST_OPT( TRUST );
+    char**  pn = (char **) &amp;STACKLST_OPT( TRUST );
 
     while (ct--) {
       for (i=0; modules[i]; i++) {
@@ -456,7 +456,7 @@
 {
   int trust;
   int     ct  = STACKCT_OPT( TRUST );
-  const char**  pn = STACKLST_OPT( TRUST );
+  char**  pn = (char **) &amp;STACKLST_OPT( TRUST );
 
   for (trust=0; trust &lt; ct; trust++) {
     if (strcmp(pn[trust], &quot;all&quot;) == 0) {
@@ -515,7 +515,7 @@
     g_ptr_array_free(arr, TRUE);
     return 0;
   }
-  g_ptr_array_sort(arr, mystrcmp);
+  g_ptr_array_sort(arr, (GCompareFunc) mystrcmp);
   if (debug &gt; 3) { fprintf(stderr, &quot;%u files in directory\n&quot;, files); sleep(3); }
 
   // now we have a sorted list of files 
@@ -524,7 +524,7 @@
     trx t;
     int j;
     int output_ct = STACKCT_OPT(OUTPUT);
-    const char **output_pn = STACKLST_OPT(OUTPUT);
+    char **output_pn = (char **) &amp;STACKLST_OPT(OUTPUT);
     char *filebase;
 
     filebase = strrchr((char *)g_ptr_array_index(arr,i), '/');
@@ -587,7 +587,7 @@
 {
   int i;
   int     ct  = STACKCT_OPT( INPUT );
-  const char**  pn = STACKLST_OPT( INPUT );
+  char**  pn = (char **) &amp;STACKLST_OPT( INPUT );
 
   childpidcnt = ct;
   if (debug &gt; 2) fprintf(stderr, &quot;pondering..\n&quot;);
@@ -635,7 +635,7 @@
               char subject[256];
 
               sprintf(subject, &quot;UPWATCH: probe %s is lagging in processing&quot;, modules[i]-&gt;module_name);
-              mail(OPT_ARG(NOC_MAIL), subject, subject, (time_t)NULL);
+              mail((char *) &amp;OPT_ARG(NOC_MAIL), subject, subject, (time_t)NULL);
               db_query(modules[i]-&gt;db, 0, &quot;update probe set lagwarn = 'yes' where id = '%u'&quot;,
                                            modules[i]-&gt;class);
             }
@@ -644,7 +644,7 @@
               char subject[256];
 
               sprintf(subject, &quot;UPWATCH: probe %s is up-to-date again&quot;, modules[i]-&gt;module_name);
-              mail(OPT_ARG(NOC_MAIL), subject, subject, (time_t)NULL);
+              mail((char *) &amp;OPT_ARG(NOC_MAIL), subject, subject, (time_t)NULL);
               db_query(modules[i]-&gt;db, 0, &quot;update probe set lagwarn = 'no' where id = '%u'&quot;,
                                            modules[i]-&gt;class);
             }
@@ -697,7 +697,7 @@
   guint lowtime, hightime; 
   char *p;
 
-  res.name = strtok((char *)OPT_ARG(SUMMARIZE), &quot;,&quot;);
+  res.name = strtok((char *) &amp;OPT_ARG(SUMMARIZE), &quot;,&quot;);
   lowtime = 0;
   hightime = time(NULL);
   p = strtok(NULL, &quot;,&quot;);

Modified: upwatch/libdbi/uw_process/uw_process.conf
===================================================================
--- upwatch/libdbi/uw_process/uw_process.conf	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_process/uw_process.conf	2006-07-21 23:12:45 UTC (rev 633)
@@ -2,6 +2,7 @@
 #logfile /var/log/upwatch/uw_process.log
 input q_pop3
 input q_httpget
+input q_tcpconnect
 input q_imap
 input q_iptraf
 input q_mssql
@@ -12,7 +13,7 @@
 input q_errlog
 input q_diskfree
 input q_ping
-input q_spare
+#input q_spare
 input q_bb
 input q_bb_cpu
 input q_mysqlstats

Modified: upwatch/libdbi/uw_purple/uw_purple.def
===================================================================
--- upwatch/libdbi/uw_purple/uw_purple.def	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_purple/uw_purple.def	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,4 +1,5 @@
 AutoGen Definitions options;
+
 export        = &quot;#define progOptions uw_purpleOptions&quot;;
 prog-name     = uw_purple;
 prog-title    = &quot;Upwatch purple daemon&quot;;
@@ -53,8 +54,7 @@
     descrip   = &quot;name of queue to drop results&quot;;
     doc       =
 'The argument is taken to be a maildir under the directory `spooldir`.
-All results are placed in this queue.
-This flag may be given multiple times.';
+All results are placed in this queue.';
 };
 
 #include license_gpl.def

Modified: upwatch/libdbi/uw_route/run.c
===================================================================
--- upwatch/libdbi/uw_route/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_route/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -36,7 +36,7 @@
   if (HAVE_OPT(ROUTE)) {
     int i=0;
     int     ct  = STACKCT_OPT( ROUTE );
-    char**  pn = STACKLST_OPT( ROUTE );
+    char**  pn = (char **) &amp;STACKLST_OPT( ROUTE );
 
     while (ct--) {
       char probe[256], queue[256];
@@ -98,7 +98,7 @@
     g_ptr_array_free(arr, TRUE);
     return 0;
   }
-  g_ptr_array_sort(arr, mystrcmp);
+  g_ptr_array_sort(arr, (GCompareFunc) mystrcmp);
   if (debug &gt; 3) { fprintf(stderr, &quot;%u files in directory\n&quot;, files); sleep(3); }
 
   // now we have a sorted list of files 

Modified: upwatch/libdbi/uw_route/uw_route.conf
===================================================================
--- upwatch/libdbi/uw_route/uw_route.conf	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_route/uw_route.conf	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,5 +1,6 @@
 input uw_route
 route httpget q_httpget
+route tcpconnect q_tcpconnect
 route imap q_imap
 route iptraf q_iptraf
 route httpget q_httpget

Modified: upwatch/libdbi/uw_route/uw_route.def
===================================================================
--- upwatch/libdbi/uw_route/uw_route.def	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_route/uw_route.def	2006-07-21 23:12:45 UTC (rev 633)
@@ -10,7 +10,7 @@
 homerc        = &quot;$$/upwatch.conf&quot;;
 homerc        = &quot;$$/uw_route.conf&quot;;
 detail        = 
-'uw_route reads probe resultfiles, and stores them in the database';
+'uw_route reads probe resultfiles, and stores them in the right processing queue';
 
 // this section is for the generated specfile
 spec-requires = &quot;libdbi &gt;= 0.8 glib2&quot;;

Modified: upwatch/libdbi/uw_send/run.c
===================================================================
--- upwatch/libdbi/uw_send/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_send/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,5 +1,7 @@
 #include &quot;config.h&quot;
+#include &lt;signal.h&gt;
 #include &lt;sys/types.h&gt;
+#include &lt;sys/signal.h&gt;
 #include &lt;sys/wait.h&gt;
 #include &lt;sys/stat.h&gt;
 #include &lt;sys/socket.h&gt;
@@ -103,12 +105,12 @@
   }
 
   ct    = STACKCT_OPT( INPUT );
-  input = STACKLST_OPT(INPUT);
-  host  = STACKLST_OPT(HOST);
-  port  = STACKLST_OPT(PORT);
-  user  = STACKLST_OPT(UWUSER);
-  pwd   = STACKLST_OPT(UWPASSWD);
-  thr   = STACKLST_OPT(THREADS);
+  input = (char **) &amp;STACKLST_OPT(INPUT);
+  host  = (char **) &amp;STACKLST_OPT(HOST);
+  port  = (char **) &amp;STACKLST_OPT(PORT);
+  user  = (char **) &amp;STACKLST_OPT(UWUSER);
+  pwd   = (char **) &amp;STACKLST_OPT(UWPASSWD);
+  thr   = (char **) &amp;STACKLST_OPT(THREADS);
 
   // read in options for queuing
   for (i=0; input[i] &amp;&amp; i &lt; ct &amp;&amp; i &lt; 4; i++) {

Modified: upwatch/libdbi/uw_send/uw_send.def
===================================================================
--- upwatch/libdbi/uw_send/uw_send.def	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_send/uw_send.def	2006-07-21 23:12:45 UTC (rev 633)
@@ -147,4 +147,3 @@
 
 #include license_gpl.def
 #include generic_options.def
-#include dbase_options_ign.def

Modified: upwatch/libdbi/uw_setip/run.c
===================================================================
--- upwatch/libdbi/uw_setip/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_setip/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -7,7 +7,7 @@
 #include &lt;netdb.h&gt;
 #include &lt;signal.h&gt;
 #include &lt;string.h&gt;
-#include &lt;malloc.h&gt;
+#include &lt;stdlib.h&gt;
 #include &lt;ctype.h&gt;
 
 #include &lt;generic.h&gt;
@@ -147,8 +147,8 @@
 static int uw_set_ip(char *user, char *ip, char *remotehost) 
 {
   dbi_conn conn;
-  conn = open_database(OPT_ARG(DBTYPE), OPT_ARG(DBHOST), OPT_ARG(DBPORT), OPT_ARG(DBNAME), 
-			OPT_ARG(DBUSER), OPT_ARG(DBPASSWD));
+  conn = open_database((char *) &amp;OPT_ARG(DBTYPE), (char *) &amp;OPT_ARG(DBHOST), (char *) &amp;OPT_ARG(DBPORT), 
+                        (char *) &amp;OPT_ARG(DBNAME), (char *) &amp;OPT_ARG(DBUSER), (char *) &amp;OPT_ARG(DBPASSWD));
   if (conn) {
     gchar buffer[256];
 

Modified: upwatch/libdbi/uw_smtp/run.c
===================================================================
--- upwatch/libdbi/uw_smtp/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_smtp/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -224,7 +224,7 @@
 void write_results(void)
 {
   int ct  = STACKCT_OPT(OUTPUT);
-  const char **output = STACKLST_OPT(OUTPUT);
+  char **output = (char **) &amp;STACKLST_OPT(OUTPUT);
   int i;
   xmlDocPtr doc;
 

Modified: upwatch/libdbi/uw_snmpget/run.c
===================================================================
--- upwatch/libdbi/uw_snmpget/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_snmpget/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -348,7 +348,7 @@
 void write_results(void)
 {
   int ct  = STACKCT_OPT(OUTPUT);
-  const char **output = STACKLST_OPT(OUTPUT);
+  char **output = (char **) &amp;STACKLST_OPT(OUTPUT);
   int i;
   xmlDocPtr doc;
 

Modified: upwatch/libdbi/uw_syncprobes/uw_syncprobes.def
===================================================================
--- upwatch/libdbi/uw_syncprobes/uw_syncprobes.def	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_syncprobes/uw_syncprobes.def	2006-07-21 23:12:45 UTC (rev 633)
@@ -60,4 +60,4 @@
 #include license_gpl.def
 #include dbase_options.def
 #include generic_options.def
-
+#include option_realm_ign.def

Modified: upwatch/libdbi/uw_sysstat/Makefile.am
===================================================================
--- upwatch/libdbi/uw_sysstat/Makefile.am	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/Makefile.am	2006-07-21 23:12:45 UTC (rev 633)
@@ -27,7 +27,7 @@
 init_DATA = $(INITFILES)
 
 uw_sysstat_SOURCES = run.c uw_sysstat.c uw_sysstat.h $(PROBFILES) $(SPECFILES) $(INITFILES)
-uw_sysstat_CFLAGS = @LIBXML2_CFLAGS@ @LIBGLIB2_CFLAGS@ $(AM_CFLAGS) @LIBPCRE_CFLAGS@ @LIBOPTS_CFLAGS@
+uw_sysstat_CFLAGS = @LIBXML2_CFLAGS@ @LIBGLIB2_CFLAGS@ $(AM_CFLAGS) @LIBPCRE_CFLAGS@ @LIBOPTS_CFLAGS@ @LIBGTHREAD2_CFLAGS@
 uw_sysstat_LDADD = uw_sysstat_$(MAIN_O) $(XMBMON_LIB) $(LIBOPTS) \
   $(FREEBSDLIBS) $(SOLARISLIBS) $(LIBSTATGRAB) \
   $(LIBUPWATCH) @LIBXML2_LIBS@ @LIBGLIB2_LIBS@ @LIBPCRE_LIBS@

Modified: upwatch/libdbi/uw_sysstat/run.c
===================================================================
--- upwatch/libdbi/uw_sysstat/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -22,6 +22,11 @@
 #if USE_XMBMON
 #include &quot;mbmon.h&quot;
 #endif
+#ifdef __OpenBSD__
+#include &lt;sys/param.h&gt;
+#include &lt;sys/sysctl.h&gt;
+#include &lt;sys/sensors.h&gt;
+#endif
 
 char ipaddress[24];
 
@@ -54,7 +59,7 @@
 } stats_t;
 stats_t st;
 
-#if USE_XMBMON
+#if USE_XMBMON|| defined (__OpenBSD__)
 typedef struct {
   float temp1;
   float temp2;
@@ -113,7 +118,62 @@
   //       hw.vc0, hw.vc1, hw.v33, hw.v50p, hw.v12p, hw.v12n, hw.v50n);
 }
 #endif
+#ifdef __OpenBSD__
+void get_hwstats(void)
+{
+  int i;
+  struct sensor s; 
+  size_t slen = sizeof(s); 
+  float value;
+  for (i=0;i&lt;256;i++)
+  {
+    int mib[] = { CTL_HW, HW_SENSORS, i }; 
+    if ( sysctl(mib, sizeof(mib)/sizeof(mib[0]), &amp;s, &amp;slen, NULL, 0) == -1 ) continue;
+    if (s.flags &amp; SENSOR_FINVALID) continue;
 
+    /* Ok, we have a valid sensor now, now check the type */
+    switch (s.type) {
+      case SENSOR_TEMP:
+              if ( debug &gt; 5 ) printf(&quot;Sensor %d is a temparature sensor\n&quot;, s.num);
+              value = (s.value - 273150000) / 1000000.0;
+              if(strcmp(s.desc,&quot;Temp1&quot;)==0)  hw.temp1 = value; 
+              if(strcmp(s.desc,&quot;Temp2&quot;)==0)  hw.temp2 = value;
+              if(strcmp(s.desc,&quot;Temp3&quot;)==0)  hw.temp3 = value;
+
+	      // The admtmp driver only tells us about Internal and External temperatures
+              if(strcmp(s.desc,&quot;External Temp&quot;)==0 &amp;&amp; strncmp(s.device,&quot;admtemp&quot;, 7) == 0)  hw.temp1 = value; 
+              if(strcmp(s.desc,&quot;Internal Temp&quot;)==0 &amp;&amp; strncmp(s.device,&quot;admtemp&quot;, 7) == 0)  hw.temp2 = value; 
+
+              break;
+      case SENSOR_FANRPM:
+              if ( debug &gt; 4 ) printf(&quot;Sensor %d is a fan speed sensor\n&quot;, s.num);
+              if(strcmp(s.desc,&quot;Fan1&quot;)==0)  hw.rot1 = (int) s.value;
+              if(strcmp(s.desc,&quot;Fan2&quot;)==0)  hw.rot2 = (int) s.value;
+              if(strcmp(s.desc,&quot;Fan3&quot;)==0)  hw.rot3 = (int) s.value;
+              break;
+      case SENSOR_VOLTS_DC:
+              if ( debug &gt; 5 ) printf(&quot;Sensor %d is a voltage sensor\n&quot;, s.num);
+              value = s.value / 1000000.0;
+              if(strcmp(s.desc,&quot;VCore A&quot;)==0)  hw.vc0 = value;
+              if(strcmp(s.desc,&quot;VCore B&quot;)==0)  hw.vc1 = value;
+              if(strcmp(s.desc,&quot;+3.3V&quot;)==0)  hw.v33 = value;
+              if(strcmp(s.desc,&quot;+5V&quot;)==0)  hw.v50p = value;
+              if(strcmp(s.desc,&quot;+12V&quot;)==0)  hw.v12p = value;
+              if(strcmp(s.desc,&quot;-12V&quot;)==0)  hw.v12n = value;
+              if(strcmp(s.desc,&quot;-5V&quot;)==0)  hw.v50n = value;
+              break;
+      default:
+              if ( debug &gt; 5 ) printf(&quot;Sensor hw.sensors.%d is of a unknown type! It describes itselve as: %s\n&quot;, s.num, s.desc);
+              break;
+    }
+  }
+  if ( debug &gt; 4 ) printf(&quot;Temp = %4.1f, %4.1f, %4.1f;&quot;,hw.temp1, hw.temp2, hw.temp3);
+  if ( debug &gt; 4 ) printf(&quot;Rot = %4d, %4d, %4d\n&quot;, hw.rot1, hw.rot2, hw.rot3);
+  if ( debug &gt; 4 ) printf(&quot;Vcore = %4.2f, %4.2f\nVolt = %4.2f, %4.2f, %5.2f, %6.2f, %5.2f\n&quot;, 
+         hw.vc0, hw.vc1, hw.v33, hw.v50p, hw.v12p, hw.v12n, hw.v50n);
+}
+#endif
+
 #if HAVE_LIBPCRE
 #define STATFILE &quot;/var/run/upwatch/uw_sysstat.stat&quot;
 int check_log(GString *string, int idx)
@@ -225,7 +285,7 @@
 
   if (HAVE_OPT(ERRLOG)) {
     int ct  = STACKCT_OPT(ERRLOG);
-    char **errlog = STACKLST_OPT(ERRLOG);
+    char **errlog = (char **) &amp;STACKLST_OPT(ERRLOG);
     for (idx=0, i=0; i &lt; ct &amp;&amp; idx &lt; 255; i++) {
       char *start, *end;
   
@@ -317,9 +377,6 @@
   time_t now = time(NULL);
 
   node = xmlNewChild(xmlDocGetRootElement(doc), NULL, name, NULL);
-  if (HAVE_OPT(DOMAIN)) {
-    xmlSetProp(node, &quot;domain&quot;, OPT_ARG(DOMAIN));
-  }
   if (HAVE_OPT(REALM)) {
     xmlSetProp(node, &quot;realm&quot;, OPT_ARG(REALM));
   }
@@ -333,7 +390,7 @@
   return node;
 }
 
-#if USE_XMBMON
+#if USE_XMBMON || defined (__OpenBSD__)
 void add_hwstat(xmlNodePtr node)
 {
   char buffer[24];
@@ -511,20 +568,36 @@
 {
   float fullest = 0.0;
   char info[32768];
+  int i, ignore;
 
   if (st.disk) {
     sg_fs_stats *disk_stat_ptr = st.disk;
     int counter;
 
-    for (counter=0; counter &lt; st.disk_entries; counter++){
+    for (counter=0, ignore=0; counter &lt; st.disk_entries; counter++){
       float use;
-      use = 100.00 * ((float) disk_stat_ptr-&gt;used / (float) (disk_stat_ptr-&gt;used + disk_stat_ptr-&gt;avail));
-      if (use &gt; fullest) fullest = use;
-      disk_stat_ptr++;
+
+    if (HAVE_OPT( IGNOREDISKFREE )) {
+        int     ct = STACKCT_OPT(  IGNOREDISKFREE );
+        char**  pp = (char **) &amp;STACKLST_OPT( IGNOREDISKFREE );
+
+        do  {
+            char* p = *pp++;
+            if (strcmp(disk_stat_ptr-&gt;device_name, p) ==0 ) ignore=1;
+        } while (--ct &gt; 0);
     }
+
+     if (ignore == 0 ) {
+        use = 100.00 * ((float) disk_stat_ptr-&gt;used / (float) (disk_stat_ptr-&gt;used + disk_stat_ptr-&gt;avail));
+        if (use &gt; fullest) fullest = use;
+      }
+      ignore=0; /* Reset the ignore flag */
+      disk_stat_ptr++; /* next partition please */
+    }
   }
 
-  if (fullest &gt; OPT_VALUE_DISKFREE_YELLOW) { // if some disk is more then 80% full give `df` listing
+  if (fullest &gt; OPT_VALUE_DISKFREE_YELLOW) { // if some disk is more then the yellow treshold full give `df` listing
+
     char cmd[1024];
     char buffer[24];
     FILE *in;
@@ -567,7 +640,7 @@
   xmlDocPtr doc;
   xmlNodePtr node;
   int ct  = STACKCT_OPT(OUTPUT);
-  char **output = STACKLST_OPT(OUTPUT);
+  char **output = (char **) &amp;STACKLST_OPT(OUTPUT);
   GString *log;
   int i;
   int color;
@@ -600,8 +673,8 @@
   add_sysstat_info(node);
   color = xmlGetPropInt(node, &quot;color&quot;);
   if (color &gt; highest_color) highest_color = color;
-#if USE_XMBMON
-  if (OPT_VALUE_HWSTATS) {
+#if USE_XMBMON|| defined (__OpenBSD__)
+  if (OPT_VALUE_HWSTATS ) { 
     // do the hwstat
     get_hwstats();
     node = newnode(doc, &quot;hwstat&quot;);
@@ -631,6 +704,7 @@
   node = newnode(doc, &quot;diskfree&quot;);
   add_diskfree_info(node);
   color = xmlGetPropInt(node, &quot;color&quot;);
+
   if (color &gt; highest_color) highest_color = color;
 
   if (HAVE_OPT(HPQUEUE) &amp;&amp; (highest_color != prv_highest_color)) {

Copied: upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/amavisd (from rev 632, upwatch/trunk/uw_sysstat/uw_sysstat.d/maillog/amavisd)

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/macros.txt
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/macros.txt	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/macros.txt	2006-07-21 23:12:45 UTC (rev 633)
@@ -3,10 +3,10 @@
 # match a macroname!!
 # entries are matched in the order specified
 WLOGDATE (Mon|Tue|Wed|Thu|Fri|Sat|Sun) [-A-Za-z]* [\d ]\d \d\d:\d\d:\d\d [-\.\/\dA-Za-z]+
-LOGDATE [A-Za-z]* [\d ]\d \d\d:\d\d:\d\d [-\.\/\dA-Za-z]+
+LOGDATE [A-Za-z]{3}\s{1,2}[\d]{1,2} \d\d:\d\d:\d\d [-\.\/\dA-Za-z]+
 EMAIL   [-\.\$\w]+@[a-z\d][-a-z\d]*(\.[a-z\d][-a-z\d]+)*\.(arpa|com|edu|biz|org|gov|int|info|mil|net|name|museum|coop|aero|[a-z][a-z])
 HOSTNAME ([a-z\d][-a-z\d]*)(\.[a-z\d][-a-z\d]*)*(\.(arpa|com|edu|biz|org|gov|int|info|mil|net|name|museum|coop|aero|[a-z][a-z]))?
-IPADDR (25[0-5]|2[0-4][\d]|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3}
+IPADDR ((([0-9a-fA-F]+:){7}[0-9a-fA-F]+)|(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?::(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?)|((25[0-5]|2[0-4][\d]|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3})
 HOSTNAM [-\da-z]+
 PATH	/?[-_\.[:alnum:]]?(/[-_\.[:alnum:]]+)*/?
 SMONTH  (Mon|Tue|Wed|Thu|Fri|Sat|Sun)

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/postfix
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/postfix	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/postfix	2006-07-21 23:12:45 UTC (rev 633)
@@ -41,9 +41,21 @@
 green [LOGDATE] postfix/smtp[PID]: [MSGID]: enabling PIX &lt;CRLF&gt;\.&lt;CRLF&gt; workaround for [HOSTNAME]\[[IPADDR]\]
 green [LOGDATE] postfix/smtp[PID]: warning: host [HOSTNAME]\[[IPADDR]\] greeted me with my own hostname [HOSTNAME]
 green [LOGDATE] postfix/smtp[PID]: warning: host [HOSTNAME]\[[IPADDR]\] replied to HELO/EHLO with my own hostname [HOSTNAME]
+green [LOGDATE] postfix/smtp[PID]: connect to [HOSTNAME]\[[IPADDR]\]: Network is unreachable \(port [NUM]\)
+green [LOGDATE] postfix/smtp[PID]: connect to [HOSTNAME] \[[IPADDR]\]: read timeout \(port [NUM]\)
+green [LOGDATE] postfix/anvil[PID]: statistics: 
+green [LOGDATE] postfix/scache[PID]: statistics: 
+green [LOGDATE] postfix/smtp[PID]: connect to [HOSTNAME]\[[IPADDR]\]: Connection refused \(port [NUM]\) 
+green [LOGDATE] postfix/sendmail[PID]: fatal: No recipient addresses found in message header
+yellow [LOGDATE] postfix/[WORD][PID]: warning: My hostname [WORD] is not a fully qualified name - set myhostname or mydomain in [PATH]
+ignore [LOGDATE] postfix/smtpd[PID]: too many errors after NOOP from [HOSTNAME]\[[IPADDR]\]
+ignore [LOGDATE] postfix/smtpd[PID]: too many errors after RCPT from [HOSTNAME]\[[IPADDR]\]
+ignore [LOGDATE] postfix/smtp[PID]: .*?: host [HOSTNAME]\[[IPADDR]\] said: 451
 red [LOGDATE] postfix/local[PID]: table has changed -- exiting
 red [LOGDATE] postfix/postfix-script: fatal: the Postfix mail system is already running
 red [LOGDATE] postfix/postfix-script: fatal: the Postfix mail system is not running
 red [LOGDATE] postfix/smtpd[PID]: lookup table has changed -- exiting
 red [LOGDATE] postfix/trivial-rewrite[PID]: table has changed -- exiting
 red [LOGDATE] postfix/smtp[PID]: fatal:
+red [LOGDATE] postfix/sendmail[PID]: fatal: [WORD]\([NUM]\): Message file too big [PATH]:
+red [LOGDATE] postfix/postdrop[PID]: warning: uid=[NUM]: File too large

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/rmacros.txt
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/rmacros.txt	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/rmacros.txt	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,11 +1,11 @@
 # macros for log2regex 
 # they are very much like the ones in the 'macros' file, but
 # specifically designed to extract rules from existing logfiles
-LOGDATE [A-Za-z]* [0-9 ][0-9] [0-9][0-9]:[0-9][0-9]:[0-9][0-9] [-\.\/0-9A-Za-z]+
+LOGDATE [A-Za-z]{3}\s{1,2}[\d]{1,2} \d\d:\d\d:\d\d [-\.\/\dA-Za-z]+
 SMONTH  (Mon|Tue|Wed|Thu|Fri|Sat|Sun)
 EMAIL   [-\.\$_0-9a-z]+@([a-z0-9][-a-z0-9]*)(\.[a-z0-9][-a-z0-9]*)*(\.(arpa|com|edu|biz|org|gov|int|info|mil|net|name|museum|coop|aero|[a-z][a-z]))?
 HOSTNAME ([a-z0-9][-a-z0-9]*)(\.[a-z0-9][-a-z0-9]*)*(\.(arpa|com|edu|biz|org|gov|int|info|mil|net|name|museum|coop|aero|[a-z][a-z]))
-IPADDR	(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9])){3}
+IPADDR ((([0-9a-fA-F]+:){7}[0-9a-fA-F]+)|(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?::(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?)|((25[0-5]|2[0-4][\d]|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3})
 PATH	(/[-\._[:alnum:]]+){2,}([/]?)
 USER    root
 USER=   user=[-\.\$_0-9a-z]+

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/sendmail
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/sendmail	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/maillog/sendmail	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,8 +1,13 @@
-green [LOGDATE] (sm-msp-queue|sendmail)[PID]: [MSGID]: ((from=.*|to=.*|ctladdr=.*|size=.*|class=.*|pri=.*|nrcpts=.*|msgid=.*|proto=.*|dsn=.*|delay=.*|xdelay=.*|mailer=.*|relay=.*)[,\s]*)*
+green [LOGDATE] (sm-msp-queue|sendmail|sm-mta)[PID]: [MSGID]: ((from=.*|to=.*|ctladdr=.*|size=.*|class=.*|pri=.*|nrcpts=.*|msgid=.*|proto=.*|dsn=.*|delay=.*|xdelay=.*|mailer=.*|relay=.*)[,\s]*)*
 green [LOGDATE] sendmail[PID]: alias database [PATH] (auto)?rebuilt by root
 green [LOGDATE] sendmail[PID]: [PATH]: [NUM] aliases, longest [NUM] bytes, [NUM] bytes total
-green [LOGDATE] sendmail[PID]: restarting on signal /usr/sbin/sendmail
+green [LOGDATE] sendmail[PID]: restarting on signal [PATH]
 green [LOGDATE] sendmail[PID]: STARTTLS=.*, relay=.*, version=.*, verify=.*, cipher=.*, bits=.*
 green [LOGDATE] sendmail[PID]: [MSGID]: forward .*: Group writable directory
 green [LOGDATE] sendmail[PID]: gethostbyaddr\([IPADDR]\) failed: 
-
+green [LOGDATE] sendmail[PID]: gethostbyaddr\(IPv(4|6):[IPADDR]\) failed:
+green [LOGDATE] sendmail[PID]: accepting new messages \(again\)
+green [LOGDATE] sendmail[PID]: accepting connections again for daemon MTA
+green [LOGDATE] sendmail[PID]: [MSGID]: [HOSTNAME] \[[IPADDR]\] did not issue MAIL/EXPN/VRFY/ETRN during connection to MTA
+red [LOGDATE] sendmail[PID]: rejecting new messages: min free: [NUM]
+red [LOGDATE] sendmail[PID]: grew WorkList for /var/spool/mqueue to 8000

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/mysql/macros.txt
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/mysql/macros.txt	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/mysql/macros.txt	2006-07-21 23:12:45 UTC (rev 633)
@@ -6,6 +6,6 @@
 PATH    (/[-\._[:alnum:]]+){2,}([/]?)
 TABLE   \w+/\w+
 HOSTNAME ([a-z0-9][-a-z0-9]*)(\.[a-z0-9][-a-z0-9]*)*(\.(arpa|com|edu|biz|org|gov|int|info|mil|net|name|museum|coop|aero|[a-z][a-z]))
-IPADDR	(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9])){3}
+IPADDR ((([0-9a-fA-F]+:){7}[0-9a-fA-F]+)|(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?::(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?)|((25[0-5]|2[0-4][\d]|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3})
 PATH	(/[-\._[:alnum:]]+){2,}([/]?)
 NUM	[-+]?(0x)?\d+

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/mysql/rmacros.txt
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/mysql/rmacros.txt	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/mysql/rmacros.txt	2006-07-21 23:12:45 UTC (rev 633)
@@ -4,6 +4,6 @@
 LOGDATE \d\d\d\d\d\d \d\d:\d\d:\d\d
 TABLE   \w+/\w+
 HOSTNAME ([a-z0-9][-a-z0-9]*)(\.[a-z0-9][-a-z0-9]*)*(\.(arpa|com|edu|biz|org|gov|int|info|mil|net|name|museum|coop|aero|[a-z][a-z]))
-IPADDR	(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9])){3}
+IPADDR ((([0-9a-fA-F]+:){7}[0-9a-fA-F]+)|(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?::(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?)|((25[0-5]|2[0-4][\d]|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3})
 PATH	(/[-\._[:alnum:]]+){2,}([/]?)
 NUM	[-+]?(0x)?\d+

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/bgpd
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/bgpd	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/bgpd	2006-07-21 23:12:45 UTC (rev 633)
@@ -1 +1,17 @@
+green [LOGDATE] BGP: %ADJCHANGE: neighbor [IPADDR] Down User reset
+green [LOGDATE] BGP: %ADJCHANGE: neighbor [IPADDR] Up
+green [LOGDATE] BGP: %ADJCHANGE: neighbor [IPADDR] Down BGP Notification received
+green [LOGDATE] BGP: %ADJCHANGE: neighbor [IPADDR] Down BGP Notification send
+green [LOGDATE] BGP: %ADJCHANGE: neighbor [IPADDR] Down Peer closed the session
+green [LOGDATE] BGP: %MAXPFX: No. of prefix received from [IPADDR] \(afi [NUM]\) reaches [NUM], max [NUM]
+green [LOGDATE] BGP: %MAXPFXEXCEED: No. of prefix received from [IPADDR] \(afi [NUM]\): [NUM] exceed limit [NUM]
 green [LOGDATE] BGP: %NOTIFICATION: received from neighbor [IPADDR] [NUM]/[NUM] \(Cease\) [NUM] bytes
+green [LOGDATE] BGP: %NOTIFICATION: sent to neighbor [IPADDR] [NUM]/[NUM] \(Cease/Administratively Reset\) [NUM] bytes
+green [LOGDATE] BGP: %NOTIFICATION: received from neighbor [IPADDR] [NUM]/[NUM] \(Hold Timer Expired\) [NUM] bytes
+green [LOGDATE] BGP: %NOTIFICATION: sent to neighbor [IPADDR] [NUM]/[NUM] \(Hold Timer Expired\) [NUM] bytes
+green [LOGDATE] BGP: %NOTIFICATION: sent to neighbor [IPADDR] [NUM]/[NUM] \(Cease/Maximum Number of Prefixes Reached\) [NUM] bytes
+green [LOGDATE] BGP: %NOTIFICATION: received from neighbor [IPADDR] [NUM]/[NUM] \(Cease/Connection Rejected\) [NUM] bytes
+green [LOGDATE] BGP: %NOTIFICATION: sent to neighbor [IPADDR] [NUM]/[NUM] \(Cease/Connection collision resolution\) [NUM] bytes
+green [LOGDATE] BGP: SMUX_CLOSE with reason: [NUM]
+
+yellow [LOGDATE] BGP: %NOTIFICATION: received from neighbor [IPADDR] [NUM]/[NUM] \(OPEN Message Error/Authentication Failure\) [NUM] bytes

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/macros.txt
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/macros.txt	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/macros.txt	2006-07-21 23:12:45 UTC (rev 633)
@@ -3,6 +3,6 @@
 # match a macroname!!
 # entries are matched in the order specified
 LOGDATE \d\d\d\d/\d\d/\d\d \d\d:\d\d:\d\d
-IPADDR (25[0-5]|2[0-4][\d]|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3}
+IPADDR ((([0-9a-fA-F]+:){7}[0-9a-fA-F]+)|(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?::(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?)|((25[0-5]|2[0-4][\d]|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3})
 PID 	\[\d+\]
 NUM     [-+]?\d+

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/rmacros.txt
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/rmacros.txt	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/rmacros.txt	2006-07-21 23:12:45 UTC (rev 633)
@@ -2,6 +2,6 @@
 # they are very much like the ones in the 'macros' file, but
 # specifically designed to extract rules from existing logfiles
 LOGDATE [0-9][0-9][0-9][0-9]/[0-9][0-9]/[0-9][0-9] [0-9][0-9]:[0-9][0-9]:[0-9][0-9]
-IPADDR	(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9])){3}
+IPADDR ((([0-9a-fA-F]+:){7}[0-9a-fA-F]+)|(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?::(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?)|((25[0-5]|2[0-4][\d]|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3})
 PID 	\[[0-9]+\]
 NUM	[-+]?(0x)?\d+

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/zebra
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/zebra	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/quagga/zebra	2006-07-21 23:12:45 UTC (rev 633)
@@ -3,3 +3,4 @@
 green [LOGDATE] ZEBRA: Zebra [NUM]\.[NUM]\.[NUM] starting: vty@[NUM]
 green [LOGDATE] ZEBRA: Terminating on signal
 green [LOGDATE] ZEBRA: Zebra [NUM]\.[NUM]\.[NUM] starting: vty@[NUM]
+green [LOGDATE] ZEBRA: SMUX_CLOSE with reason: [NUM]

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/apmd
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/apmd	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/apmd	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,3 +1,4 @@
 green [LOGDATE] apmd[PID]: Charge: \* \* \* \(-[NUM]% unknown\)
 green [LOGDATE] apmd[PID]: Exiting
 green [LOGDATE] apmd[PID]: Version [NUM]\.[NUM]final \(APM BIOS [NUM]\.[NUM], Linux driver [NUM]\.[NUM]\)
+green [LOGDATE] apmd[PID]: apmd .* interfacing with apm driver .* and APM BIOS 

Copied: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/auditd (from rev 632, upwatch/trunk/uw_sysstat/uw_sysstat.d/syslog/auditd)

Copied: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/automount (from rev 632, upwatch/trunk/uw_sysstat/uw_sysstat.d/syslog/automount)

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/dhcpd
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/dhcpd	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/dhcpd	2006-07-21 23:12:45 UTC (rev 633)
@@ -3,3 +3,15 @@
 green [LOGDATE] dhcpd: DHCPDISCOVER from [MACADDR]
 green [LOGDATE] dhcpd: Wrote [NUM] leases to leases file\.
 green [LOGDATE] dhcpd: No hostname for [IPADDR]
+green [LOGDATE] dhcpd: Remove host declaration [WORD] or remove [IPADDR]
+green [LOGDATE] dhcpd: from the dynamic address pool for 
+green [LOGDATE] dhcpd: Dynamic and static leases present for [IPADDR].
+green [LOGDATE] dhcpd: Internet Software Consortium DHCP Server
+green [LOGDATE] dhcpd: Copyright [NUM]-[NUM] Internet Software Consortium.
+green [LOGDATE] dhcpd: All rights reserved.
+green [LOGDATE] dhcpd: For info, please visit <A HREF="http://www.isc.org/products/DHCP">http://www.isc.org/products/DHCP</A>
+green [LOGDATE] dhcpd: (Listening|Sending) on LPF/.*?/.*?/[IPADDR]/[NUM]
+green [LOGDATE] dhcpd: Sending on\s+Socket/fallback/fallback-net
+green [LOGDATE] dhcpd: Wrote [NUM] deleted host decls to leases file.
+green [LOGDATE] dhcpd: Wrote [NUM] new dynamic host decls to leases file.
+green [LOGDATE] dhcpd:\s*$

Deleted: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/fast
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/fast	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/fast	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,2 +0,0 @@
-green [LOGDATE] fast[PID]: ssh connection for [USER] to \(\) finished
-green [LOGDATE] fast[PID]: ssh connection for [USER] to [IPADDR] \(.*\) finished

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/gconfd
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/gconfd	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/gconfd	2006-07-21 23:12:45 UTC (rev 633)
@@ -7,4 +7,4 @@
 green [LOGDATE] gconfd \([USER]-[NUM]\): adres gevonden &quot;xml:readonly:[PATH]&quot; naar een alleen-lezen configuratiebron op positie [NUM]
 green [LOGDATE] gconfd \([USER]-[NUM]\): Resolved address &quot;xml:readwrite:[PATH]&quot; to a writable config source at position [NUM]
 green [LOGDATE] gconfd \([USER]-[NUM]\): Adres gevonden &quot;xml:readwrite:[PATH]&quot; naar een schrijfbare configuratiebron op positie [NUM]
-
+green [LOGDATE] gconfd

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/gdm
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/gdm	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/gdm	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,2 +1,6 @@
 green [LOGDATE] gdm-binary[PID]: Couldn't authenticate user
-
+green [LOGDATE] gdm[PID]: Couldn't authenticate user
+ignore [LOGDATE] gdm[PID]: gdm_slave_xioerror_handler: Fatal X error - Restarting [HOSTNAME]:[NUM]
+ignore [LOGDATE] gdm[PID]: gdm_slave_xioerror_handler: Fatal X error - Restarting [IPADDR]:[NUM]
+green [LOGDATE] gdm[PID]: QUERY_VT request denied: Not authenticated
+green [LOGDATE] gdm[PID]: QUERY_LOGOUT_ACTION request denied: Not authenticated

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/httpd
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/httpd	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/httpd	2006-07-21 23:12:45 UTC (rev 633)
@@ -7,3 +7,4 @@
 green [LOGDATE] httpd: \[[SMONTH] [LOGDATE]\] \[warn\] module status_module is already loaded, skipping
 green [LOGDATE] httpd: \[[SMONTH] [LOGDATE]\] \[warn\] NameVirtualHost [IPADDR]:[NUM] has no VirtualHosts
 green [LOGDATE] httpd: [USER]
+green [LOGDATE] logger: HTTP down: return value was 0

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/identd
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/identd	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/identd	2006-07-21 23:12:45 UTC (rev 633)
@@ -1 +1,2 @@
 green [LOGDATE] identd[PID]: request_thread: read\([NUM], \.\.\., [NUM]\) failed: Connection reset by peer
+green [LOGDATE] identd[PID]: Connection from [HOSTNAME]

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/keepalived
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/keepalived	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/keepalived	2006-07-21 23:12:45 UTC (rev 633)
@@ -5,25 +5,13 @@
 green [LOGDATE] Keepalived_vrrp: VRRP_Instance(VI_eth[NUM]) Received higher prio advert
 green [LOGDATE] Keepalived_vrrp: VRRP_Instance(VI_eth[NUM]) removing protocol Virtual Routes
 green [LOGDATE] Keepalived_vrrp: VRRP_Instance(VI_eth[NUM]) Transition to MASTER STATE
-ignore [LOGDATE] Keepalived: Watchdog: Error while sending data to Healthcheck Child\. error=\(Broken pipe\)\.
-green [LOGDATE] Keepalived: Watchdog: success connecting /tmp/\.healthcheckers wdog socket
-green [LOGDATE] Keepalived: Watchdog: Healthcheck Child no longer exist, restarting\.\.\.
-green [LOGDATE] Keepalived: Remove a zombie pid file /var/run/keepalived_checkers.pid
-green [LOGDATE] Keepalived_healthcheckers: Timeout connect, timeout server \[[IPADDR]:[NUM]\]\.
-green [LOGDATE] Keepalived_healthcheckers: Removing service \[[IPADDR]:[NUM]\] from VS \[[IPADDR]:[NUM]\]
-green [LOGDATE] Keepalived_healthcheckers: Remote SMTP server \[[IPADDR]:[NUM]\] connected\.
-green [LOGDATE] Keepalived_healthcheckers: SMTP alert successfully sent\.
-green [LOGDATE] Keepalived_healthcheckers: HTTP status code success to \[[IPADDR]:[NUM]\] url\([NUM]\)\.
-green [LOGDATE] Keepalived_healthcheckers: Remote Web server \[[IPADDR]:[NUM]\] succeed on service\.
-green [LOGDATE] Keepalived_healthcheckers: Adding service \[[IPADDR]:[NUM]\] to VS \[[IPADDR]:[NUM]\]
-green [LOGDATE] Keepalived_healthcheckers: Connection trouble to: \[[IPADDR]:[NUM]\]\.
-green [LOGDATE] Keepalived_healthcheckers: Read error with server \[[IPADDR]:[NUM]\]: Connection reset by peer
-ignore [LOGDATE] Keepalived_healthcheckers: Error connecting server \[[IPADDR]:[NUM]\]\.
-green [LOGDATE] Keepalived_healthcheckers: Timeout WEB read server \[[IPADDR]:[NUM]\]\.
-green [LOGDATE] Keepalived_healthcheckers: Netlink reflector reports IP [IPADDR] added
-green [LOGDATE] Keepalived_healthcheckers: Registering Kernel netlink reflector
-green [LOGDATE] Keepalived_healthcheckers: Registering Kernel netlink comand channel
-green [LOGDATE] Keepalived_healthcheckers: Configuration is using : [NUM] Bytes
-green [LOGDATE] Keepalived_healthcheckers: IPVS : Service already exists
-green [LOGDATE] Keepalived_healthcheckers: IPVS : Destination already exists
-green [LOGDATE] Keepalived_healthcheckers: Activating healtchecker for service \[[IPADDR]:[NUM]\]
+green [LOGDATE] Keepalived: Terminating on signal
+green [LOGDATE] Keepalived_vrrp: Terminating VRRP child process on signal
+green [LOGDATE] Keepalived_vrrp: VRRP_Instance\([WORD]\) removing protocol VIPs.
+green [LOGDATE] kernel: IPVS: stopping sync thread [NUM] ..
+green [LOGDATE] Keepalived: Stopping Keepalived 
+green [LOGDATE] kernel: IPVS: sync thread stopped!
+green [LOGDATE] Keepalived_healthcheckers: Terminating Healthchecker child process on signal
+green [LOGDATE] Keepalived_healthcheckers: IPVS: No such destination
+red [LOGDATE] Keepalived_healthcheckers: Error connecting server \[[IPADDR]:[NUM]\]\.
+red [LOGDATE] Keepalived_healthcheckers: Cannot send get request to \[[IPADDR]:[NUM]\]\.

Copied: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/linux.kernel (from rev 632, upwatch/trunk/uw_sysstat/uw_sysstat.d/syslog/linux.kernel)

Copied: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/logrotate (from rev 632, upwatch/trunk/uw_sysstat/uw_sysstat.d/syslog/logrotate)

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/macros.txt
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/macros.txt	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/macros.txt	2006-07-21 23:12:45 UTC (rev 633)
@@ -3,10 +3,10 @@
 # match a macroname!!
 # entries are matched in the order specified
 WLOGDATE (Mon|Tue|Wed|Thu|Fri|Sat|Sun) [A-Za-z]* [\d ]\d \d\d:\d\d:\d\d [-\.\/\dA-Za-z]+
-LOGDATE [A-Za-z]* [\d ]\d \d\d:\d\d:\d\d [-\.\/\dA-Za-z]+
+LOGDATE [A-Za-z]{3}\s{1,2}[\d]{1,2} \d\d:\d\d:\d\d [-\.\/\dA-Za-z]+
 EMAIL   [-\.\$\w]+@[a-z\d][-a-z\d]*(\.[a-z\d][-a-z\d]+)*\.(arpa|com|edu|biz|org|gov|int|info|mil|net|name|museum|coop|aero|[a-z][a-z])
 HOSTNAME ([a-z\d][-a-z\d]*)(\.[a-z\d][-a-z\d]*)*(\.(arpa|com|edu|biz|org|gov|int|info|mil|net|name|museum|coop|aero|[a-z][a-z]))?
-IPADDR (25[0-5]|2[0-4][\d]|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3}
+IPADDR ((([0-9a-fA-F]+:){7}[0-9a-fA-F]+)|(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?::(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?)|((25[0-5]|2[0-4][\d]|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3})
 HOSTNAM [-\da-z]+
 MACADDR ([a-f\d][a-f\d])(:[a-f\d][a-f\d]){5,}
 PATH	/?[-_\.[:alnum:]]?(/[-_\.[:alnum:]]+)*/?

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/named
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/named	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/named	2006-07-21 23:12:45 UTC (rev 633)
@@ -3,8 +3,8 @@
 green [LOGDATE] named[PID]: check_hints: A records for J\.ROOT-SERVERS\.NET class [NUM] do not match hint records
 green [LOGDATE] named[PID]: Cleaned cache of [NUM] RRset
 green [LOGDATE] named[PID]: client [IPADDR]#[NUM]: bad zone transfer request: '[HOSTNAME]/IN': non-authoritative zone \(NOTAUTH\)
-ignore [LOGDATE] named[PID]: client [IPADDR]#[NUM]: error sending response: host unreachable
 ignore [LOGDATE] named[PID]: client [IPADDR]#[NUM]: error sending response: invalid file
+ignore [LOGDATE] named[PID]: client [IPADDR]#[NUM]: error sending response: host unreachable
 green [LOGDATE] named[PID]: client [IPADDR]#[NUM]: no more recursive clients: quota reached
 green [LOGDATE] named[PID]: client [IPADDR]#[NUM]: update forwarding denied
 green [LOGDATE] named[PID]: client [IPADDR]#[NUM]: update '[HOSTNAME]/IN' denied
@@ -16,7 +16,6 @@
 green [LOGDATE] named[PID]: dns_master_load: [PATH]:[NUM]: ignoring out-of-zone data \(.*\)
 green [LOGDATE] named[PID]: drained [NUM] queries \(delay [NUM] sec\)
 green [LOGDATE] named[PID]: exiting
-
 green [LOGDATE] named[PID]: Forwarding source address is \[[IPADDR]\]\.[NUM]
 green [LOGDATE] named[PID]: group = [NUM]
 green [LOGDATE] named[PID]: hint zone &quot;&quot; \(IN\) loaded \(serial [NUM]\)

Deleted: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/netland
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/netland	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/netland	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,2 +0,0 @@
-green [LOGDATE] make-backup.sh[PID]: backup done
-

Copied: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/newsyslog (from rev 632, upwatch/trunk/uw_sysstat/uw_sysstat.d/syslog/newsyslog)

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/nfs-utils
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/nfs-utils	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/nfs-utils	2006-07-21 23:12:45 UTC (rev 633)
@@ -6,5 +6,5 @@
 green [LOGDATE] rpc.mountd: authenticated (un)?mount request from [HOSTNAME]:[NUM] for [PATH] \([PATH]\)
 green [LOGDATE] rpc.mountd: refused mount request from [HOSTNAME] for [PATH] \([PATH]\)
 green [LOGDATE] rpc.statd[PID]: Caught signal [NUM], un-registering and exiting\.
+green [LOGDATE] rpc.mountd: Caught signal [NUM], un-registering and exiting.
 
-

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/openntpd
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/openntpd	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/openntpd	2006-07-21 23:12:45 UTC (rev 633)
@@ -2,12 +2,18 @@
 green [LOGDATE] ntpd[PID]: ntp engine ready
 green [LOGDATE] ntpd[PID]: peer [IPADDR] now invalid
 green [LOGDATE] ntpd[PID]: peer [IPADDR] now valid
-green [LOGDATE] services[NUM] ntpd[PID]: listening on [IPADDR]
-green [LOGDATE] services[NUM] ntpd[PID]: ntp engine ready
-green [LOGDATE] services[NUM] ntpd[PID]: peer [IPADDR] now valid
+green [LOGDATE] ntpd[PID]: listening on [IPADDR]
+green [LOGDATE] ntpd[PID]: ntp engine ready
+green [LOGDATE] ntpd[PID]: peer [IPADDR] now valid
 green [LOGDATE] ntpd[PID]: adjusting local clock by
 green [LOGDATE] ntpd[PID]: Terminating
 green [LOGDATE] ntpd[PID]: ntp engine exiting
 green [LOGDATE] ntpd[PID]: dispatch_imsg in main: pipe closed
 green [LOGDATE] ntpd[PID]: Lost child: child exited
+green [LOGDATE] ntpd[PID]: recvfrom [IPADDR]: Connection refused
+green [LOGDATE] ntpd[PID]: reply from [IPADDR]: not synced, next query [NUM]s
+green [LOGDATE] ntpd[PID]: sendto: Operation not permitted
+green [LOGDATE] ntpd[PID]: sendto: Connection refused
+green [LOGDATE] ntpd[PID]: IMSG_HOST_DNS with invalid peerID
+yellow [LOGDATE] ntpd[PID]: could not parse &quot;[HOSTNAME]&quot;: Temporary failure in name resolution
 red [LOGDATE] ntpd[PID]: adjtime failed: Invalid argument

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/pam
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/pam	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/pam	2006-07-21 23:12:45 UTC (rev 633)
@@ -17,5 +17,7 @@
 green [LOGDATE] [WORD]\(pam_unix\)[PID]: session closed for [USER_]
 green [LOGDATE] [WORD]\(pam_unix\)[PID]: session (opened|closed) for [USER_]
 green [LOGDATE] [WORD]\(pam_unix\)[PID]: session opened for [USER_]
-green [LOGDATE] [WORD]\(pam_unix\)[PID]: password changed for raarts
-
+green [LOGDATE] [WORD]\(pam_unix\)[PID]: password changed for [USER]
+green [LOGDATE] [WORD]\(pam_unix\)[PID]: auth could not identify password for \[[USER]\]
+green [LOGDATE] unix_chkpwd[PID]: password check failed for user \([USER]\)
+green [LOGDATE] passwd(pam_unix)[PID]: password changed for [USER]

Copied: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/postgresql (from rev 632, upwatch/trunk/uw_sysstat/uw_sysstat.d/syslog/postgresql)

Copied: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/quagga (from rev 632, upwatch/trunk/uw_sysstat/uw_sysstat.d/syslog/quagga)

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/rmacros.txt
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/rmacros.txt	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/rmacros.txt	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,11 +1,11 @@
 # macros for log2regex 
 # they are very much like the ones in the 'macros' file, but
 # specifically designed to extract rules from existing logfiles
-LOGDATE [A-Za-z]* [0-9 ][0-9] [0-9][0-9]:[0-9][0-9]:[0-9][0-9] [-\.\/0-9A-Za-z]+
+LOGDATE [A-Za-z]{3}\s{1,2}[\d]{1,2} \d\d:\d\d:\d\d [-\.\/\dA-Za-z]+
 SMONTH  (Mon|Tue|Wed|Thu|Fri|Sat|Sun)
 EMAIL   [-\.\$_0-9a-z]+@([a-z0-9][-a-z0-9]*)(\.[a-z0-9][-a-z0-9]*)*(\.(arpa|com|edu|biz|org|gov|int|info|mil|net|name|museum|coop|aero|[a-z][a-z]))?
 HOSTNAME ([a-z0-9][-a-z0-9]*)(\.[a-z0-9][-a-z0-9]*)*(\.(arpa|com|edu|biz|org|gov|int|info|mil|net|name|museum|coop|aero|[a-z][a-z]))
-IPADDR	(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9])){3}
+IPADDR ((([0-9a-fA-F]+:){7}[0-9a-fA-F]+)|(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?::(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?)|((25[0-5]|2[0-4][\d]|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3})
 PATH	(/[-\._[:alnum:]]+){2,}([/]?)
 MACADDR ([a-f0-9][a-f0-9])(:[a-f0-9][a-f0-9]){5,}
 TCPFLAG (SYN|ACK|PSH|FIN|RST)(\ (SYN|ACK|PSH|FIN|RST))*

Copied: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/rpc (from rev 632, upwatch/trunk/uw_sysstat/uw_sysstat.d/syslog/rpc)

Copied: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/selinux (from rev 632, upwatch/trunk/uw_sysstat/uw_sysstat.d/syslog/selinux)

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/shorewall
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/shorewall	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/shorewall	2006-07-21 23:12:45 UTC (rev 633)
@@ -1 +1,2 @@
 green [LOGDATE] kernel: Shorewall:
+green [LOGDATE] root: Shorewall Restarted

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/smb
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/smb	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/smb	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,2 +1,22 @@
 green [LOGDATE] smb: nmbd shutdown failed
 green [LOGDATE] smb: smbd shutdown failed
+green [LOGDATE] mount.smbfs[PID]: \[[NUM]/[NUM]/[NUM] [NUM]:[NUM]:[NUM], [NUM]\] client/smbmount.c:send_fs_socket\([NUM]\)
+green [LOGDATE] smbd[PID]: \[[NUM]/[NUM]/[NUM] [NUM]:[NUM]:[NUM], [NUM]\] lib/access.c:check_access\([NUM]\)
+green [LOGDATE] smbd[PID]: \[[NUM]/[NUM]/[NUM] [NUM]:[NUM]:[NUM], [NUM]\] lib/util_sock.c:get_peer_addr\([NUM]\)
+ignore [LOGDATE] smbd[PID]:\s*getpeername failed. Error was Transport endpoint is not connected
+green [LOGDATE] smbd[PID]: \[[NUM]/[NUM]/[NUM] [NUM]:[NUM]:[NUM], [NUM]\] lib/util_sock.c:read_socket_data\([NUM]\)
+ignore [LOGDATE] smb_lookup: find .* failed, error=-512
+green [LOGDATE] smb_add_request: request \[.*, .*\] timed out!
+green [LOGDATE] mount.smbfs[PID]: tdb\([PATH]\): tdb_lock failed on list [NUM] ltype=[NUM] \(Bad file descriptor\)
+green [LOGDATE] mount.smbfs[PID]: \[[NUM]/[NUM]/[NUM] [NUM]:[NUM]:[NUM], [NUM]\] tdb/tdbutil.c:tdb_log\([NUM]\) 
+green [LOGDATE] kernel: smb_proc_readX_data:
+ignore [LOGDATE] smbd[PID]:\s*Error writing [NUM] bytes to client. [NUM]. \(Connection reset by peer\)
+green [LOGDATE] smbd[PID]: \[[NUM]/[NUM]/[NUM] [NUM]:[NUM]:[NUM], [NUM]\] lib/util_sock.c:send_smb\([NUM]\)
+ignore [LOGDATE] smbd[PID]: write_socket_data: write failure. Error = Connection reset by peer
+green [LOGDATE] smbd[PID]: \[[NUM]/[NUM]/[NUM] [NUM]:[NUM]:[NUM], [NUM]\] lib/util_sock.c:write_socket_data\([NUM]\) 
+green [LOGDATE] smb_add_request: request \[.*\] timed out!
+green [LOGDATE] mount.smbfs[PID]: tdb\([PATH]\): tdb_lock failed on list [NUM] ltype=[NUM] \(Bad file descriptor\)
+green [LOGDATE] nmbd[PID]: \[[NUM]/[NUM]/[NUM] [NUM]:[NUM]:[NUM], [NUM]\] nmbd/nmbd_responserecordsdb.c:find_response_record\([NUM]\) 
+green [LOGDATE] nmbd[PID]: find_response_record: response packet id [NUM] received with no matching record.
+green [LOGDATE] smbd[13734]: \[[NUM]/[NUM]/[NUM] [NUM]:[NUM]:[NUM], [NUM]\] lib/util_sock.c:write_data\([NUM]\)
+ignore [LOGDATE] smbd[13734]:\s*write_data: write failure in writing to client [IPADDR]. Error Connection reset by peer

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/snmpd
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/snmpd	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/snmpd	2006-07-21 23:12:45 UTC (rev 633)
@@ -1 +1,7 @@
 green [LOGDATE] snmpd: snmpd shutdown failed
+green [LOGDATE] snmpd[PID]: Received SNMP packet\(s\) from UDP: \[[IPADDR]\]:[NUM]
+green [LOGDATE] snmpd[PID]: Connection from UDP: \[[IPADDR]\]:[NUM]
+green [LOGDATE] snmpd[PID]: [smux_accept] accepted fd [NUM] from  \[[IPADDR]\]:[NUM]
+green [LOGDATE] snmpd[PID]: [smux_accept] accepted fd [NUM] from [IPADDR]:[NUM]
+green [LOGDATE] snmpd[PID]: accepted smux peer: oid SNMPv2-SMI::enterprises\.[NUM]\.[NUM]\.[NUM]\.[NUM], descr 
+green [LOGDATE] snmpd[PID]: Got trap from peer on fd [NUM]

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/sophie
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/sophie	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/sophie	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,6 +1,6 @@
 green [LOGDATE] sophie: [PATH] placed in the background
-green [LOGDATE] sophie[PID]: Callbacks\?       : yes 
-green [LOGDATE] sophie[PID]: Error strings\?   : yes 
+green [LOGDATE] sophie[PID]: Callbacks\?       : [WORD] 
+green [LOGDATE] sophie[PID]: Error strings\?   : [WORD] 
 green [LOGDATE] sophie[PID]: File '[PATH]' infected with virus '.*' 
 green [LOGDATE] sophie[PID]: limit_classif    : [NUM] 
 green [LOGDATE] sophie[PID]: limit_decompr    : [NUM] 
@@ -16,19 +16,19 @@
 green [LOGDATE] sophie[PID]: notice           : SIGNAL '[NUM]' caught - cleaning up and exiting\. 
 green [LOGDATE] sophie[PID]: [PATH] Placed in the background \[PID: [NUM]\] 
 green [LOGDATE] sophie[PID]: PID file         : [PATH] 
-green [LOGDATE] sophie[PID]: Running as user  : mail 
+green [LOGDATE] sophie[PID]: Running as user  : [WORD]
 green [LOGDATE] sophie[PID]: SAVI config      : [PATH] 
-green [LOGDATE] sophie[PID]: Show virus name\? : yes 
+green [LOGDATE] sophie[PID]: Show virus name\? : [WORD]
 ignore [LOGDATE] sophie[PID]: Error strings
-green [LOGDATE] sophie[PID]: socket_check     : yes 
-green [LOGDATE] sophie[PID]: Socket group     : mail 
+green [LOGDATE] sophie[PID]: socket_check     : [WORD]
+green [LOGDATE] sophie[PID]: Socket group     : [WORD]
 green [LOGDATE] sophie[PID]: Socket path      : [PATH] 
 green [LOGDATE] sophie[PID]: Sophie child has timed-out \(no data received in [NUM] seconds\) - process killed 
 green [LOGDATE] sophie[PID]: Sophie IDE       : Sophos IDE version [NUM]\.[NUM] \(detects [NUM] viruses\) 
 green [LOGDATE] sophie[PID]: Sophie version   : [NUM]\.[NUM]rc[NUM] 
 green [LOGDATE] sophie[PID]: Sophos engine    : Sophos engine version [NUM]\.[NUM] 
 green [LOGDATE] sophie[PID]: Timeout          : [NUM] seconds 
-green [LOGDATE] sophie[PID]: Timestamps\?      : no 
+green [LOGDATE] sophie[PID]: Timestamps\?      : [WORD]
 green [LOGDATE] sophie[PID]: Umask            : [NUM] 
 green [LOGDATE] sophie[PID]: warning          : Scan result =&gt; '[PATH]' infected with virus '.*' 
 green [LOGDATE] sophie[PID]: warning          : Socket '[PATH]' already exists! 

Copied: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/spamd (from rev 632, upwatch/trunk/uw_sysstat/uw_sysstat.d/syslog/spamd)

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/sshd
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/sshd	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/sshd	2006-07-21 23:12:45 UTC (rev 633)
@@ -32,6 +32,7 @@
 green [LOGDATE] sshd[PID]: fatal: Did not receive ident string\.
 ignore [LOGDATE] sshd[PID]: fatal: Read error from remote host: Connection reset by peer
 green [LOGDATE] sshd[PID]: fatal: Read from socket failed: Connection reset by peer
+ignore [LOGDATE] sshd[PID]: Read error from remote host [IPADDR]: Connection reset by peer
 green [LOGDATE] sshd[PID]: fatal: Timeout before authentication for [IPADDR]
 green [LOGDATE] sshd[PID]: Found matching DSA key: [MACADDR]
 green [LOGDATE] sshd[PID]: Generating new [NUM] bit RSA key\.
@@ -66,3 +67,10 @@
 ignore [LOGDATE] sshd[PID]: syslogin_perform_logout: logout\(\) returned an error
 green [LOGDATE] sshd[PID]: WARNING: [PATH] does not exist, using old modulus
 green [LOGDATE] sshd[PID]: WARNING: [PATH] does not exist, using old prime
+ignore [LOGDATE] sshd[PID]: Read error from remote host [IPADDR]: No route to host
+green [LOGDATE] sshd[PID]: input_userauth_request: invalid user [USER]
+green [LOGDATE] sshd[PID]: Authentication refused: bad ownership or modes for file [PATH]
+green [LOGDATE] sshd: sshd shutdown failed
+ignore [LOGDATE] sshd[PID]: Read error from remote host [IPADDR]: Connection timed out
+ignore [LOGDATE] sshd[PID]: error: Bind to port [NUM] on [IPADDR] failed: Address already in use.
+green [LOGDATE] sshd\(pam_unix\)[PID]: service\(sshd\) ignoring max retries; [NUM] &gt; [NUM]

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/su
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/su	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/su	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,2 +1,4 @@
 green [LOGDATE] su: \(to [USER]\) [USER] on none
+green [LOGDATE] su: [USER] to [USER] on /dev/[WORD][NUM]
 green [LOGDATE] su: pam_unix2: session finished for user [USER], service su
+green [LOGDATE] su[PID]: Warning! Could not relabel with user_u:object_r:devpts_t, not relabeling. 

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/sudo
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/sudo	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/sudo	2006-07-21 23:12:45 UTC (rev 633)
@@ -1 +1 @@
-green [LOGDATE] sudo:   nobody : TTY=unknown ; PWD=[PATH] ; USER=[USER] ; COMMAND=[PATH] 
+green [LOGDATE] sudo:\s+[USER] : TTY=[WORD][NUM] ; PWD=[PATH] ; USER=[USER] ; COMMAND=[PATH]

Copied: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/syslogd (from rev 632, upwatch/trunk/uw_sysstat/uw_sysstat.d/syslog/syslogd)

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/tftpd
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/tftpd	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/tftpd	2006-07-21 23:12:45 UTC (rev 633)
@@ -1 +1,3 @@
 green [LOGDATE] in.tftpd[PID]: nak: Operation not permitted
+green [LOGDATE] in.tftpd[PID]: sending NAK \([NUM], File not found\) to [IPADDR]
+green [LOGDATE] in.tftpd[PID]: RRQ from [IPADDR] filename .*

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/upwatch
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/upwatch	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/upwatch	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,2 +1,4 @@
 green [LOGDATE] uw_[WORD]: uw_[WORD] shutdown failed
 green [LOGDATE] uw_maint.pl[PID]: [NUM] finished
+green [LOGDATE] upwatch:\s*$
+green [LOGDATE] upwatch: \^\[\[[NUM]

Copied: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/useradd (from rev 632, upwatch/trunk/uw_sysstat/uw_sysstat.d/syslog/useradd)

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/vsftpd
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/vsftpd	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/vsftpd	2006-07-21 23:12:45 UTC (rev 633)
@@ -1 +1,2 @@
 green [LOGDATE] vsftpd(pam_unix)[PID]: check pass; user unknown
+green [LOGDATE] vsftpd: warning: can't get client address: Bad file descriptor

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/xfs
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/xfs	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/xfs	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,4 +1,5 @@
 green [LOGDATE] xfs: ignoring font path element [PATH] \(unreadable\) 
+green [LOGDATE] xfs: ignoring font path element [PATH]:[WORD] \(unreachable\)
 green [LOGDATE] xfs[PID]: attempting clone\.\.\. 
 green [LOGDATE] xfs[PID]: clone: child becoming drone 
 green [LOGDATE] xfs[PID]: clone: parent revitalizing as xfs 

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/xinetd
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/xinetd	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/syslog/xinetd	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,2 +1 @@
 green [LOGDATE] xinetd[PID]: Exiting\.\.\.
-green [LOGDATE] xinetd[PID]: [NUM] .* no services. Exiting...

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/upwatch/macros.txt
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/upwatch/macros.txt	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/upwatch/macros.txt	2006-07-21 23:12:45 UTC (rev 633)
@@ -2,10 +2,10 @@
 # choose your macronames carefully. regular expressions should never
 # match a macroname!!
 # entries are matched in the order specified
-LOGDATE [A-Za-z]* [\d ]\d \d\d:\d\d:\d\d [-\/\dA-Za-z]+
+LOGDATE [A-Za-z]{3}\s{1,2}[\d]{1,2} \d\d:\d\d:\d\d [-\.\/\dA-Za-z]+
 TABLE   \w+/\w+
 HOSTNAME ([a-z0-9][-a-z0-9]*)(\.[a-z0-9][-a-z0-9]*)*(\.(arpa|com|edu|biz|org|gov|int|info|mil|net|name|museum|coop|aero|[a-z][a-z]))
-IPADDR	(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9])){3}
+IPADDR ((([0-9a-fA-F]+:){7}[0-9a-fA-F]+)|(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?::(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?)|((25[0-5]|2[0-4][\d]|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3})
 PATH	(/[-\._[:alnum:]]+){2,}([/]?)
 WORD	[-\.\dA-Za-z_]+
 NUM	[-+]?(0x)?\d+

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/upwatch/rmacros.txt
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/upwatch/rmacros.txt	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/upwatch/rmacros.txt	2006-07-21 23:12:45 UTC (rev 633)
@@ -5,7 +5,7 @@
 SMONTH  (Mon|Tue|Wed|Thu|Fri|Sat|Sun)
 EMAIL   [-\.\$_0-9a-z]+@([a-z0-9][-a-z0-9]*)(\.[a-z0-9][-a-z0-9]*)*(\.(arpa|com|edu|biz|org|gov|int|info|mil|net|name|museum|coop|aero|[a-z][a-z]))?
 HOSTNAME ([a-z0-9][-a-z0-9]*)(\.[a-z0-9][-a-z0-9]*)*(\.(arpa|com|edu|biz|org|gov|int|info|mil|net|name|museum|coop|aero|[a-z][a-z]))
-IPADDR	(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9])){3}
+IPADDR ((([0-9a-fA-F]+:){7}[0-9a-fA-F]+)|(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?::(([0-9a-fA-F]+:)*[0-9a-fA-F]+)?)|((25[0-5]|2[0-4][\d]|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3})	
 PATH	(/[-\._[:alnum:]]+){2,}([/]?)
 MACADDR ([a-f0-9][a-f0-9])(:[a-f0-9][a-f0-9]){5,}
 TCPFLAG (SYN|ACK|PSH|FIN|RST)(\ (SYN|ACK|PSH|FIN|RST))*

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.d/upwatch/upwatch
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.d/upwatch/upwatch	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.d/upwatch/upwatch	2006-07-21 23:12:45 UTC (rev 633)
@@ -1,45 +1,59 @@
 green [LOGDATE] rpm[PID]: installe
-green [LOGDATE] uw_ping[PID]: run\.c\([NUM]\): ICMP Echo from [IPADDR]
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [WORD]: purpled [NUM] probes
-green [LOGDATE] uw_[WORD][PID]: last message repeated [NUM] times
-green [LOGDATE] uw_[WORD][PID]: logregex\.c\([NUM]\): loading [PATH]
-green [LOGDATE] uw_[WORD][PID]: logregex\.c\([NUM]\): reloading [PATH]
-green [LOGDATE] uw_[WORD][PID]: main\.c\([NUM]\): exit
-green [LOGDATE] uw_[WORD][PID]: main\.c\([NUM]\): run [NUM]: processed [NUM] items in [NUM]\.[NUM] seconds
-green [LOGDATE] uw_[WORD][PID]: main\.c\([NUM]\): signal [NUM] received - finishing up
-green [LOGDATE] uw_[WORD][PID]: main\.c\([NUM]\): sleeping for [NUM] seconds
-green [LOGDATE] uw_[WORD][PID]: main\.c\([NUM]\): start
-green [LOGDATE] uw_[WORD][PID]: notify\.c\([NUM]\): MAILTO: [EMAIL] [NUM] [NUM] Message accepted for delivery
-green [LOGDATE] uw_[WORD][PID]: notify\.c\([NUM]\): MAILTO: [EMAIL] [NUM] Ok: queued as
-green [LOGDATE] uw_[WORD][PID]: notify\.c\([NUM]\): [HOSTNAME]: [WORD] [COLOR] \(was [COLOR]\)
-green [LOGDATE] uw_[WORD][PID]: pr_process\.c\([NUM]\): Processing [PATH]
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): can't resolve [HOSTNAME]: No such file or directory
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): child [NUM] exited with status [NUM]
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [IPADDR]
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [IPADDR]:
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [IPADDR]: Broken pipe
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [IPADDR]: Connection reset by peer
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [IPADDR]: Login error:
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [IPADDR]: new connection
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [IPADDR]: [PATH] close error
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [IPADDR]: spooled to [PATH]
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [IPADDR]: timeout on greeting string
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [IPADDR]: timeout reading DATA statement
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [IPADDR]: timeout reading fileblock
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [IPADDR]: timeout reading PASS response
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [IPADDR]: timeout reading USER string
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [PATH]: empty file
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): reading info from database
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): running [NUM] probes
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): signal [NUM] received - finishing up
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): started [PID]: on [PATH]
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): st_read: Connection reset by peer
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): unknown message:
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): uploaded [PATH]
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): user [WORD], pwd [WORD] not found
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): [WORD]: purpled [WORD] [NUM]
-green [LOGDATE] uw_[WORD][PID]: run\.c\([NUM]\): writing results
-green [LOGDATE] uw_[WORD][PID]: spool\.c\([NUM]\): spooled to [PATH]
-red [LOGDATE] uw_[WORD][PID]: db\.c\([NUM]\): Too many connections
-red [LOGDATE] uw_[WORD][PID]: notify\.c\([NUM]\): UPWATCH: probe mysqlstats is lagging in processing
-
+green [LOGDATE] uw_ping[PID] run\.c\([NUM]\): ICMP Echo from [IPADDR]
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [WORD]: purpled [NUM] probes
+green [LOGDATE] uw_[WORD][PID] last message repeated [NUM] times
+green [LOGDATE] uw_[WORD][PID] logregex\.c\([NUM]\): loading [PATH]
+green [LOGDATE] uw_[WORD][PID] logregex\.c\([NUM]\): reloading [PATH]
+green [LOGDATE] uw_[WORD][PID] main\.c\([NUM]\): exit
+green [LOGDATE] uw_[WORD][PID] main\.c\([NUM]\): run [NUM]: processed [NUM] items in [NUM]\.[NUM] seconds
+green [LOGDATE] uw_[WORD][PID] main\.c\([NUM]\): signal [NUM] received - finishing up
+green [LOGDATE] uw_[WORD][PID] main\.c\([NUM]\): sleeping for [NUM] seconds
+green [LOGDATE] uw_[WORD][PID] main\.c\([NUM]\): start
+green [LOGDATE] uw_[WORD][PID] notify\.c\([NUM]\): MAILTO: [EMAIL] [NUM] [NUM] Message accepted for delivery
+green [LOGDATE] uw_[WORD][PID] notify\.c\([NUM]\): MAILTO: [EMAIL] [NUM] Ok: queued as
+green [LOGDATE] uw_[WORD][PID] notify\.c\([NUM]\): [HOSTNAME]: [WORD] [COLOR] \(was [COLOR]\)
+green [LOGDATE] uw_[WORD][PID] pr_process\.c\([NUM]\): Processing [PATH]
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): can't resolve [HOSTNAME]: No such file or directory
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): child [NUM] exited with status [NUM]
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [IPADDR]
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [IPADDR]:
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [IPADDR]: Broken pipe
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [IPADDR]: Connection reset by peer
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [IPADDR]: Login error:
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [IPADDR]: new connection
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [IPADDR]: [PATH] close error
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [IPADDR]: spooled to [PATH]
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [IPADDR]: timeout on greeting string
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [IPADDR]: timeout reading DATA statement
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [IPADDR]: timeout reading fileblock
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [IPADDR]: timeout reading PASS response
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [IPADDR]: timeout reading USER string
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [PATH]: empty file
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): reading info from database
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): running [NUM] probes
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): signal [NUM] received - finishing up
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): started [PID]: on [PATH]
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): st_read: Connection reset by peer
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): read: Connection reset by peer
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): unknown message:
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): uploaded [PATH]
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): user [WORD], pwd [WORD] not found
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [WORD]: purpled [WORD] [NUM]
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): writing results
+green [LOGDATE] uw_[WORD][PID] spool\.c\([NUM]\): spooled to [PATH]
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): [HOSTNAME]:[NUM]: Timer expired
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): timeout reading [WORD] response
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): timeout reading [WORD] command
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): timeout reading login request string
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): st_read: Connection reset by peer
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): timeout reading OK enter password
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): SIGALRM received
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): read: Interrupted system call
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\):\s*$ 
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): Processing [PATH]
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): processing ..
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): sleeping
+green [LOGDATE] uw_[WORD][PID] run\.c\([NUM]\): syncing..
+red [LOGDATE] uw_[WORD][PID] db\.c\([NUM]\): Too many connections
+red [LOGDATE] uw_[WORD][PID] notify\.c\([NUM]\): UPWATCH: probe [WORD] is lagging in processing
+red [LOGDATE] uw_[WORD][PID] db\.c\([NUM]\): Can't connect to MySQL server on '[HOSTNAME]' \([NUM]\) dbhost=[HOSTNAME],dbport=[NUM],dbname=[WORD],db

Modified: upwatch/libdbi/uw_sysstat/uw_sysstat.def
===================================================================
--- upwatch/libdbi/uw_sysstat/uw_sysstat.def	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_sysstat/uw_sysstat.def	2006-07-21 23:12:45 UTC (rev 633)
@@ -34,19 +34,6 @@
 
 // describe commandline flags
 flag = {
-    name      = domain;
-    value     = D;
-    arg_type  = string;
-    descrip   = &quot;upwatch domain where this probe belongs to&quot;;
-    doc       =
-'The upwatch backend can work with several domains. Each domain is maintained in
-a separate database, defines its own probes, and receives its own results. 
-With this option you can specify the domain where the result for this probe
-will be stored';
-};
-
-// describe commandline flags
-flag = {
     name      = realm;
     value     = R;
     arg_type  = string;
@@ -121,7 +108,6 @@
 
 flag = {
     name      = hwstats;
-    value     = h;
     arg_type  = bool;
     descrip   = &quot;Generate hardware statistics&quot;;
     doc       =
@@ -160,6 +146,14 @@
 };
 
 flag = {
+    name      = ignorediskfree;
+    arg_type  = string;   /* option argument indication  */
+    stack_arg;
+    descrip   = &quot;Ignore the diskfree status of this disk&quot;;
+};
+
+
+flag = {
     name      = ipaddress;
     arg_type  = string;   /* option argument indication  */
     arg_default = &quot;127.0.0.1&quot;;
@@ -240,5 +234,3 @@
 
 #include license_gpl.def
 #include generic_options.def
-#include dbase_options_ign.def
-

Modified: upwatch/libdbi/uw_tcpconnect/run.c
===================================================================
--- upwatch/libdbi/uw_tcpconnect/run.c	2006-07-21 20:34:40 UTC (rev 632)
+++ upwatch/libdbi/uw_tcpconnect/run.c	2006-07-21 23:12:45 UTC (rev 633)
@@ -222,7 +222,7 @@
 void write_results(void)
 {
   int ct  = STACKCT_OPT(OUTPUT);
-  char **output = STACKLST_OPT(OUTPUT);
+  char **output = (char **) &amp;STACKLST_OPT(OUTPUT);
   int i;
   xmlDocPtr doc;
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000167.html">[Upwatch-commits] r632 - in upwatch/libdbi: . common	compat/bb/bbhimport doc st-1.4 upwatch uw_accept uw_acceptbb	uw_dns uw_httpget uw_imap uw_investigate uw_mssql uw_mysql	uw_mysqlstats uw_null uw_ping uw_pop3 uw_postgresql	uw_process uw_purple uw_route uw_send uw_setip uw_smtp	uw_snmpget uw_syncprobes uw_sysstat uw_tcpconnect
</A></li>
	<LI>Next message: <A HREF="000166.html">[Upwatch-commits] r634 - upwatch/trunk/uw_httpget
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#168">[ date ]</a>
              <a href="thread.html#168">[ thread ]</a>
              <a href="subject.html#168">[ subject ]</a>
              <a href="author.html#168">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/upwatch-commits">More information about the Upwatch-commits
mailing list</a><br>
</body></html>
